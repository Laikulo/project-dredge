--- /dev/null
+++ b/config/F008/box.cfg
@@ -0,0 +1,75 @@
+[serial_485 serial485]
+serial: /dev/ttyS6
+baud: 460800
+
+[auto_addr]
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: 10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 200#200#352
+cut_pos_x: -5#223.8    #
+cut_pos_y: 200#352#368
+#middle_cut_pos_y:
+Tn_retrude: -6#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 137  #铁氟龙擦嘴的左位置
+clean_left_pos_y: 378#380# 368
+clean_right_pos_x: 170 #铁氟龙擦嘴的右位置
+clean_right_pos_y: 378#380
+clean_velocity: 12000
+cut_velocity: 12000
+extrude_pos_x: 135#127   #切换料吐料的位置
+extrude_pos_y: 378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 350
+# switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/F008/factory_printer.cfg
@@ -0,0 +1,322 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.1
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS9
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB11
+tx_pin: nozzle_mcu: PB10
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC12
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 54.901
+pid_Ki: 1.142
+pid_Kd: 375.483
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PA0]
+pin:PA0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB2]
+pin:PB2
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB10]
+pin:PB10
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC8]
+pin:PC8
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC9]
+pin:PC9
+pwm: True
+cycle_time: 0.010
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin:nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:3000, 20000
+prth_tri_fter:1,1,0.9
+prth_tmp_comp:140,300,0.05,0.13   #140,300,0.05,0.15(PLA)
+# prth_tmp_comp:140,300,0.072,0.15
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/F008/gcode_macro.cfg
@@ -0,0 +1,1176 @@
+# F008
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 350.0
+variable_max_y_position: 350.0
+variable_max_z_position: 350.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  RESTORE_E_CURRENT
+  IF_NEED_HOME
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  SET_E_MIN_CURRENT
+  BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  IF_NEED_HOME
+  SET_PIN PIN=fan0 VALUE=0
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M104 S220
+  M109 S{printer.custom_macro.default_extruder_temp}
+  M104 S140
+  G91
+  G1 X0.5 F600
+  G92 E0 ; Reset Extruder
+  G1 E100 F600
+  G1 E-0.5 F600
+  G90
+  SET_PIN PIN=fan0 VALUE=255
+  G4 P2000
+  SET_PIN PIN=fan0 VALUE=0
+  BOX_NOZZLE_CLEAN#M1501
+  //BOX_GO_TO_EXTRUDE_POS#M1500
+  BOX_NOZZLE_CLEAN
+  # G1 Y200 F6000
+  G92 E0 ; Reset Extruder
+  G90 
+
+
+  # LOAD_MATERIAL_RESTORE_FAN2
+
+
+
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  IF_NEED_HOME
+  BOX_CUT_MATERIAL#M1502
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E-60 F2000
+  G90
+  G1 Y200 F6000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      
+    #   SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+    #   SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+    #   SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+    #   SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+    #   G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+    #   {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+    #   {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+    #   SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+    #   SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+    #   SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+    #   SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+    #   G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+[gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+gcode:
+  {% if 'S' in params|upper %}
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S}
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P2000  
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(200)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(45)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(200)|float %}
+  {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28 X Y
+    ZDOWN_SWITCH ENABLE=1
+    G28 Z
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    M190 S{params.BED_TEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    ZDOWN_SWITCH ENABLE=0
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M140 S{params.BED_TEMP}
+  M220 S100 ;Reset Feedrate
+  M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z2.0 F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  # M84
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    PAUSE_BASE
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      #BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan0_speed %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+  {% endif %}
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  MOTOR_CHECK_CUT_POS
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    M106 S0
+    G1 E{E} F600
+    G90
+    M106 S255
+    G4 P2000
+    BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+    M106 P2 S{s_value}
+    M106 P0 S{s_value_0}
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  SET_LIMITS
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  {% if "z" not in printer.toolhead.homed_axes %}
+    ZDOWN_SWITCH ENABLE=1
+  {% else %}
+    ZDOWN_SWITCH ENABLE=0
+  {% endif %}
+  G28 Z
+  BOX_GO_TO_EXTRUDE_POS
+  M190 S{bed_temp}  
+  BOX_NOZZLE_CLEAN#M1501
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST
+  ZDOWN_SWITCH ENABLE=0
+  G28 Z
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F1200
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+
+  
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+  M1800
+[gcode_macro TEST_HOME]
+gcode:
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
+    G28
new file mode 100644
--- /dev/null
+++ b/config/F008/printer.cfg
@@ -0,0 +1,387 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.15
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS9
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+forced_leveling: true
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 359 ;360
+position_min: -10
+position_max: 359
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 10
+second_homing_speed: 5
+homing_retract_dist: 3.0
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_Kp:19.219  # 重新调整 填入 20240326
+pid_Ki:2.136
+pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:370
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: !nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB2
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: PB1   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.0115  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:2
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+quick_speed: 60 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
new file mode 100644
--- /dev/null
+++ b/config/F008/printer_params.cfg
@@ -0,0 +1,34 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PB4 # throat fan
+# # fan0_pin: nozzle_mcu:PB3 # model fan
+# fan1_pin: PC6 # backplane fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 350
+variable_bed_size_y: 350
+variable_bed_size_z: 350
+# 支持最高温度
+variable_nozzle_temp: 350
+variable_bed_temp: 120
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/F008/sensorless.cfg
@@ -0,0 +1,207 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        # FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      # {% else %}
+      #   FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    # FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10/
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = (printer.configfile.settings['stepper_y'].position_max-60)/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z3 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13/box.cfg
@@ -0,0 +1,96 @@
+[serial_485 serial485]
+serial: /dev/ttyS5
+baud: 230400
+
+[auto_addr]
+
+[filament_rack]
+not_pin: !PA5
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: 10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 200#200#352
+#cut_pos_x: -6.5    
+cut_pos_y: 200#352#368
+#middle_cut_pos_y:
+Tn_retrude: -10#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 135  #料槽吐完料摆动 左边界
+clean_left_pos_y: 378#380# 368
+clean_right_pos_x: 160 #料槽吐完料摆动 右边界
+clean_right_pos_y: 378#380
+clean_velocity: 12000
+box_need_clean_length:70
+cut_velocity: 30000#12000
+extrude_pos_x: 133#135   #切换料吐料的位置
+extrude_pos_y: 378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 345
+safe_pos_x: 225
+clean_pos_left_x: 160     #擦喷嘴 硅胶的左边界的坐标
+clean_pos_right_x:170     #擦喷嘴 硅胶的右边界的坐标
+clean_pos_middle_y:374    #擦喷嘴 硅胶的Y轴中间坐标
+check_cut_pos_x_max:-5    #切刀校准坐标最大坐标 的边界值
+switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[load_ai]
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_SAVE_FAN
+  BOX_RETRUDE_MATERIAL_WITH_TNN # BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+  BOX_RESTORE_FAN
+  BOX_MOVE_TO_SAFE_POS
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_RETRUDE_MATERIAL_WITH_TNN]
+rename_existing: BOX_RETRUDE_MATERIAL_WITH_TNN1
+gcode:
+  BOX_SET_TEMP
+  BOX_GO_TO_EXTRUDE_POS
+  BOX_RETRUDE_MATERIAL
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+  BOX_MOVE_TO_SAFE_POS
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13/factory_printer.cfg
@@ -0,0 +1,427 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.28
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 356 ;360
+position_min: -12
+position_max: 356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp = 14.296
+pid_ki = 1.271
+pid_kd = 40.206
+# pid_Kp:19.219  # 重新调整 填入 20240326
+# pid_Ki:2.136
+# pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_x_stall: PB11
+motor_y_stall: PB12
+motor_z_stall: PB13
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.135  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）56（1280/64）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13/gcode_macro.cfg
@@ -0,0 +1,1453 @@
+# F008
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 350.0
+variable_max_y_position: 352.0
+variable_max_z_position: 350.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+variable_bed_steady_temp: 60,80
+variable_bed_steady_time: 60,120
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM_PARAM]
+variable_cut_calibration: 10000    # 次数
+variable_shaper_calibrate: 1800000  # 秒 500小时
+variable_belt_tensioning: 3600000  # 秒 1000小时
+variable_motion_mechanism_lubrication: 1800000  # 秒
+variable_camera_maintenance: 1800000  # 秒
+variable_fan_inspection: 1800000  # 秒
+variable_nozzle: 20000  # 克
+variable_cut: 100000  # 次
+variable_machine_teflon_tube: 3600000  # 秒
+variable_wipe_mouth_strip: 1800000  # 秒
+variable_air_filter: 1800000  # 秒
+variable_cfs_teflon_tube: 3600000  # 秒
+variable_cfs_desiccant: 1800000  # 秒
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM]
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'zv','mzv','ei'
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  # SET_E_MIN_CURRENT
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  # IF_NEED_HOME
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # M104 S220
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 X0.5 F600
+  # G92 E0 ; Reset Extruder
+  # G1 E100 F600
+  # G1 E-0.5 F600
+  # G90
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P3000
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_NOZZLE_CLEAN#M1501
+  # M104 S140
+  # # BOX_GO_TO_EXTRUDE_POS#M1500
+  # # BOX_NOZZLE_CLEAN
+  # # G1 Y200 F6000
+  # G92 E0 ; Reset Extruder
+  # G90 
+  # LOAD_MATERIAL_RESTORE_FAN2
+  SAVE_GCODE_STATE NAME=myMoveState
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SAVE_FAN
+  FILAMENT_RACK_PRE_FLUSH
+  FILAMENT_RACK_SET_TEMP
+  FILAMENT_RACK_FLUSH
+  FILAMENT_RACK_RESTORE_FAN
+  SET_COOL_TEMP
+  BOX_MOVE_TO_SAFE_POS
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  # IF_NEED_HOME
+  # BOX_CUT_MATERIAL#M1502
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 E-60 F2000
+  # G90
+  # G1 Y200 F6000
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  BOX_MOVE_TO_CUT
+  M400
+  G91
+  G0 E-10 F360
+  G90
+  M400
+  BOX_MOVE_TO_SAFE_POS
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      # G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      # {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      # {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      # G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+[gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S}
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M191]
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S} WAIT=1
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0  WAIT=1
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P3000
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+[gcode_macro SET_CHAMBER_FAN]
+gcode:
+  {% set temp = printer["temperature_fan chamber_fan"].temperature|int %}
+  {% set target = printer["temperature_fan chamber_fan"].target|int %}
+  {% set control = printer["configfile"]["config"]["temperature_fan chamber_fan"].control %}
+  {action_respond_info("temp: %s, target: %s, control: %s" % (temp, target, control))}
+  {% if control == "watermark" %}
+    {% set max_delta = printer["configfile"]["config"]["temperature_fan chamber_fan"].max_delta|int %}
+    {action_respond_info("max_delta: %s" % (max_delta))}
+    {% if temp >= target %}
+      {% set tmp = temp + max_delta + 1 %}
+      # 由于M141设置导致风扇未开启，需要恢复状态（先设置高于的温度值，再恢复）
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={tmp}
+      G4 P500
+      M400
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={target}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  # {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28
+    # 精擦嘴
+    NOZZLE_CLEAR
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{params.BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    # Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    # 精归零
+    NEXT_HOMEZ_NACCU
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M140 S{params.BED_TEMP}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M220 S100 ;Reset Feedrate
+  # M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+  SET_PIN PIN=extruder_fan VALUE=1
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {action_respond_info("END_PRINT_POINT act_z:%s, max_z:%s \n" % (act_z, max_z))}
+    {% if act_z < (max_z - 5) %}
+        {action_respond_info("END_PRINT_POINT G1 Z2.0 F600 \n")}
+        G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    # G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M106 P0 S127
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    PAUSE_BASE
+    PAUSE_EXTERNAL
+  {% endif %}
+
+[gcode_macro PAUSE_EXTERNAL]
+gcode:
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    M400
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+      BOX_MOVE_TO_SAFE_POS
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['output_pin fan2'].value %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['output_pin fan0'].value %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+    SET_PIN PIN=extruder_fan VALUE=0
+
+[gcode_macro CALIBRATE_CUT_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  SET_LIMITS
+  MOTOR_CHECK_CUT_POS
+  M400
+  RESTORE_LIMITS
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+  SET_MAINTENANCE_ITEM_VARIABLE NAME=calibrate VARIABLE=belt_tensioning VALUE=0
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro NOZZLE_PID_HIGH]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=320
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESUME_EXTERNAL_PROCESS
+  RESUME_BASE {get_params}
+
+[gcode_macro RESUME_EXTERNAL_PROCESS]
+gcode:
+  BOX_ERROR_RESUME_PROCESS
+  RESUME_EXTERNAL
+
+[gcode_macro RESUME_EXTERNAL]
+gcode:
+  {% if printer.pause_resume.resume_err is none or printer.pause_resume.resume_err|lower == 'false' %}
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    #G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  {% set E_VELOCITY = printer['filament_rack'].remain_material_velocity * 0.8 %}
+  {action_respond_info("velocity: %s" % (E_VELOCITY))}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'false' %}
+    {action_respond_info("Extruder not hot enough, SET M109 S%s" % 
+      printer['gcode_macro PRINTER_PARAM'].hotend_temp|int)}
+    M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% else %}
+    M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% endif %}
+  G91
+  M106 S0
+  G1 E{E} F{E_VELOCITY}
+  G90
+  M106 S127
+  G4 P3000
+  BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  M106 P2 S{s_value}
+  M106 P0 S{s_value_0}
+  SET_LIMITS
+  M400
+  SET_PIN PIN=extruder_fan VALUE=1
+  {% endif %}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  {action_respond_info("start END_PRINT")}
+  END_PRINT
+  {action_respond_info("end END_PRINT success")}
+  CANCEL_PRINT_BASE
+  {action_respond_info("CANCEL_PRINT success")}
+  CLEAR_EEPROM_INFO
+
+[gcode_macro MOTOR_CANCEL_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  BOX_SET_CURRENT_BOX_IDLE_MODE
+  CANCEL_PRINT_BASE
+  WAIT_TEMP_START
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  # 此处Z归位一定要下降,此次光电找平后,不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  # 每次调平在上面的重新做Z_TILT_ADJUST,才能得到新的adjustments调整值
+  # 设置标志位 ZDOWN的时候 不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  SET_G29_FLAG VALUE=1
+  G28 Z
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  # 精擦嘴后做一次光电找平获取最大Z轴高度值
+  ZDOWN_SWITCH ENABLE=1
+  G28 Z
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST WAITTIME=5
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  SET_G29_FLAG VALUE=0
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F1200
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+[gcode_macro BED_MESH_CALIBRATE_START_PRINT] # 用于打印前的归位调平
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% if 'GCODE_FILE' in params|upper %}
+    {% set get_gcode_file = ("GCODE_FILE='"+ params.GCODE_FILE + "'") %}
+  {%else %}
+    {% set get_gcode_file = "" %}
+  {% endif %}
+  {action_respond_info("get_gcode_file = %s" % (get_gcode_file))}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+
+  M106 S0  #需要关闭模型风扇
+  M104 S{extruder_temp} # 140
+  M140 S{bed_temp}  # 50
+
+  {% if "z" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    PRINT_PREPARED
+    BED_MESH_CLEAR
+    NOZZLE_CLEAR
+    NEXT_HOMEZ_NACCU
+    G28 Z
+  {% endif %}
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count} {get_gcode_file}
+  G0 Z10 F600
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  
+[gcode_macro WAIT_BED_STABLE_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  BOX_MOVE_TO_SAFE_POS
+  G1 Z45 F1200
+
+
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  {% for _ in range(100) %}
+    M1800
+  {% endfor %}
+  
+[gcode_macro TEST_HOME]
+gcode:
+  {% for _ in range(100) %}
+    G28
+  {% endfor %} 
+    
+[gcode_macro A_TriPress_STEP1]
+gcode:
+  G28
+  G1 Z25 F600
+
+[gcode_macro A_TriPress_STEP2]
+gcode:
+  PROBE_ACCURACY PROBE_SPEED=5
+
+[gcode_macro EXTRUDE_TEST]
+gcode:
+  M104 S220
+  {% set times = params.TIMES|default(1)|int %}
+  {% for _ in range(times) %}
+    BOX_MOVE_TO_CUT
+    BOX_GO_TO_EXTRUDE_POS
+    G91
+    G0 E100 F360
+    G90
+    M400
+    # BOX_BLOW
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P4000
+    SET_PIN PIN=fan0 VALUE=0
+    M400
+    BOX_NOZZLE_CLEAN
+    # BOX_GO_TO_EXTRUDE_POS
+  {% endfor %}
+
+[gcode_macro A_G28_test] ;归零与重复探测精度测试
+gcode:
+  {% set Count = params.G28_COUNT|default(3000)|int %}
+  {% set RECount = params.COUNT|default(1000)|int %}
+
+  M109 S140
+
+  {% for _ in range(Count) %}
+      G28
+  {% endfor %}
+
+  TEST_REPROBE C={RECount}
+
+  M104 S0  
+
+
+# [gcode_macro T0]
+# rename_existing: T0.1
+# gcode:
+#   T0.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T1]
+# rename_existing: T1.1
+# gcode:
+#   T1.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T2]
+# rename_existing: T2.1
+# gcode:
+#   T2.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T3]
+# rename_existing: T3.1
+# gcode:
+#   T3.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+  
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13/printer.cfg
@@ -0,0 +1,440 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.49
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+#hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+forced_leveling: true
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 352.5#356 ;360
+position_min: -10 #-12
+position_max: 352.5#356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -6.2#-10#345
+position_min: -6.2#-8.5#-10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp: 14.296
+pid_ki: 1.271
+pid_kd: 40.206
+high_temp_value: 280
+pid_kp_high_temp: 16.443
+pid_ki_high_temp:  1.370
+pid_kd_high_temp: 49.329
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+is_ptc_fan: 1
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 0.5
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin extruder_fan]
+pin: nozzle_mcu: PB1   #高电平触发，默认低电平
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_closed_loop: x,y,z,z1,e
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_x_stall: PB11
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_y_stall: PB12
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z_stall: PB13
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+prth_clr_probe_pos:150,355
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.21.20.205
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+# prth_tmp_comp: 26,300,0,0.135 #默认使用非线性温度补偿功能，26,300,0,0.11 使用2.5mm不削薄应变片+提高应变片激励电压方案 #26,300,0,0.135削薄应变片 
+enable_not_linear_comp:True #是否使能温度非线性补偿功能，True使能 False不使能(使用线性补偿)
+pres_cfg_regs:60 #60（1280/128）44（640/128）56（1280/64）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+prth_tri_zacc:1000
+prth_min_fans:0.6
+# regional_prtouch_switch: False # 区域调平开关，默认True开启
+regional_prtouch_percentage:0.8
+
+[bed_mesh]
+speed: 100
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 10 # mm/s  探测速度
+rising_dist: 10 # mm  首次探测到光电后的上升距离
+safe_dist: 40 # mm  热床倾斜偏差安全值 一侧光电触发后，另一侧允许下降的距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15, PA8  # 光电触发,多个光电配置方式：endstop_pin_z: PA15, PA8... 最多支持4个
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
+
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13/printer_params.cfg
@@ -0,0 +1,41 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PB4 # throat fan
+# # fan0_pin: nozzle_mcu:PB3 # model fan
+# fan1_pin: PC6 # backplane fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[fan_feedback]
+fan0_pin: PC6 # PTC Fan
+fan1_pin: nozzle_mcu:PA12 # 喉管散热风扇
+fan2_pin: nozzle_mcu:PC13 # 模型散热风扇
+print_delay_time: 3
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 350
+variable_bed_size_y: 350
+variable_bed_size_z: 350
+# 支持最高温度
+variable_nozzle_temp: 350
+variable_bed_temp: 120
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13/sensorless.cfg
@@ -0,0 +1,239 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        # FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      # {% else %}
+      #   FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    # FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10/
+  {% endif %}
+
+  # 计算归零中点，根据bed_mesh参数计算，适配多种不同机器
+  {% set X_s = printer.configfile.settings['bed_mesh'].mesh_min[0]|int %}
+  {% set X_e = printer.configfile.settings['bed_mesh'].mesh_max[0]|int %}
+  {% set Y_s = printer.configfile.settings['bed_mesh'].mesh_min[1]|int %}
+  {% set Y_e = printer.configfile.settings['bed_mesh'].mesh_max[1]|int %}
+
+  {% set POSITION_X = (X_e-X_s)/2+X_s|int %}
+  {% set POSITION_Y = (Y_e-Y_s)/2+Y_s|int %}
+
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (POSITION_X))}
+  {action_respond_info("y_park = %s \n" % (POSITION_Y))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z5 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  MOTOR_STALL_MODE DATA=1
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and 'Y' in params %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'y' %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'Y' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'x'%}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    {% if x_axes[2] is not defined %}
+      BOX_GO_TO_EXTRUDE_POS
+      PRES_CHECK RUN=1
+      BOX_NOZZLE_CLEAN
+      PRES_CHECK RUN=0
+    {% endif %}
+    SET_PIN PIN=extruder_fan VALUE=0
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  MOTOR_STALL_MODE DATA=2
+  MOTOR_CHECK_PROTECTION_AFTER_HOME DATA=11
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13_1/box.cfg
@@ -0,0 +1,96 @@
+[serial_485 serial485]
+serial: /dev/ttyS5
+baud: 230400
+
+[auto_addr]
+
+[filament_rack]
+not_pin: !PA5
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: 10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 200#200#352
+#cut_pos_x: -6.5    
+cut_pos_y: 200#352#368
+#middle_cut_pos_y:
+Tn_retrude: -10#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 135  #料槽吐完料摆动 左边界
+clean_left_pos_y: 378#380# 368
+clean_right_pos_x: 160 #料槽吐完料摆动 右边界
+clean_right_pos_y: 378#380
+clean_velocity: 12000
+box_need_clean_length:70
+cut_velocity: 30000#12000
+extrude_pos_x: 133#135   #切换料吐料的位置
+extrude_pos_y: 378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 345
+safe_pos_x: 225
+clean_pos_left_x: 160     #擦喷嘴 硅胶的左边界的坐标
+clean_pos_right_x:170     #擦喷嘴 硅胶的右边界的坐标
+clean_pos_middle_y:374    #擦喷嘴 硅胶的Y轴中间坐标
+check_cut_pos_x_max:-5    #切刀校准坐标最大坐标 的边界值
+switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[load_ai]
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_SAVE_FAN
+  BOX_RETRUDE_MATERIAL_WITH_TNN # BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+  BOX_RESTORE_FAN
+  BOX_MOVE_TO_SAFE_POS
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_RETRUDE_MATERIAL_WITH_TNN]
+rename_existing: BOX_RETRUDE_MATERIAL_WITH_TNN1
+gcode:
+  BOX_SET_TEMP
+  BOX_GO_TO_EXTRUDE_POS
+  BOX_RETRUDE_MATERIAL
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+  BOX_MOVE_TO_SAFE_POS
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13_1/factory_printer.cfg
@@ -0,0 +1,428 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.9
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 356 ;360
+position_min: -12
+position_max: 356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 330 #360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp = 14.296
+pid_ki = 1.271
+pid_kd = 40.206
+# pid_Kp:19.219  # 重新调整 填入 20240326
+# pid_Ki:2.136
+# pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_x_stall: PB11
+motor_y_stall: PB12
+motor_z_stall: PB13
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.135  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）56（1280/64）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
+
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13_1/gcode_macro.cfg
@@ -0,0 +1,1443 @@
+# F008
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 350.0
+variable_max_y_position: 352.0
+variable_max_z_position: 320 #350.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+variable_bed_steady_temp: 60,80
+variable_bed_steady_time: 60,120
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM_PARAM]
+variable_cut_calibration: 10000    # 次数
+variable_shaper_calibrate: 1800000  # 秒 500小时
+variable_belt_tensioning: 3600000  # 秒 1000小时
+variable_motion_mechanism_lubrication: 1800000  # 秒
+variable_camera_maintenance: 1800000  # 秒
+variable_fan_inspection: 1800000  # 秒
+variable_nozzle: 20000  # 克
+variable_cut: 100000  # 次
+variable_machine_teflon_tube: 3600000  # 秒
+variable_wipe_mouth_strip: 1800000  # 秒
+variable_air_filter: 1800000  # 秒
+variable_cfs_teflon_tube: 3600000  # 秒
+variable_cfs_desiccant: 1800000  # 秒
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM]
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'zv','mzv','ei'
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  # SET_E_MIN_CURRENT
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  # IF_NEED_HOME
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # M104 S220
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 X0.5 F600
+  # G92 E0 ; Reset Extruder
+  # G1 E100 F600
+  # G1 E-0.5 F600
+  # G90
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P3000
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_NOZZLE_CLEAN#M1501
+  # M104 S140
+  # # BOX_GO_TO_EXTRUDE_POS#M1500
+  # # BOX_NOZZLE_CLEAN
+  # # G1 Y200 F6000
+  # G92 E0 ; Reset Extruder
+  # G90 
+  # LOAD_MATERIAL_RESTORE_FAN2
+  SAVE_GCODE_STATE NAME=myMoveState
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SAVE_FAN
+  FILAMENT_RACK_PRE_FLUSH
+  FILAMENT_RACK_SET_TEMP
+  FILAMENT_RACK_FLUSH
+  FILAMENT_RACK_RESTORE_FAN
+  SET_COOL_TEMP
+  BOX_MOVE_TO_SAFE_POS
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  # IF_NEED_HOME
+  # BOX_CUT_MATERIAL#M1502
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 E-60 F2000
+  # G90
+  # G1 Y200 F6000
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  BOX_MOVE_TO_CUT
+  M400
+  G91
+  G0 E-10 F360
+  G90
+  M400
+  BOX_MOVE_TO_SAFE_POS
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      # G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      # {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      # {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      # G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+[gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S}
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M191]
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S} WAIT=1
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0  WAIT=1
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P3000
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+[gcode_macro SET_CHAMBER_FAN]
+gcode:
+  {% set temp = printer["temperature_fan chamber_fan"].temperature|int %}
+  {% set target = printer["temperature_fan chamber_fan"].target|int %}
+  {% set control = printer["configfile"]["config"]["temperature_fan chamber_fan"].control %}
+  {action_respond_info("temp: %s, target: %s, control: %s" % (temp, target, control))}
+  {% if control == "watermark" %}
+    {% set max_delta = printer["configfile"]["config"]["temperature_fan chamber_fan"].max_delta|int %}
+    {action_respond_info("max_delta: %s" % (max_delta))}
+    {% if temp >= target %}
+      {% set tmp = temp + max_delta + 1 %}
+      # 由于M141设置导致风扇未开启，需要恢复状态（先设置高于的温度值，再恢复）
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={tmp}
+      G4 P500
+      M400
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={target}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  # {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28
+    # 精擦嘴
+    NOZZLE_CLEAR
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{params.BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    # Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    # 精归零
+    NEXT_HOMEZ_NACCU
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M140 S{params.BED_TEMP}
+  M220 S100 ;Reset Feedrate
+  # M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+  SET_PIN PIN=extruder_fan VALUE=1
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {action_respond_info("END_PRINT_POINT act_z:%s, max_z:%s \n" % (act_z, max_z))}
+    {% if act_z < (max_z - 5) %}
+        {action_respond_info("END_PRINT_POINT G1 Z2.0 F600 \n")}
+        G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    # G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M106 P0 S127
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    PAUSE_BASE
+    PAUSE_EXTERNAL
+  {% endif %}
+
+[gcode_macro PAUSE_EXTERNAL]
+gcode:
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    M400
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+      BOX_MOVE_TO_SAFE_POS
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['output_pin fan2'].value %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['output_pin fan0'].value %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+    SET_PIN PIN=extruder_fan VALUE=0
+
+[gcode_macro CALIBRATE_CUT_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  SET_LIMITS
+  MOTOR_CHECK_CUT_POS
+  M400
+  RESTORE_LIMITS
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+  SET_MAINTENANCE_ITEM_VARIABLE NAME=calibrate VARIABLE=belt_tensioning VALUE=0
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro NOZZLE_PID_HIGH]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=320
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESUME_EXTERNAL_PROCESS
+  RESUME_BASE {get_params}
+
+[gcode_macro RESUME_EXTERNAL_PROCESS]
+gcode:
+  BOX_ERROR_RESUME_PROCESS
+  RESUME_EXTERNAL
+
+[gcode_macro RESUME_EXTERNAL]
+gcode:
+  {% if printer.pause_resume.resume_err is none or printer.pause_resume.resume_err|lower == 'false' %}
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    #G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  {% set E_VELOCITY = printer['filament_rack'].remain_material_velocity * 0.8 %}
+  {action_respond_info("velocity: %s" % (E_VELOCITY))}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'false' %}
+    {action_respond_info("Extruder not hot enough, SET M109 S%s" % 
+      printer['gcode_macro PRINTER_PARAM'].hotend_temp|int)}
+    M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% else %}
+    M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% endif %}
+  G91
+  M106 S0
+  G1 E{E} F{E_VELOCITY}
+  G90
+  M106 S127
+  G4 P3000
+  BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  M106 P2 S{s_value}
+  M106 P0 S{s_value_0}
+  SET_LIMITS
+  M400
+  SET_PIN PIN=extruder_fan VALUE=1
+  {% endif %}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  {action_respond_info("start END_PRINT")}
+  END_PRINT
+  {action_respond_info("end END_PRINT success")}
+  CANCEL_PRINT_BASE
+  {action_respond_info("CANCEL_PRINT success")}
+  CLEAR_EEPROM_INFO
+
+[gcode_macro MOTOR_CANCEL_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  BOX_SET_CURRENT_BOX_IDLE_MODE
+  CANCEL_PRINT_BASE
+  WAIT_TEMP_START
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  # 此处Z归位一定要下降,此次光电找平后,不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  # 每次调平在上面的重新做Z_TILT_ADJUST,才能得到新的adjustments调整值
+  # 设置标志位 ZDOWN的时候 不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  SET_G29_FLAG VALUE=1
+  G28 Z
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  # 精擦嘴后做一次光电找平获取最大Z轴高度值
+  ZDOWN_SWITCH ENABLE=1
+  G28 Z
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST WAITTIME=5
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  SET_G29_FLAG VALUE=0
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F1200
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+[gcode_macro BED_MESH_CALIBRATE_START_PRINT] # 用于打印前的归位调平
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% if 'GCODE_FILE' in params|upper %}
+    {% set get_gcode_file = ("GCODE_FILE='"+ params.GCODE_FILE + "'") %}
+  {%else %}
+    {% set get_gcode_file = "" %}
+  {% endif %}
+  {action_respond_info("get_gcode_file = %s" % (get_gcode_file))}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+
+  M106 S0  #需要关闭模型风扇
+  M104 S{extruder_temp} # 140
+  M140 S{bed_temp}  # 50
+
+  {% if "z" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    PRINT_PREPARED
+    BED_MESH_CLEAR
+    NOZZLE_CLEAR
+    NEXT_HOMEZ_NACCU
+    G28 Z
+  {% endif %}
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count} {get_gcode_file}
+  G0 Z10 F600
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  {% for _ in range(100) %}
+    M1800
+  {% endfor %}
+  
+[gcode_macro TEST_HOME]
+gcode:
+  {% for _ in range(100) %}
+    G28
+  {% endfor %} 
+    
+[gcode_macro A_TriPress_STEP1]
+gcode:
+  G28
+  G1 Z25 F600
+
+[gcode_macro A_TriPress_STEP2]
+gcode:
+  PROBE_ACCURACY PROBE_SPEED=5
+
+[gcode_macro EXTRUDE_TEST]
+gcode:
+  M104 S220
+  {% set times = params.TIMES|default(1)|int %}
+  {% for _ in range(times) %}
+    BOX_MOVE_TO_CUT
+    BOX_GO_TO_EXTRUDE_POS
+    G91
+    G0 E100 F360
+    G90
+    M400
+    # BOX_BLOW
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P4000
+    SET_PIN PIN=fan0 VALUE=0
+    M400
+    BOX_NOZZLE_CLEAN
+    # BOX_GO_TO_EXTRUDE_POS
+  {% endfor %}
+
+[gcode_macro A_G28_test] ;归零与重复探测精度测试
+gcode:
+  {% set Count = params.G28_COUNT|default(3000)|int %}
+  {% set RECount = params.COUNT|default(1000)|int %}
+
+  M109 S140
+
+  {% for _ in range(Count) %}
+      G28
+  {% endfor %}
+
+  TEST_REPROBE C={RECount}
+
+  M104 S0  
+
+
+# [gcode_macro T0]
+# rename_existing: T0.1
+# gcode:
+#   T0.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T1]
+# rename_existing: T1.1
+# gcode:
+#   T1.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T2]
+# rename_existing: T2.1
+# gcode:
+#   T2.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T3]
+# rename_existing: T3.1
+# gcode:
+#   T3.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+  
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13_1/printer.cfg
@@ -0,0 +1,440 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.29
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+forced_leveling: true
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 352.5#356 ;360
+position_min: -10 #-12
+position_max: 352.5#356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -6.2#-10#345
+position_min: -6.2#-8.5#-10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 330 #360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp: 14.296
+pid_ki: 1.271
+pid_kd: 40.206
+high_temp_value: 280
+pid_kp_high_temp: 16.443
+pid_ki_high_temp:  1.370
+pid_kd_high_temp: 49.329
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+is_ptc_fan: 1
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin extruder_fan]
+pin: nozzle_mcu: PB1   #高电平触发，默认低电平
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_closed_loop: x,y,z,z1,e
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_x_stall: PB11
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_y_stall: PB12
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z_stall: PB13
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+prth_clr_probe_pos:150,355
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.21.20.205
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+# prth_tmp_comp: 26,300,0,0.135 #默认使用非线性温度补偿功能，26,300,0,0.11 使用2.5mm不削薄应变片+提高应变片激励电压方案 #26,300,0,0.135削薄应变片 
+enable_not_linear_comp:True #是否使能温度非线性补偿功能，True使能 False不使能(使用线性补偿)
+pres_cfg_regs:60 #60（1280/128）44（640/128）56（1280/64）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+prth_tri_zacc:1000
+prth_min_fans:0.6
+# regional_prtouch_switch: False # 区域调平开关，默认True开启
+regional_prtouch_percentage:0.8
+
+[bed_mesh]
+speed: 100
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 10 # mm/s  探测速度
+rising_dist: 10 # mm  首次探测到光电后的上升距离
+safe_dist: 40 # mm  热床倾斜偏差安全值 一侧光电触发后，另一侧允许下降的距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15, PA8  # 光电触发,多个光电配置方式：endstop_pin_z: PA15, PA8... 最多支持4个
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
+
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13_1/printer_params.cfg
@@ -0,0 +1,41 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PB4 # throat fan
+# # fan0_pin: nozzle_mcu:PB3 # model fan
+# fan1_pin: PC6 # backplane fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[fan_feedback]
+fan0_pin: PC6 # PTC Fan
+fan1_pin: nozzle_mcu:PA12 # 喉管散热风扇
+fan2_pin: nozzle_mcu:PC13 # 模型散热风扇
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 350
+variable_bed_size_y: 350
+variable_bed_size_z: 350
+# 支持最高温度
+variable_nozzle_temp: 350
+variable_bed_temp: 120
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/F008_CR0CN240319C13_1/sensorless.cfg
@@ -0,0 +1,239 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        # FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      # {% else %}
+      #   FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    # FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10/
+  {% endif %}
+
+  # 计算归零中点，根据bed_mesh参数计算，适配多种不同机器
+  {% set X_s = printer.configfile.settings['bed_mesh'].mesh_min[0]|int %}
+  {% set X_e = printer.configfile.settings['bed_mesh'].mesh_max[0]|int %}
+  {% set Y_s = printer.configfile.settings['bed_mesh'].mesh_min[1]|int %}
+  {% set Y_e = printer.configfile.settings['bed_mesh'].mesh_max[1]|int %}
+
+  {% set POSITION_X = (X_e-X_s)/2+X_s|int %}
+  {% set POSITION_Y = (Y_e-Y_s)/2+Y_s|int %}
+
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (POSITION_X))}
+  {action_respond_info("y_park = %s \n" % (POSITION_Y))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z5 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  MOTOR_STALL_MODE DATA=1
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and 'Y' in params %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'y' %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'Y' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'x'%}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    {% if x_axes[2] is not defined %}
+      BOX_GO_TO_EXTRUDE_POS
+      PRES_CHECK RUN=1
+      BOX_NOZZLE_CLEAN
+      PRES_CHECK RUN=0
+    {% endif %}
+    SET_PIN PIN=extruder_fan VALUE=0
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  MOTOR_STALL_MODE DATA=2
+  MOTOR_CHECK_PROTECTION_AFTER_HOME DATA=11
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN200400C10/box.cfg
@@ -0,0 +1,96 @@
+[serial_485 serial485]
+serial: /dev/ttyS5
+baud: 230400
+
+[auto_addr]
+
+[filament_rack]
+not_pin: !PA5
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: 10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 150#200#352
+#cut_pos_x: -6.5    
+cut_pos_y: 150#352#368
+#middle_cut_pos_y:
+Tn_retrude: -10#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 138 ## #135  #料槽吐完料摆动 左边界
+clean_left_pos_y: 329 ## #378#380# 368
+clean_right_pos_x: 173 ## #160 #料槽吐完料摆动 右边界
+clean_right_pos_y: 329 ## #378#380
+clean_velocity: 12000
+box_need_clean_length:60
+cut_velocity: 30000 ##
+extrude_pos_x: 124 ## #133#135   #切换料吐料的位置
+extrude_pos_y: 329 ## #378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 295 ## #345
+safe_pos_x: 205
+clean_pos_left_x: 157 ## #157     #擦喷嘴 硅胶的左边界的坐标
+clean_pos_right_x:167 ## #172     #擦喷嘴 硅胶的右边界的坐标
+clean_pos_middle_y:327 ## #374    #擦喷嘴 硅胶的Y轴中间坐标
+check_cut_pos_x_max:-4 ## #-5    #切刀校准坐标最大坐标 的边界值
+switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[load_ai]
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_SAVE_FAN
+  BOX_RETRUDE_MATERIAL_WITH_TNN # BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+  BOX_RESTORE_FAN
+  BOX_MOVE_TO_SAFE_POS
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_RETRUDE_MATERIAL_WITH_TNN]
+rename_existing: BOX_RETRUDE_MATERIAL_WITH_TNN1
+gcode:
+  BOX_SET_TEMP
+  BOX_GO_TO_EXTRUDE_POS
+  BOX_RETRUDE_MATERIAL
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+  BOX_MOVE_TO_SAFE_POS
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN200400C10/factory_printer.cfg
@@ -0,0 +1,427 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.28
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 356 ;360
+position_min: -12
+position_max: 356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp = 14.296
+pid_ki = 1.271
+pid_kd = 40.206
+# pid_Kp:19.219  # 重新调整 填入 20240326
+# pid_Ki:2.136
+# pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_x_stall: PB11
+motor_y_stall: PB12
+motor_z_stall: PB13
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.135  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）56（1280/64）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN200400C10/gcode_macro.cfg
@@ -0,0 +1,1436 @@
+# F008
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 300.0
+variable_max_y_position: 302.0
+variable_max_z_position: 300.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+variable_bed_steady_temp: 60,80
+variable_bed_steady_time: 60,120
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM_PARAM]
+variable_cut_calibration: 10000    # 次数
+variable_shaper_calibrate: 1800000  # 秒 500小时
+variable_belt_tensioning: 3600000  # 秒 1000小时
+variable_motion_mechanism_lubrication: 1800000  # 秒
+variable_camera_maintenance: 1800000  # 秒
+variable_fan_inspection: 1800000  # 秒
+variable_nozzle: 20000  # 克
+variable_cut: 100000  # 次
+variable_machine_teflon_tube: 3600000  # 秒
+variable_wipe_mouth_strip: 1800000  # 秒
+variable_air_filter: 1800000  # 秒
+variable_cfs_teflon_tube: 3600000  # 秒
+variable_cfs_desiccant: 1800000  # 秒
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM]
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'zv','mzv','ei'
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  # SET_E_MIN_CURRENT
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  # IF_NEED_HOME
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # M104 S220
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 X0.5 F600
+  # G92 E0 ; Reset Extruder
+  # G1 E100 F600
+  # G1 E-0.5 F600
+  # G90
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P3000
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_NOZZLE_CLEAN#M1501
+  # M104 S140
+  # # BOX_GO_TO_EXTRUDE_POS#M1500
+  # # BOX_NOZZLE_CLEAN
+  # # G1 Y200 F6000
+  # G92 E0 ; Reset Extruder
+  # G90 
+  # LOAD_MATERIAL_RESTORE_FAN2
+  SAVE_GCODE_STATE NAME=myMoveState
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SAVE_FAN
+  FILAMENT_RACK_PRE_FLUSH
+  FILAMENT_RACK_SET_TEMP
+  FILAMENT_RACK_FLUSH
+  FILAMENT_RACK_RESTORE_FAN
+  SET_COOL_TEMP
+  BOX_MOVE_TO_SAFE_POS
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  # IF_NEED_HOME
+  # BOX_CUT_MATERIAL#M1502
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 E-60 F2000
+  # G90
+  # G1 Y200 F6000
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  BOX_MOVE_TO_CUT
+  M400
+  G91
+  G0 E-10 F360
+  G90
+  M400
+  BOX_MOVE_TO_SAFE_POS
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      # G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      # {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      # {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      # G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+[gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S}
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M191]
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S} WAIT=1
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0  WAIT=1
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P3000
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  # {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28
+    # 精擦嘴
+    NOZZLE_CLEAR
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{params.BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    # Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    # 精归零
+    NEXT_HOMEZ_NACCU
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M140 S{params.BED_TEMP}
+  M220 S100 ;Reset Feedrate
+  # M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+  SET_PIN PIN=extruder_fan VALUE=1
+  SET_PIN PIN=filter_fan VALUE=1
+  SET_PIN PIN=board_dissipation_fan VALUE=1
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {action_respond_info("END_PRINT_POINT act_z:%s, max_z:%s \n" % (act_z, max_z))}
+    {% if act_z < (max_z - 5) %}
+        {action_respond_info("END_PRINT_POINT G1 Z2.0 F600 \n")}
+        G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    # G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M106 P0 S127
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  SET_PIN PIN=filter_fan VALUE=0
+  SET_PIN PIN=board_dissipation_fan VALUE=0
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    PAUSE_BASE
+    PAUSE_EXTERNAL
+  {% endif %}
+
+[gcode_macro PAUSE_EXTERNAL]
+gcode:
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    M400
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+      BOX_MOVE_TO_SAFE_POS
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['output_pin fan2'].value %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['output_pin fan0'].value %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+    SET_PIN PIN=extruder_fan VALUE=0
+
+[gcode_macro CALIBRATE_CUT_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  SET_LIMITS
+  MOTOR_CHECK_CUT_POS
+  M400
+  RESTORE_LIMITS
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+  SET_MAINTENANCE_ITEM_VARIABLE NAME=calibrate VARIABLE=belt_tensioning VALUE=0
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro NOZZLE_PID_HIGH]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=320
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESUME_EXTERNAL_PROCESS
+  RESUME_BASE {get_params}
+
+[gcode_macro RESUME_EXTERNAL_PROCESS]
+gcode:
+  BOX_ERROR_RESUME_PROCESS
+  RESUME_EXTERNAL
+
+[gcode_macro RESUME_EXTERNAL]
+gcode:
+  {% if printer.pause_resume.resume_err is none or printer.pause_resume.resume_err|lower == 'false' %}
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    #G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  {% set E_VELOCITY = printer['filament_rack'].remain_material_velocity * 0.8 %}
+  {action_respond_info("velocity: %s" % (E_VELOCITY))}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'false' %}
+    {action_respond_info("Extruder not hot enough, SET M109 S%s" % 
+      printer['gcode_macro PRINTER_PARAM'].hotend_temp|int)}
+    M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% else %}
+    M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% endif %}
+  G91
+  M106 S0
+  G1 E{E} F{E_VELOCITY}
+  G90
+  M106 S127
+  G4 P3000
+  BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  M106 P2 S{s_value}
+  M106 P0 S{s_value_0}
+  SET_LIMITS
+  M400
+  SET_PIN PIN=extruder_fan VALUE=1
+  {% endif %}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  {action_respond_info("start END_PRINT")}
+  END_PRINT
+  {action_respond_info("end END_PRINT success")}
+  CANCEL_PRINT_BASE
+  {action_respond_info("CANCEL_PRINT success")}
+  CLEAR_EEPROM_INFO
+
+[gcode_macro MOTOR_CANCEL_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  BOX_SET_CURRENT_BOX_IDLE_MODE
+  CANCEL_PRINT_BASE
+  WAIT_TEMP_START
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  # 此处Z归位一定要下降,此次光电找平后,不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  # 每次调平在上面的重新做Z_TILT_ADJUST,才能得到新的adjustments调整值
+  # 设置标志位 ZDOWN的时候 不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  SET_G29_FLAG VALUE=1
+  G28 Z
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  # 精擦嘴后做一次光电找平获取最大Z轴高度值
+  ZDOWN_SWITCH ENABLE=1
+  G28 Z
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST WAITTIME=5
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  SET_G29_FLAG VALUE=0
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F600
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+[gcode_macro BED_MESH_CALIBRATE_START_PRINT] # 用于打印前的归位调平
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% if 'GCODE_FILE' in params|upper %}
+    {% set get_gcode_file = ("GCODE_FILE='"+ params.GCODE_FILE + "'") %}
+  {%else %}
+    {% set get_gcode_file = "" %}
+  {% endif %}
+  {action_respond_info("get_gcode_file = %s" % (get_gcode_file))}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+
+  M106 S0  #需要关闭模型风扇
+  M104 S{extruder_temp} # 140
+  M140 S{bed_temp}  # 50
+
+  {% if "z" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    PRINT_PREPARED
+    BED_MESH_CLEAR
+    NOZZLE_CLEAR
+    NEXT_HOMEZ_NACCU
+    G28 Z
+  {% endif %}
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count} {get_gcode_file}
+  G0 Z10 F600
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  {% for _ in range(100) %}
+    M1800
+  {% endfor %}
+  
+[gcode_macro TEST_HOME]
+gcode:
+  {% for _ in range(100) %}
+    G28
+  {% endfor %} 
+    
+[gcode_macro A_TriPress_STEP1]
+gcode:
+  G28
+  G1 Z25 F600
+
+[gcode_macro A_TriPress_STEP2]
+gcode:
+  PROBE_ACCURACY PROBE_SPEED=5
+
+[gcode_macro EXTRUDE_TEST]
+gcode:
+  M104 S220
+  {% set times = params.TIMES|default(1)|int %}
+  {% for _ in range(times) %}
+    BOX_MOVE_TO_CUT
+    BOX_GO_TO_EXTRUDE_POS
+    G91
+    G0 E100 F360
+    G90
+    M400
+    # BOX_BLOW
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P4000
+    SET_PIN PIN=fan0 VALUE=0
+    M400
+    BOX_NOZZLE_CLEAN
+    # BOX_GO_TO_EXTRUDE_POS
+  {% endfor %}
+
+[gcode_macro A_G28_test] ;归零与重复探测精度测试
+gcode:
+  {% set Count = params.G28_COUNT|default(3000)|int %}
+  {% set RECount = params.COUNT|default(1000)|int %}
+
+  M109 S140
+
+  {% for _ in range(Count) %}
+      G28
+  {% endfor %}
+
+  TEST_REPROBE C={RECount}
+
+  M104 S0  
+
+
+# [gcode_macro T0]
+# rename_existing: T0.1
+# gcode:
+#   T0.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T1]
+# rename_existing: T1.1
+# gcode:
+#   T1.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T2]
+# rename_existing: T2.1
+# gcode:
+#   T2.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T3]
+# rename_existing: T3.1
+# gcode:
+#   T3.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+
+[delayed_gcode STARTUP_READ_FILAMENT_RACK_RFID] #开机读RFID，防止开机过程中扫描RFID后，RFID失效问题
+initial_duration: 2
+gcode:
+  {action_respond_info("STARTUP_READ_FILAMENT_RACK_RFID")}
+  FILAMENT_RACK
+  
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN200400C10/printer.cfg
@@ -0,0 +1,482 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.13
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+#hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+# offset_value: -0.1   # 断电续打Z轴补偿值，解决过压层
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 302## #352.5#356 ;360
+position_min: -13 ## #-12
+position_max: 302## #352.5#356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA8
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -6.5## #-6.2#-10#345
+position_min: -6.5## #-6.2#-8.5#-10
+position_max: 332## #400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PA10
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 303
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[tmc2208 stepper_z]
+uart_pin: PC1
+# uart_address: 3
+run_current: 0.84 #0.8
+# diag_pin: ^PB13
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+# driver_SGTHRS: 0
+
+# [stepper_z1]
+# step_pin: PB15
+# dir_pin: PA1
+# enable_pin: !PA9
+# microsteps: 16
+# rotation_distance:8
+# endstop_pin: probe:z_virtual_endstop 
+
+# [z_tilt]
+# z_positions:
+#     -15,175
+#     375,175
+# points:
+#     5,175
+#     345,175
+  
+# speed: 300
+# horizontal_move_z: 5
+# retries: 10
+# retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:98633
+temperature2:220
+resistance2:377
+temperature3:320
+resistance3:73
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp: 26.861
+pid_ki: 3.035
+pid_kd: 59.429
+high_temp_value: 280
+pid_kp_high_temp: 28.227
+pid_ki_high_temp: 2.767
+pid_kd_high_temp: 71.978
+min_temp:-30# 0  20240326
+max_temp:390
+
+# 因整机无法满足热床温度要求，修改热敏数据表，达到温度要求
+[thermistor custom_bed_thermistor]
+temperature1: 25
+resistance1: 100000
+temperature2: 50
+resistance2: 29709.6
+temperature3: 100
+resistance3: 4931.9
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: custom_bed_thermistor
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PB3
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+is_ptc_fan: 1
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[output_pin filter_fan] # F012的过滤风扇
+pin: PB1
+
+[output_pin board_dissipation_fan] # 主板散热风扇
+pin: PA0
+
+[duplicate_pin_override]
+pins: PC5,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB3
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[multi_pin filter_fan]
+  pins:PB1,PB3
+
+[temperature_fan chamber_fan]
+pin: PB3
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin extruder_fan]
+pin: nozzle_mcu: PB1   #高电平触发，默认低电平
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+# motor_closed_loop: x,y,z,z1,e
+motor_closed_loop: x,y,e
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_x_stall: PB11
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_y_stall: PB12
+# motor_z_dir: PB5,0
+# motor_z_step: PB6,1
+# motor_z_stall: PB13
+# motor_z1_dir: PA1,1
+# motor_z1_step: PB15,1
+# motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   150,150,150 #175,175,10
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+# prth_clr_probe_pos:150,355
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.21.20.205
+
+temp_non_linaer_a = 0.00002375
+temp_non_linaer_b = -0.003775 
+temp_non_linaer_c = 0.165
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+# prth_tmp_comp: 26,300,0,0.135 #默认使用非线性温度补偿功能，26,300,0,0.11 使用2.5mm不削薄应变片+提高应变片激励电压方案 #26,300,0,0.135削薄应变片 
+enable_not_linear_comp:True #是否使能温度非线性补偿功能，True使能 False不使能(使用线性补偿)
+pres_cfg_regs:60 #60（1280/128）44（640/128）56（1280/64）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+prth_tri_zacc:1000
+prth_min_fans:0.6
+
+prth_clr_brush_pos = 160, 326.5 ## #硅胶刷上擦拭区的中间位置
+prth_clr_probe_pos = 145, 306.5 ## #热床上擦拭区的附近位置探测高度
+prth_clr_pose = 170, 306.5, 10 ## #热床上喷头擦拭区的位置
+
+# regional_prtouch_switch: False # 区域调平开关，默认True开启
+
+[bed_mesh]
+speed: 100
+mesh_min: 5,5 ##
+mesh_max: 295,295 ##
+probe_count:7,7
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800#600 ## #800
+max_accel: 20000#10000 ## #30000
+max_accel_to_decel: 20000#10000 ## #30000
+max_z_velocity: 10 #30
+square_corner_velocity: 10
+max_z_accel: 300 #1000 #100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 10 # mm/s  下降速度
+slow_speed: 10 # mm/s  探测速度
+rising_dist: 10 # mm  首次探测到光电后的上升距离
+safe_dist: 40 # mm  热床倾斜偏差安全值 一侧光电触发后，另一侧允许下降的距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 80 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发,多个光电配置方式：endstop_pin_z: PA15, PA8... 最多支持4个
+zd_up: 1  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 2 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+# [gcode_button z2]
+# pin: PA8
+# press_gcode:
+#   {action_respond_info("z2 Photoelectric switch not triggered")}
+# release_gcode:
+#   {action_respond_info("z2 Photoelectric switch triggered")}
+
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN200400C10/printer_params.cfg
@@ -0,0 +1,41 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PB4 # throat fan
+# # fan0_pin: nozzle_mcu:PB3 # model fan
+# fan1_pin: PC6 # backplane fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[fan_feedback]
+fan0_pin: PC6,PB15 # PTC Fan
+fan1_pin: nozzle_mcu:PA12 # 喉管散热风扇
+fan2_pin: nozzle_mcu:PC13 # 模型散热风扇
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 300
+variable_bed_size_y: 300
+variable_bed_size_z: 300
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 110
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN200400C10/sensorless.cfg
@@ -0,0 +1,239 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  # 计算归零中点，根据bed_mesh参数计算，适配多种不同机器
+  {% set X_s = printer.configfile.settings['bed_mesh'].mesh_min[0]|int %}
+  {% set X_e = printer.configfile.settings['bed_mesh'].mesh_max[0]|int %}
+  {% set Y_s = printer.configfile.settings['bed_mesh'].mesh_min[1]|int %}
+  {% set Y_e = printer.configfile.settings['bed_mesh'].mesh_max[1]|int %}
+
+  {% set POSITION_X = (X_e-X_s)/2+X_s|int %}
+  {% set POSITION_Y = (Y_e-Y_s)/2+Y_s|int %}
+
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (POSITION_X))}
+  {action_respond_info("y_park = %s \n" % (POSITION_Y))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z5 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  MOTOR_STALL_MODE DATA=1
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and 'Y' in params %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'y' %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'Y' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'x'%}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    {% if x_axes[2] is not defined %}
+      BOX_GO_TO_EXTRUDE_POS
+      PRES_CHECK RUN=1
+      BOX_NOZZLE_CLEAN
+      PRES_CHECK RUN=0
+    {% endif %}
+    SET_PIN PIN=extruder_fan VALUE=0
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  MOTOR_STALL_MODE DATA=2
+  MOTOR_CHECK_PROTECTION_AFTER_HOME DATA=11
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN240319C13/box.cfg
@@ -0,0 +1,93 @@
+[serial_485 serial485]
+serial: /dev/ttyS5
+baud: 230400
+
+[auto_addr]
+
+[filament_rack]
+not_pin: !PA5
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: 0 ## #10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 200 ## #200#200#352
+# cut_pos_x: -6.5    
+cut_pos_y: 200 ## #200#352#368
+#middle_cut_pos_y:
+Tn_retrude: -6#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 130 ## #135  #料槽吐完料摆动 左边界
+clean_left_pos_y: 327.5 ## #378#380# 368
+clean_right_pos_x: 170 ## #160 #料槽吐完料摆动 右边界
+clean_right_pos_y: 327.5 ## #378#380
+clean_velocity: 12000
+box_need_clean_length:60
+cut_velocity: 30000 ##
+extrude_pos_x: 137 ## #133#135   #切换料吐料的位置
+extrude_pos_y: 327.5 ## #378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 295 ## #345
+safe_pos_x: 205
+clean_pos_left_x: 150 ## #157     #擦喷嘴 硅胶的左边界的坐标
+clean_pos_right_x:165 ## #172     #擦喷嘴 硅胶的右边界的坐标
+clean_pos_middle_y:320 ## #374    #擦喷嘴 硅胶的Y轴中间坐标
+check_cut_pos_x_max:-4 ## #-5    #切刀校准坐标最大坐标 的边界值
+switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[load_ai]
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN # BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_RETRUDE_MATERIAL_WITH_TNN]
+rename_existing: BOX_RETRUDE_MATERIAL_WITH_TNN1
+gcode:
+  BOX_SET_TEMP
+  BOX_GO_TO_EXTRUDE_POS
+  BOX_RETRUDE_MATERIAL
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN240319C13/factory_printer.cfg
@@ -0,0 +1,427 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.28
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 356 ;360
+position_min: -12
+position_max: 356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp = 14.296
+pid_ki = 1.271
+pid_kd = 40.206
+# pid_Kp:19.219  # 重新调整 填入 20240326
+# pid_Ki:2.136
+# pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_x_stall: PB11
+motor_y_stall: PB12
+motor_z_stall: PB13
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.135  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）56（1280/64）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN240319C13/gcode_macro.cfg
@@ -0,0 +1,1309 @@
+# F008
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 310.0 ##
+variable_max_y_position: 325.0 ##
+variable_max_z_position: 300.0 ##
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'zv','mzv','ei'
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  # SET_E_MIN_CURRENT
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  # IF_NEED_HOME
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # M104 S220
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 X0.5 F600
+  # G92 E0 ; Reset Extruder
+  # G1 E100 F600
+  # G1 E-0.5 F600
+  # G90
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P3000
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_NOZZLE_CLEAN#M1501
+  # M104 S140
+  # # BOX_GO_TO_EXTRUDE_POS#M1500
+  # # BOX_NOZZLE_CLEAN
+  # # G1 Y200 F6000
+  # G92 E0 ; Reset Extruder
+  # G90 
+  # LOAD_MATERIAL_RESTORE_FAN2
+  SAVE_GCODE_STATE NAME=myMoveState
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  FILAMENT_RACK_FLUSH
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  # IF_NEED_HOME
+  # BOX_CUT_MATERIAL#M1502
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 E-60 F2000
+  # G90
+  # G1 Y200 F6000
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  BOX_MOVE_TO_CUT
+  M400
+  G91
+  G0 E-10 F360
+  G90
+  M400
+  BOX_MOVE_TO_SAFE_POS
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+
+    #   SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+    #   SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+    #   SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+    #   SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+    #   G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+    #   {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+    #   {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+    #   SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+    #   SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+    #   SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+    #   SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+    #   G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+# [gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+# gcode:
+#   {% if 'S' in params|upper %}
+#     {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+#       SET_PIN PIN=fan1 VALUE=255
+#     {% else %}
+#       SET_PIN PIN=fan1 VALUE=0
+#     {% endif %}
+#     {% if params.S|int > 40 %}
+#       SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+#       SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S}
+#     {% elif params.S|int > 0 %}
+#       SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+#       SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+#     {% else %}
+#       SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+#       SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+#       {% if params.S|int == 0 %}
+#         SET_PIN PIN=fan1 VALUE=0
+#       {% endif %}
+#     {% endif %}
+#   {% endif %}
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P3000
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  # {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28
+    # 精擦嘴
+    NOZZLE_CLEAR
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{params.BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    # Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    # 精归零
+    NEXT_HOMEZ_NACCU
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M140 S{params.BED_TEMP}
+  M220 S100 ;Reset Feedrate
+  # M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+  SET_PIN PIN=extruder_fan VALUE=1
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {action_respond_info("END_PRINT_POINT act_z:%s, max_z:%s \n" % (act_z, max_z))}
+    {% if act_z < (max_z - 5) %}
+        {action_respond_info("END_PRINT_POINT G1 Z2.0 F600 \n")}
+        G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    # G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    PAUSE_BASE
+    M400
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+      BOX_MOVE_TO_SAFE_POS
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan0_speed %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+    SET_PIN PIN=extruder_fan VALUE=0
+  {% endif %}
+
+[gcode_macro CALIBRATE_CUT_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  SET_LIMITS
+  MOTOR_CHECK_CUT_POS
+  M400
+  RESTORE_LIMITS
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  CALIBRATE_CUT_POS
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro NOZZLE_PID_HIGH]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=320
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'false' %}
+    {action_respond_info("Extruder not hot enough, SET M109 S%s" % 
+      printer['gcode_macro PRINTER_PARAM'].hotend_temp|int)}
+    M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% else %}
+    M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% endif %}
+  G91
+  M106 S0
+  G1 E{E} F600
+  G90
+  M106 S127
+  G4 P3000
+  BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  M106 P2 S{s_value}
+  M106 P0 S{s_value_0}
+  SET_LIMITS
+  M400
+  RESUME_BASE {get_params}
+  SET_PIN PIN=extruder_fan VALUE=1
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  {action_respond_info("start END_PRINT")}
+  END_PRINT
+  {action_respond_info("end END_PRINT success")}
+  CANCEL_PRINT_BASE
+  {action_respond_info("CANCEL_PRINT success")}
+
+[gcode_macro MOTOR_CANCEL_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  BOX_SET_CURRENT_BOX_IDLE_MODE
+  CANCEL_PRINT_BASE
+  WAIT_TEMP_START
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  # 此处Z归位一定要下降,此次光电找平后,不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  # 每次调平在上面的重新做Z_TILT_ADJUST,才能得到新的adjustments调整值
+  # 设置标志位 ZDOWN的时候 不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  SET_G29_FLAG VALUE=1
+  G28 Z
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  # 精擦嘴后做一次光电找平获取最大Z轴高度值
+  ZDOWN_SWITCH ENABLE=1
+  G28 Z
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  SET_G29_FLAG VALUE=0
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F1200
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+[gcode_macro BED_MESH_CALIBRATE_START_PRINT] # 用于打印前的归位调平
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+
+  M106 S0  #需要关闭模型风扇
+  PRINT_PREPARED
+  M104 S{extruder_temp} # 140
+  M140 S{bed_temp}  # 50
+
+  {% if "z" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  BED_MESH_CLEAR
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G0 Z10 F600
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  {% for _ in range(100) %}
+    M1800
+  {% endfor %}
+  
+[gcode_macro TEST_HOME]
+gcode:
+  {% for _ in range(100) %}
+    G28
+  {% endfor %} 
+    
+[gcode_macro A_TriPress_STEP1]
+gcode:
+  G28
+  G1 Z25 F600
+
+[gcode_macro A_TriPress_STEP2]
+gcode:
+  PROBE_ACCURACY PROBE_SPEED=5
+
+[gcode_macro EXTRUDE_TEST]
+gcode:
+  M104 S220
+  {% set times = params.TIMES|default(1)|int %}
+  {% for _ in range(times) %}
+    BOX_MOVE_TO_CUT
+    BOX_GO_TO_EXTRUDE_POS
+    G91
+    G0 E100 F360
+    G90
+    M400
+    # BOX_BLOW
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P4000
+    SET_PIN PIN=fan0 VALUE=0
+    M400
+    BOX_NOZZLE_CLEAN
+    # BOX_GO_TO_EXTRUDE_POS
+  {% endfor %}
+
+[gcode_macro A_G28_test] ;归零与重复探测精度测试
+gcode:
+  {% set Count = params.G28_COUNT|default(3000)|int %}
+  {% set RECount = params.COUNT|default(1000)|int %}
+
+  M109 S140
+
+  {% for _ in range(Count) %}
+      G28
+  {% endfor %}
+
+  TEST_REPROBE C={RECount}
+
+  M104 S0  
+
+
+# [gcode_macro T0]
+# rename_existing: T0.1
+# gcode:
+#   T0.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+
+# [gcode_macro T1]
+# rename_existing: T1.1
+# gcode:
+#   T1.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+
+# [gcode_macro T2]
+# rename_existing: T2.1
+# gcode:
+#   T2.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+
+# [gcode_macro T3]
+# rename_existing: T3.1
+# gcode:
+#   T3.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+  
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN240319C13/printer.cfg
@@ -0,0 +1,451 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.1
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+#hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 303## #352.5#356 ;360
+position_min: -8## #-12
+position_max: 303## #352.5#356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -5.5## #-6.2#-10#345
+position_min: -5.5## #-6.2#-8.5#-10
+position_max: 327.5## #400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 300
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+# [stepper_z1]
+# step_pin: PB15
+# dir_pin: PA1
+# enable_pin: !PA9
+# microsteps: 16
+# rotation_distance:8
+# endstop_pin: probe:z_virtual_endstop 
+
+# [z_tilt]
+# z_positions:
+#     -15,175
+#     375,175
+# points:
+#     5,175
+#     345,175
+  
+# speed: 300
+# horizontal_move_z: 5
+# retries: 10
+# retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+# F008
+# temperature1:25
+# resistance1:260000
+# temperature2:220
+# resistance2:738
+# temperature3:350
+# resistance3:98
+
+# F021/F012
+temperature1:25
+resistance1:98633
+temperature2:220
+resistance2:377
+temperature3:320
+resistance3:73
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp: 14.296
+pid_ki: 1.271
+pid_kd: 40.206
+high_temp_value: 280
+pid_kp_high_temp: 16.443
+pid_ki_high_temp:  1.370
+pid_kd_high_temp: 49.329
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+# [heater_fan chamber_fan]
+# pin: !PB14   
+# enable_pin: PB2   
+# heater:chamber_heater
+# heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+# [temperature_sensor chamber_temp]
+# sensor_type: EPCOS 100K B57560G104F
+# sensor_pin: PC5
+# min_temp: -30 #-100  20240326
+# max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+# [heater_generic chamber_heater]
+# heater_pin:PC12  
+# max_power:1.0
+# sensor_type:NTC 100K MGB18-104F39050L32 
+# sensor_pin:PC5 
+# control: watermark
+# # control: pid
+# # pid_Kp: 37
+# # pid_Ki: 0.18
+# # pid_Kd: 280
+# min_temp:-30 #-100 20240326
+# max_temp:80
+
+# [verify_heater chamber_heater] 
+# max_error: 80 #120  20240326
+# check_gain_time:345600
+# hysteresis: 15
+# heating_gain: 1
+
+# [temperature_fan chamber_fan]  #-跟玉山核对 20240326
+# pin: PA0
+# cycle_time: 0.0100
+# hardware_pwm: false
+# max_power: 1
+# shutdown_speed: 0
+# sensor_type: EPCOS 100K B57560G104F
+# sensor_pin: PC5
+# # sensor_pin: nozzle_mcu:PA0
+# min_temp: -30 #-100 20240326
+# max_temp: 80
+# control: watermark
+# max_delta: 2
+# target_temp: 35.0
+# max_speed: 1.0
+# min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin extruder_fan]
+pin: nozzle_mcu: PB1   #高电平触发，默认低电平
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+# motor_closed_loop: x,y,z,z1,e
+motor_closed_loop: x,y,e
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_x_stall: PB11
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_y_stall: PB12
+# motor_z_dir: PB5,0
+# motor_z_step: PB6,1
+# motor_z_stall: PB13
+# motor_z1_dir: PA1,1
+# motor_z1_step: PB15,1
+# motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.21.20.205
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+# prth_tmp_comp: 26,300,0,0.135 #默认使用非线性温度补偿功能，26,300,0,0.11 使用2.5mm不削薄应变片+提高应变片激励电压方案 #26,300,0,0.135削薄应变片 
+enable_not_linear_comp:True #是否使能温度非线性补偿功能，True使能 False不使能(使用线性补偿)
+pres_cfg_regs:60 #60（1280/128）44（640/128）56（1280/64）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+prth_tri_zacc:1000
+prth_min_fans:0.6
+
+prth_clr_brush_pos = 165, 327.5 ## #硅胶刷上擦拭区的中间位置
+prth_clr_probe_pos = 185, 303.5 ## #热床上擦拭区的附近位置探测高度
+prth_clr_pose = 185, 303.5, 10 ## #热床上喷头擦拭区的位置
+
+[bed_mesh]
+speed: 100
+mesh_min: 5,5 ##
+mesh_max: 285,285 ##
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800#600 ## #800
+max_accel: 30000#10000 ## #30000
+max_accel_to_decel: 30000#10000 ## #30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+# [z_align]
+# distance_ratio: 0.85  # 向上快速运动距离的比例系数
+# quick_speed: 30 # mm/s  下降速度
+# slow_speed: 10 # mm/s  探测速度
+# rising_dist: 10 # mm  首次探测到光电后的上升距离
+# filter_cnt: 10 # 连续触发限位的次数，用作滤波
+# timeout: 30 # s 单次探测超时时间
+# retries: 5 # 重试次数
+# retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+# endstop_pin_z: PA15  # 光电触发
+# endstop_pin_z1: PA8  # 光电触发
+# zd_up: 0  # 步进电机远离限位开关的电平
+# zes_untrig: 1  # 限位开关未触发时的电平
+# zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN240319C13/printer_params.cfg
@@ -0,0 +1,41 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PB4 # throat fan
+# # fan0_pin: nozzle_mcu:PB3 # model fan
+# fan1_pin: PC6 # backplane fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[fan_feedback]
+fan0_pin: PC6 # PTC Fan
+fan1_pin: nozzle_mcu:PA12 # 喉管散热风扇
+fan2_pin: nozzle_mcu:PC13 # 模型散热风扇
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 300
+variable_bed_size_y: 300
+variable_bed_size_z: 300
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/F012_CR0CN240319C13/sensorless.cfg
@@ -0,0 +1,239 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        # FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      # {% else %}
+      #   FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    # FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10/
+  {% endif %}
+
+  # 计算归零中点，根据bed_mesh参数计算，适配多种不同机器
+  {% set X_s = printer.configfile.settings['bed_mesh'].mesh_min[0]|int %}
+  {% set X_e = printer.configfile.settings['bed_mesh'].mesh_max[0]|int %}
+  {% set Y_s = printer.configfile.settings['bed_mesh'].mesh_min[1]|int %}
+  {% set Y_e = printer.configfile.settings['bed_mesh'].mesh_max[1]|int %}
+
+  {% set POSITION_X = (X_e-X_s)/2+X_s|int %}
+  {% set POSITION_Y = (Y_e-Y_s)/2+Y_s|int %}
+
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (POSITION_X))}
+  {action_respond_info("y_park = %s \n" % (POSITION_Y))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z5 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  MOTOR_STALL_MODE DATA=1
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and 'Y' in params %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'y' %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'Y' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'x'%}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    {% if x_axes[2] is not defined %}
+      BOX_GO_TO_EXTRUDE_POS
+      PRES_CHECK RUN=1
+      BOX_NOZZLE_CLEAN
+      PRES_CHECK RUN=0
+    {% endif %}
+    SET_PIN PIN=extruder_fan VALUE=0
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  MOTOR_STALL_MODE DATA=2
+  MOTOR_CHECK_PROTECTION_AFTER_HOME DATA=11
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN200400C10/box.cfg
@@ -0,0 +1,96 @@
+[serial_485 serial485]
+serial: /dev/ttyS5
+baud: 230400
+
+[auto_addr]
+
+[filament_rack]
+not_pin: !PA5
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: 10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 150 ## #200#200#352
+#cut_pos_x: -6.5    
+cut_pos_y: 150#200#352#368
+#middle_cut_pos_y:
+Tn_retrude: -10#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 127 ## 120#135  #料槽吐完料摆动 左边界
+clean_left_pos_y: 291.5 ## #230 #378#380# 368
+clean_right_pos_x: 137 ## #160 #料槽吐完料摆动 右边界
+clean_right_pos_y: 291.5 ## #230 #378#380
+clean_velocity: 12000 ## #12000
+box_need_clean_length:70
+cut_velocity: 30000 ## 12000
+extrude_pos_x: 115 ## 120#135   #切换料吐料的位置
+extrude_pos_y: 291.5 ## 378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 256 ## #220 #345
+safe_pos_x: 205
+clean_pos_left_x: 145#130     #擦喷嘴 硅胶的左边界的坐标
+clean_pos_right_x:155#150     #擦喷嘴 硅胶的右边界的坐标
+clean_pos_middle_y:291.5 #285 #374    #擦喷嘴 硅胶的Y轴中间坐标
+check_cut_pos_x_max:-5#-5    #切刀校准坐标最大坐标 的边界值
+switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[load_ai]
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_SAVE_FAN
+  BOX_RETRUDE_MATERIAL_WITH_TNN # BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+  BOX_RESTORE_FAN
+  BOX_MOVE_TO_SAFE_POS
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_RETRUDE_MATERIAL_WITH_TNN]
+rename_existing: BOX_RETRUDE_MATERIAL_WITH_TNN1
+gcode:
+  BOX_SET_TEMP
+  BOX_GO_TO_EXTRUDE_POS
+  BOX_RETRUDE_MATERIAL
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+  BOX_MOVE_TO_SAFE_POS
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN200400C10/factory_printer.cfg
@@ -0,0 +1,427 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.28
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 356 ;360
+position_min: -12
+position_max: 356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp = 14.296
+pid_ki = 1.271
+pid_kd = 40.206
+# pid_Kp:19.219  # 重新调整 填入 20240326
+# pid_Ki:2.136
+# pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_x_stall: PB11
+motor_y_stall: PB12
+motor_z_stall: PB13
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.135  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）56（1280/64）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN200400C10/gcode_macro.cfg
@@ -0,0 +1,1406 @@
+# F008
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 260.0
+variable_max_y_position: 262.0
+variable_max_z_position: 260.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+variable_bed_steady_temp: 60,80
+variable_bed_steady_time: 60,120
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM_PARAM]
+variable_cut_calibration: 10000    # 次数
+variable_shaper_calibrate: 1800000  # 秒 500小时
+variable_belt_tensioning: 3600000  # 秒 1000小时
+variable_motion_mechanism_lubrication: 1800000  # 秒
+variable_camera_maintenance: 1800000  # 秒
+variable_fan_inspection: 1800000  # 秒
+variable_nozzle: 20000  # 克
+variable_cut: 100000  # 次
+variable_machine_teflon_tube: 3600000  # 秒
+variable_wipe_mouth_strip: 1800000  # 秒
+variable_air_filter: 1800000  # 秒
+variable_cfs_teflon_tube: 3600000  # 秒
+variable_cfs_desiccant: 1800000  # 秒
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM]
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'zv','mzv','ei'
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  # SET_E_MIN_CURRENT
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  # IF_NEED_HOME
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # M104 S220
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 X0.5 F600
+  # G92 E0 ; Reset Extruder
+  # G1 E100 F600
+  # G1 E-0.5 F600
+  # G90
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P3000
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_NOZZLE_CLEAN#M1501
+  # M104 S140
+  # # BOX_GO_TO_EXTRUDE_POS#M1500
+  # # BOX_NOZZLE_CLEAN
+  # # G1 Y200 F6000
+  # G92 E0 ; Reset Extruder
+  # G90 
+  # LOAD_MATERIAL_RESTORE_FAN2
+  SAVE_GCODE_STATE NAME=myMoveState
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SAVE_FAN
+  FILAMENT_RACK_PRE_FLUSH
+  FILAMENT_RACK_SET_TEMP
+  FILAMENT_RACK_FLUSH
+  FILAMENT_RACK_RESTORE_FAN
+  SET_COOL_TEMP
+  BOX_MOVE_TO_SAFE_POS
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  # IF_NEED_HOME
+  # BOX_CUT_MATERIAL#M1502
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 E-60 F2000
+  # G90
+  # G1 Y200 F6000
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  BOX_MOVE_TO_CUT
+  M400
+  G91
+  G0 E-10 F360
+  G90
+  M400
+  BOX_MOVE_TO_SAFE_POS
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      # G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      # {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      # {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      # G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+[gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_PIN PIN=fan1 VALUE=0
+      SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M191]
+gcode:
+  M141
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P3000
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  # {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28
+    # 精擦嘴
+    NOZZLE_CLEAR
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{params.BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    # Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    # 精归零
+    NEXT_HOMEZ_NACCU
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M140 S{params.BED_TEMP}
+  M220 S100 ;Reset Feedrate
+  # M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+  SET_PIN PIN=extruder_fan VALUE=1
+  SET_PIN PIN=filter_fan VALUE=1
+  SET_PIN PIN=board_dissipation_fan VALUE=1
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {action_respond_info("END_PRINT_POINT act_z:%s, max_z:%s \n" % (act_z, max_z))}
+    {% if act_z < (max_z - 5) %}
+        {action_respond_info("END_PRINT_POINT G1 Z2.0 F600 \n")}
+        G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    # G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M106 P0 S127
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  SET_PIN PIN=filter_fan VALUE=0
+  SET_PIN PIN=board_dissipation_fan VALUE=0
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    PAUSE_BASE
+    PAUSE_EXTERNAL
+  {% endif %}
+
+[gcode_macro PAUSE_EXTERNAL]
+gcode:
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    M400
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+      BOX_MOVE_TO_SAFE_POS
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['output_pin fan2'].value %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['output_pin fan0'].value %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+    SET_PIN PIN=extruder_fan VALUE=0
+
+[gcode_macro CALIBRATE_CUT_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  SET_LIMITS
+  MOTOR_CHECK_CUT_POS
+  M400
+  RESTORE_LIMITS
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+  SET_MAINTENANCE_ITEM_VARIABLE NAME=calibrate VARIABLE=belt_tensioning VALUE=0
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro NOZZLE_PID_HIGH]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=290
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESUME_EXTERNAL_PROCESS
+  RESUME_BASE {get_params}
+
+[gcode_macro RESUME_EXTERNAL_PROCESS]
+gcode:
+  BOX_ERROR_RESUME_PROCESS
+  RESUME_EXTERNAL
+
+[gcode_macro RESUME_EXTERNAL]
+gcode:
+  {% if printer.pause_resume.resume_err is none or printer.pause_resume.resume_err|lower == 'false' %}
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    #G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  {% set E_VELOCITY = printer['filament_rack'].remain_material_velocity * 0.8 %}
+  {action_respond_info("velocity: %s" % (E_VELOCITY))}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'false' %}
+    {action_respond_info("Extruder not hot enough, SET M109 S%s" % 
+      printer['gcode_macro PRINTER_PARAM'].hotend_temp|int)}
+    M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% else %}
+    M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% endif %}
+  G91
+  M106 S0
+  G1 E{E} F{E_VELOCITY}
+  G90
+  M106 S127
+  G4 P3000
+  BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  M106 P2 S{s_value}
+  M106 P0 S{s_value_0}
+  SET_LIMITS
+  M400
+  SET_PIN PIN=extruder_fan VALUE=1
+  {% endif %}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  {action_respond_info("start END_PRINT")}
+  END_PRINT
+  {action_respond_info("end END_PRINT success")}
+  CANCEL_PRINT_BASE
+  {action_respond_info("CANCEL_PRINT success")}
+  CLEAR_EEPROM_INFO
+
+[gcode_macro MOTOR_CANCEL_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  BOX_SET_CURRENT_BOX_IDLE_MODE
+  CANCEL_PRINT_BASE
+  WAIT_TEMP_START
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  # 此处Z归位一定要下降,此次光电找平后,不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  # 每次调平在上面的重新做Z_TILT_ADJUST,才能得到新的adjustments调整值
+  # 设置标志位 ZDOWN的时候 不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  SET_G29_FLAG VALUE=1
+  G28 Z
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  # 精擦嘴后做一次光电找平获取最大Z轴高度值
+  ZDOWN_SWITCH ENABLE=1
+  G28 Z
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST WAITTIME=5
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  SET_G29_FLAG VALUE=0
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F600
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+[gcode_macro BED_MESH_CALIBRATE_START_PRINT] # 用于打印前的归位调平
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% if 'GCODE_FILE' in params|upper %}
+    {% set get_gcode_file = ("GCODE_FILE='"+ params.GCODE_FILE + "'") %}
+  {%else %}
+    {% set get_gcode_file = "" %}
+  {% endif %}
+  {action_respond_info("get_gcode_file = %s" % (get_gcode_file))}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+
+  M106 S0  #需要关闭模型风扇
+  M104 S{extruder_temp} # 140
+  M140 S{bed_temp}  # 50
+
+  {% if "z" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    PRINT_PREPARED
+    BED_MESH_CLEAR
+    NOZZLE_CLEAR
+    NEXT_HOMEZ_NACCU
+    G28 Z
+  {% endif %}
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count} {get_gcode_file}
+  G0 Z10 F600
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  {% for _ in range(100) %}
+    M1800
+  {% endfor %}
+  
+[gcode_macro TEST_HOME]
+gcode:
+  {% for _ in range(100) %}
+    G28
+  {% endfor %} 
+    
+[gcode_macro A_TriPress_STEP1]
+gcode:
+  G28
+  G1 Z25 F600
+
+[gcode_macro A_TriPress_STEP2]
+gcode:
+  PROBE_ACCURACY PROBE_SPEED=5
+
+[gcode_macro EXTRUDE_TEST]
+gcode:
+  M104 S220
+  {% set times = params.TIMES|default(1)|int %}
+  {% for _ in range(times) %}
+    BOX_MOVE_TO_CUT
+    BOX_GO_TO_EXTRUDE_POS
+    G91
+    G0 E100 F360
+    G90
+    M400
+    # BOX_BLOW
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P4000
+    SET_PIN PIN=fan0 VALUE=0
+    M400
+    BOX_NOZZLE_CLEAN
+    # BOX_GO_TO_EXTRUDE_POS
+  {% endfor %}
+
+[gcode_macro A_G28_test] ;归零与重复探测精度测试
+gcode:
+  {% set Count = params.G28_COUNT|default(3000)|int %}
+  {% set RECount = params.COUNT|default(1000)|int %}
+
+  M109 S140
+
+  {% for _ in range(Count) %}
+      G28
+  {% endfor %}
+
+  TEST_REPROBE C={RECount}
+
+  M104 S0  
+
+
+# [gcode_macro T0]
+# rename_existing: T0.1
+# gcode:
+#   T0.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T1]
+# rename_existing: T1.1
+# gcode:
+#   T1.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T2]
+# rename_existing: T2.1
+# gcode:
+#   T2.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T3]
+# rename_existing: T3.1
+# gcode:
+#   T3.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+
+[delayed_gcode STARTUP_READ_FILAMENT_RACK_RFID] #开机读RFID，防止开机过程中扫描RFID后，RFID失效问题
+initial_duration: 2
+gcode:
+  {action_respond_info("STARTUP_READ_FILAMENT_RACK_RFID")}
+  FILAMENT_RACK
+  
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN200400C10/printer.cfg
@@ -0,0 +1,490 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.16
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+#hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+offset_value: -0.1   # 断电续打Z轴补偿值，解决过压层
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 262 ## #352.5#356 ;360
+position_min: -12 ## 
+position_max: 262 ## #300 #352.5#356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA8
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -3 ## #-10#345
+position_min: -3 ## #-8.5#-10
+position_max: 296.5 ## #300 #400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PA10
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20 ##
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 270 #263
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[tmc2208 stepper_z]
+uart_pin: PC1
+# uart_address: 3
+run_current: 0.84 #0.8
+# diag_pin: ^PB13
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+# driver_SGTHRS: 0
+
+# [stepper_z1]
+# step_pin: PB15
+# dir_pin: PA1
+# enable_pin: !PA9
+# microsteps: 16
+# rotation_distance:8
+# endstop_pin: probe:z_virtual_endstop 
+
+# [z_tilt]
+# z_positions:
+#     -15,175
+#     375,175
+# points:
+#     5,175
+#     345,175
+  
+# speed: 300
+# horizontal_move_z: 5
+# retries: 10
+# retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:98633
+temperature2:220
+resistance2:377
+temperature3:320
+resistance3:73
+# temperature1:25
+# resistance1:260000
+# temperature2:220
+# resistance2:738
+# temperature3:350
+# resistance3:98
+
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+#70w
+pid_kp: 30.236
+pid_ki: 3.475
+pid_kd: 65.763
+high_temp_value: 280
+pid_kp_high_temp: 32.827
+pid_ki_high_temp: 3.367
+pid_kd_high_temp: 80.016
+# 50W
+# pid_kp: 37.563
+# pid_ki: 4.244
+# pid_kd: 83.107
+# high_temp_value: 280
+# pid_kp_high_temp: 35.955
+# pid_ki_high_temp: 2.179
+# pid_kd_high_temp: 148.314
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_kp: 38.408
+pid_ki: 2.032
+pid_kd: 181.476
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PB3
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+# [heater_fan chamber_fan]
+# pin: !PB14   
+# enable_pin: PB2   
+# heater:chamber_heater
+# is_ptc_fan: 1
+# heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[output_pin filter_fan] # F012的过滤风扇
+pin: PB1
+
+[output_pin board_dissipation_fan] # 主板散热风扇
+pin: PA0
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB3
+
+# [heater_generic chamber_heater]
+# heater_pin:PC12  
+# max_power:1.0
+# sensor_type:NTC 100K MGB18-104F39050L32 
+# sensor_pin:PC5 
+# control: watermark
+# # control: pid
+# # pid_Kp: 37
+# # pid_Ki: 0.18
+# # pid_Kd: 280
+# min_temp:-30 #-100 20240326
+# max_temp:80
+
+# [verify_heater chamber_heater] 
+# max_error: 80 #120  20240326
+# check_gain_time:345600
+# hysteresis: 15
+# heating_gain: 1
+
+[temperature_fan chamber_fan]
+pin: PB3
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin extruder_fan]
+pin: nozzle_mcu: PB1   #高电平触发，默认低电平
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+# motor_closed_loop: x,y,z,z1,e
+motor_closed_loop: x,y,e
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_x_stall: PB11
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_y_stall: PB12
+# motor_z_dir: PB5,0
+# motor_z_step: PB6,1
+# motor_z_stall: PB13
+# motor_z1_dir: PA1,1
+# motor_z1_step: PB15,1
+# motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   130,130,130 #175,175,10
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+# prth_clr_probe_pos:150,355
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.21.20.205
+
+# print_temp_PLA, nozzle_comp_PLA = 220, 0.02
+# print_temp_PETG, nozzle_comp_PETG = 240, 0.03
+# print_temp_ABS, nozzle_comp_ABS = 260, 0.05
+temp_non_linaer_a = 0.00001250
+temp_non_linaer_b = -0.00175000 # 调整非线性补偿系数解决压层问题(190℃以下补偿值为零)
+temp_non_linaer_c = 0.08000000
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+# prth_tmp_comp: 26,300,0,0.135 #默认使用非线性温度补偿功能，26,300,0,0.11 使用2.5mm不削薄应变片+提高应变片激励电压方案 #26,300,0,0.135削薄应变片 
+enable_not_linear_comp:True #是否使能温度非线性补偿功能，True使能 False不使能(使用线性补偿)
+pres_cfg_regs:60 #60（1280/128）44（640/128）56（1280/64）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+prth_tri_zacc:100
+prth_min_fans:0.6
+
+prth_clr_brush_pos = 151, 291#164, 291 ## #硅胶刷上擦拭区的中间位置
+prth_clr_probe_pos = 95, 266.5#90, 265 ## #热床上擦拭区的附近位置探测高度 rock_20240106
+prth_clr_pose = 153, 266.5, 10#153, 265, 10 ## #热床上喷头擦拭区的位置 rock_20240106
+
+# regional_prtouch_switch: False # 区域调平开关，默认True开启
+
+[bed_mesh]
+speed: 100
+mesh_min: 5,5 ## 
+mesh_max: 255,255 ##
+probe_count:7,7
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800 ## #100#800
+max_accel: 20000 ## #5000#30000
+max_accel_to_decel: 20000 ## #5000#30000
+max_z_velocity: 5#6#30
+square_corner_velocity: 10
+max_z_accel: 100
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 10 # mm/s  下降速度
+slow_speed: 10 # mm/s  探测速度
+rising_dist: 10 # mm  首次探测到光电后的上升距离
+safe_dist: 40 # mm  热床倾斜偏差安全值 一侧光电触发后，另一侧允许下降的距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 60 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发,多个光电配置方式：endstop_pin_z: PA15, PA8... 最多支持4个
+zd_up: 1  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 2 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+# [gcode_button z2]
+# pin: PA8
+# press_gcode:
+#   {action_respond_info("z2 Photoelectric switch not triggered")}
+# release_gcode:
+#   {action_respond_info("z2 Photoelectric switch triggered")}
+
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN200400C10/printer_params.cfg
@@ -0,0 +1,41 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PB4 # throat fan
+# # fan0_pin: nozzle_mcu:PB3 # model fan
+# fan1_pin: PC6 # backplane fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[fan_feedback]
+fan0_pin: PC6 # PTC Fan
+fan1_pin: nozzle_mcu:PA12 # 喉管散热风扇
+fan2_pin: nozzle_mcu:PC13 # 模型散热风扇
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 260
+variable_bed_size_y: 260
+variable_bed_size_z: 260
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN200400C10/sensorless.cfg
@@ -0,0 +1,239 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  # 计算归零中点，根据bed_mesh参数计算，适配多种不同机器
+  {% set X_s = printer.configfile.settings['bed_mesh'].mesh_min[0]|int %}
+  {% set X_e = printer.configfile.settings['bed_mesh'].mesh_max[0]|int %}
+  {% set Y_s = printer.configfile.settings['bed_mesh'].mesh_min[1]|int %}
+  {% set Y_e = printer.configfile.settings['bed_mesh'].mesh_max[1]|int %}
+
+  {% set POSITION_X = (X_e-X_s)/2+X_s|int %}
+  {% set POSITION_Y = (Y_e-Y_s)/2+Y_s|int %}
+
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (POSITION_X))}
+  {action_respond_info("y_park = %s \n" % (POSITION_Y))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z5 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  MOTOR_STALL_MODE DATA=1
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and 'Y' in params %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'y' %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'Y' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'x'%}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    {% if x_axes[2] is not defined %}
+      BOX_GO_TO_EXTRUDE_POS
+      PRES_CHECK RUN=1
+      BOX_NOZZLE_CLEAN
+      PRES_CHECK RUN=0
+    {% endif %}
+    SET_PIN PIN=extruder_fan VALUE=0
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  MOTOR_STALL_MODE DATA=2
+  MOTOR_CHECK_PROTECTION_AFTER_HOME DATA=11
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN240319C13/box.cfg
@@ -0,0 +1,93 @@
+[serial_485 serial485]
+serial: /dev/ttyS5
+baud: 230400
+
+[auto_addr]
+
+[filament_rack]
+not_pin: !PA5
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: -5 ## #10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 150 ## #200#200#352
+# cut_pos_x: -5    
+cut_pos_y: 160#200#352#368
+#middle_cut_pos_y:
+Tn_retrude: -6#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 120 ## #135  #料槽吐完料摆动 左边界
+clean_left_pos_y: 291 ## #230 #378#380# 368
+clean_right_pos_x: 140 ## #160 #料槽吐完料摆动 右边界
+clean_right_pos_y: 291 ## #230 #378#380
+clean_velocity: 12000 ## #12000
+box_need_clean_length:60
+cut_velocity:   30000 ## 12000
+extrude_pos_x: 120 ## 133#135   #切换料吐料的位置
+extrude_pos_y: 291 ## 378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 256 ## #220 #345
+# safe_pos_x: 205
+clean_pos_left_x: 130#157     #擦喷嘴 硅胶的左边界的坐标
+clean_pos_right_x:150#172     #擦喷嘴 硅胶的右边界的坐标
+clean_pos_middle_y:285#230 #374    #擦喷嘴 硅胶的Y轴中间坐标
+check_cut_pos_x_max:-5#-5    #切刀校准坐标最大坐标 的边界值
+switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[load_ai]
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN # BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_RETRUDE_MATERIAL_WITH_TNN]
+rename_existing: BOX_RETRUDE_MATERIAL_WITH_TNN1
+gcode:
+  BOX_SET_TEMP
+  BOX_GO_TO_EXTRUDE_POS
+  BOX_RETRUDE_MATERIAL
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN240319C13/factory_printer.cfg
@@ -0,0 +1,427 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.28
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 356 ;360
+position_min: -12
+position_max: 356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp = 14.296
+pid_ki = 1.271
+pid_kd = 40.206
+# pid_Kp:19.219  # 重新调整 填入 20240326
+# pid_Ki:2.136
+# pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_x_stall: PB11
+motor_y_stall: PB12
+motor_z_stall: PB13
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.135  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）56（1280/64）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN240319C13/gcode_macro.cfg
@@ -0,0 +1,1308 @@
+# F008
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 275.0
+variable_max_y_position: 300.0
+variable_max_z_position: 300.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'zv','mzv','ei'
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  # SET_E_MIN_CURRENT
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  # IF_NEED_HOME
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # M104 S220
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 X0.5 F600
+  # G92 E0 ; Reset Extruder
+  # G1 E100 F600
+  # G1 E-0.5 F600
+  # G90
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P3000
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_NOZZLE_CLEAN#M1501
+  # M104 S140
+  # # BOX_GO_TO_EXTRUDE_POS#M1500
+  # # BOX_NOZZLE_CLEAN
+  # # G1 Y200 F6000
+  # G92 E0 ; Reset Extruder
+  # G90 
+  # LOAD_MATERIAL_RESTORE_FAN2
+  SAVE_GCODE_STATE NAME=myMoveState
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  FILAMENT_RACK_FLUSH
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  # IF_NEED_HOME
+  # BOX_CUT_MATERIAL#M1502
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 E-60 F2000
+  # G90
+  # G1 Y200 F6000
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  BOX_MOVE_TO_CUT
+  M400
+  G91
+  G0 E-10 F360
+  G90
+  M400
+  BOX_MOVE_TO_SAFE_POS
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+
+    #   SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+    #   SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+    #   SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+    #   SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+    #   G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+    #   {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+    #   {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+    #   SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+    #   SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+    #   SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+    #   SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+    #   G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+# [gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+# gcode:
+#   {% if 'S' in params|upper %}
+#     {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+#       SET_PIN PIN=fan1 VALUE=255
+#     {% else %}
+#       SET_PIN PIN=fan1 VALUE=0
+#     {% endif %}
+#     {% if params.S|int > 40 %}
+#       SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+#       SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S}
+#     {% elif params.S|int > 0 %}
+#       SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+#       SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+#     {% else %}
+#       SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+#       SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+#       {% if params.S|int == 0 %}
+#         SET_PIN PIN=fan1 VALUE=0
+#       {% endif %}
+#     {% endif %}
+#   {% endif %}
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P3000
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  # {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28
+    # 精擦嘴
+    NOZZLE_CLEAR
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{params.BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    # Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    # 精归零
+    NEXT_HOMEZ_NACCU
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M140 S{params.BED_TEMP}
+  M220 S100 ;Reset Feedrate
+  # M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+  SET_PIN PIN=extruder_fan VALUE=1
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {action_respond_info("END_PRINT_POINT act_z:%s, max_z:%s \n" % (act_z, max_z))}
+    {% if act_z < (max_z - 5) %}
+        {action_respond_info("END_PRINT_POINT G1 Z2.0 F600 \n")}
+        G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    # G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    PAUSE_BASE
+    M400
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+      BOX_MOVE_TO_SAFE_POS
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan0_speed %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+    SET_PIN PIN=extruder_fan VALUE=0
+  {% endif %}
+
+[gcode_macro CALIBRATE_CUT_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  SET_LIMITS
+  MOTOR_CHECK_CUT_POS
+  M400
+  RESTORE_LIMITS
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  CALIBRATE_CUT_POS
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro NOZZLE_PID_HIGH]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=320
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'false' %}
+    {action_respond_info("Extruder not hot enough, SET M109 S%s" % 
+      printer['gcode_macro PRINTER_PARAM'].hotend_temp|int)}
+    M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% else %}
+    M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% endif %}
+  G91
+  M106 S0
+  G1 E{E} F600
+  G90
+  M106 S127
+  G4 P3000
+  BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  M106 P2 S{s_value}
+  M106 P0 S{s_value_0}
+  SET_LIMITS
+  M400
+  RESUME_BASE {get_params}
+  SET_PIN PIN=extruder_fan VALUE=1
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  {action_respond_info("start END_PRINT")}
+  END_PRINT
+  {action_respond_info("end END_PRINT success")}
+  CANCEL_PRINT_BASE
+  {action_respond_info("CANCEL_PRINT success")}
+
+[gcode_macro MOTOR_CANCEL_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  BOX_SET_CURRENT_BOX_IDLE_MODE
+  CANCEL_PRINT_BASE
+  WAIT_TEMP_START
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  # 此处Z归位一定要下降,此次光电找平后,不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  # 每次调平在上面的重新做Z_TILT_ADJUST,才能得到新的adjustments调整值
+  # 设置标志位 ZDOWN的时候 不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  SET_G29_FLAG VALUE=1
+  G28 Z
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  # 精擦嘴后做一次光电找平获取最大Z轴高度值
+  ZDOWN_SWITCH ENABLE=1
+  G28 Z
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  SET_G29_FLAG VALUE=0
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F1200
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+[gcode_macro BED_MESH_CALIBRATE_START_PRINT] # 用于打印前的归位调平
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+
+  M106 S0  #需要关闭模型风扇
+  PRINT_PREPARED
+  M104 S{extruder_temp} # 140
+  M140 S{bed_temp}  # 50
+
+  {% if "z" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  NEXT_HOMEZ_NACCU
+  G28 Z
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G0 Z10 F600
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  {% for _ in range(100) %}
+    M1800
+  {% endfor %}
+  
+[gcode_macro TEST_HOME]
+gcode:
+  {% for _ in range(100) %}
+    G28
+  {% endfor %} 
+    
+[gcode_macro A_TriPress_STEP1]
+gcode:
+  G28
+  G1 Z25 F600
+
+[gcode_macro A_TriPress_STEP2]
+gcode:
+  PROBE_ACCURACY PROBE_SPEED=5
+
+[gcode_macro EXTRUDE_TEST]
+gcode:
+  M104 S220
+  {% set times = params.TIMES|default(1)|int %}
+  {% for _ in range(times) %}
+    BOX_MOVE_TO_CUT
+    BOX_GO_TO_EXTRUDE_POS
+    G91
+    G0 E100 F360
+    G90
+    M400
+    # BOX_BLOW
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P4000
+    SET_PIN PIN=fan0 VALUE=0
+    M400
+    BOX_NOZZLE_CLEAN
+    # BOX_GO_TO_EXTRUDE_POS
+  {% endfor %}
+
+[gcode_macro A_G28_test] ;归零与重复探测精度测试
+gcode:
+  {% set Count = params.G28_COUNT|default(3000)|int %}
+  {% set RECount = params.COUNT|default(1000)|int %}
+
+  M109 S140
+
+  {% for _ in range(Count) %}
+      G28
+  {% endfor %}
+
+  TEST_REPROBE C={RECount}
+
+  M104 S0  
+
+
+# [gcode_macro T0]
+# rename_existing: T0.1
+# gcode:
+#   T0.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+
+# [gcode_macro T1]
+# rename_existing: T1.1
+# gcode:
+#   T1.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+
+# [gcode_macro T2]
+# rename_existing: T2.1
+# gcode:
+#   T2.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+
+# [gcode_macro T3]
+# rename_existing: T3.1
+# gcode:
+#   T3.1
+#   LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#   BOX_GO_TO_EXTRUDE_POS 
+#   M400
+#   G91
+#   G1 X7
+#   M400
+#   {action_respond_info("WILL LOAD_AI_DEAL")}
+#   # LOAD_AI_DEAL
+#   LOAD_AI_DETECT_WASTE #废料槽检测
+#   LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#   G1 X-7
+#   G90
+#   BOX_NOZZLE_CLEAN # 擦嘴
+#   BOX_MOVE_TO_SAFE_POS #去安全位置
+  
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN240319C13/printer.cfg
@@ -0,0 +1,449 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.1
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+#hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 267 ## #352.5#356 ;360
+position_min: -5 ## 
+position_max: 267 ## #300 #352.5#356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -9 ## #-10#345
+position_min: -9 ## #-8.5#-10
+position_max: 291 ## #300 #400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20 ##
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 260 #300 #360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+# [stepper_z1]
+# step_pin: PB15
+# dir_pin: PA1
+# enable_pin: !PA9
+# microsteps: 16
+# rotation_distance:8
+# endstop_pin: probe:z_virtual_endstop 
+
+# [z_tilt]
+# z_positions:
+#     -15,175
+#     375,175
+# points:
+#     5,175
+#     345,175
+  
+# speed: 300
+# horizontal_move_z: 5
+# retries: 10
+# retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+# F008
+# temperature1:25
+# resistance1:260000
+# temperature2:220
+# resistance2:738
+# temperature3:350
+# resistance3:98
+
+# F021/F012
+temperature1:25
+resistance1:98633
+temperature2:220
+resistance2:377
+temperature3:320
+resistance3:73
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp: 14.296
+pid_ki: 1.271
+pid_kd: 40.206
+high_temp_value: 280
+pid_kp_high_temp: 16.443
+pid_ki_high_temp:  1.370
+pid_kd_high_temp: 49.329
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+# [heater_fan chamber_fan]
+# pin: !PB14   
+# enable_pin: PB2   
+# heater:chamber_heater
+# heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+# [temperature_sensor chamber_temp]
+# sensor_type: EPCOS 100K B57560G104F
+# sensor_pin: PC5
+# min_temp: -30 #-100  20240326
+# max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+# [heater_generic chamber_heater]
+# heater_pin:PC12  
+# max_power:1.0
+# sensor_type:NTC 100K MGB18-104F39050L32 
+# sensor_pin:PC5 
+# control: watermark
+# # control: pid
+# # pid_Kp: 37
+# # pid_Ki: 0.18
+# # pid_Kd: 280
+# min_temp:-30 #-100 20240326
+# max_temp:80
+
+# [verify_heater chamber_heater] 
+# max_error: 80 #120  20240326
+# check_gain_time:345600
+# hysteresis: 15
+# heating_gain: 1
+
+# [temperature_fan chamber_fan]  #-跟玉山核对 20240326
+# pin: PA0
+# cycle_time: 0.0100
+# hardware_pwm: false
+# max_power: 1
+# shutdown_speed: 0
+# sensor_type: EPCOS 100K B57560G104F
+# sensor_pin: PC5
+# # sensor_pin: nozzle_mcu:PA0
+# min_temp: -30 #-100 20240326
+# max_temp: 80
+# control: watermark
+# max_delta: 2
+# target_temp: 35.0
+# max_speed: 1.0
+# min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin extruder_fan]
+pin: nozzle_mcu: PB1   #高电平触发，默认低电平
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+# motor_closed_loop: x,y,z,z1,e
+motor_closed_loop: x,y,e
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_x_stall: PB11
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_y_stall: PB12
+# motor_z_dir: PB5,0
+# motor_z_step: PB6,1
+# motor_z_stall: PB13
+# motor_z1_dir: PA1,1
+# motor_z1_step: PB15,1
+# motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.21.20.205
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+# prth_tmp_comp: 26,300,0,0.135 #默认使用非线性温度补偿功能，26,300,0,0.11 使用2.5mm不削薄应变片+提高应变片激励电压方案 #26,300,0,0.135削薄应变片 
+enable_not_linear_comp:True #是否使能温度非线性补偿功能，True使能 False不使能(使用线性补偿)
+pres_cfg_regs:60 #60（1280/128）44（640/128）56（1280/64）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+prth_tri_zacc:1000
+prth_min_fans:0.6
+
+prth_clr_brush_pos = 140, 291 ## #硅胶刷上擦拭区的中间位置
+prth_clr_probe_pos = 130, 259 ## #热床上擦拭区的附近位置探测高度
+prth_clr_pose = 130, 259, 10 ## #热床上喷头擦拭区的位置
+
+[bed_mesh]
+speed: 100
+mesh_min: 5,5 ## 
+mesh_max: 255,255 ##
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800 ## #100#800
+max_accel: 30000 ## #5000#30000
+max_accel_to_decel: 30000 ## #5000#30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+# [z_align]
+# distance_ratio: 0.85  # 向上快速运动距离的比例系数
+# quick_speed: 30 # mm/s  下降速度
+# slow_speed: 10 # mm/s  探测速度
+# rising_dist: 10 # mm  首次探测到光电后的上升距离
+# filter_cnt: 10 # 连续触发限位的次数，用作滤波
+# timeout: 30 # s 单次探测超时时间
+# retries: 5 # 重试次数
+# retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+# endstop_pin_z: PA15  # 光电触发
+# endstop_pin_z1: PA8  # 光电触发
+# zd_up: 0  # 步进电机远离限位开关的电平
+# zes_untrig: 1  # 限位开关未触发时的电平
+# diff_z_offset: 0.15 # 断电续打悬空差异补偿 压层时减小此值, 悬空时增大此值
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN240319C13/printer_params.cfg
@@ -0,0 +1,41 @@
+# F008
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PB4 # throat fan
+# # fan0_pin: nozzle_mcu:PB3 # model fan
+# fan1_pin: PC6 # backplane fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[fan_feedback]
+fan0_pin: PC6 # PTC Fan
+fan1_pin: nozzle_mcu:PA12 # 喉管散热风扇
+fan2_pin: nozzle_mcu:PC13 # 模型散热风扇
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 260
+variable_bed_size_y: 260
+variable_bed_size_z: 260
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/F021_CR0CN240319C13/sensorless.cfg
@@ -0,0 +1,239 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        # FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      # {% else %}
+      #   FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    # FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10/
+  {% endif %}
+
+  # 计算归零中点，根据bed_mesh参数计算，适配多种不同机器
+  {% set X_s = printer.configfile.settings['bed_mesh'].mesh_min[0]|int %}
+  {% set X_e = printer.configfile.settings['bed_mesh'].mesh_max[0]|int %}
+  {% set Y_s = printer.configfile.settings['bed_mesh'].mesh_min[1]|int %}
+  {% set Y_e = printer.configfile.settings['bed_mesh'].mesh_max[1]|int %}
+
+  {% set POSITION_X = (X_e-X_s)/2+X_s|int %}
+  {% set POSITION_Y = (Y_e-Y_s)/2+Y_s|int %}
+
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (POSITION_X))}
+  {action_respond_info("y_park = %s \n" % (POSITION_Y))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z5 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  MOTOR_STALL_MODE DATA=1
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and 'Y' in params %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'y' %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'Y' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'x'%}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    {% if x_axes[2] is not defined %}
+      BOX_GO_TO_EXTRUDE_POS
+      PRES_CHECK RUN=1
+      BOX_NOZZLE_CLEAN
+      PRES_CHECK RUN=0
+    {% endif %}
+    SET_PIN PIN=extruder_fan VALUE=0
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  MOTOR_STALL_MODE DATA=2
+  MOTOR_CHECK_PROTECTION_AFTER_HOME DATA=11
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/GS_01_CR4CU220812S12/factory_printer.cfg
@@ -0,0 +1,421 @@
+# GS-01
+# Printer_size: 300x300x300
+# Version: v1.0.1
+# CreateDate: 2023/11/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB11
+tx_pin: nozzle_mcu: PB10
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC12
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 54.901
+pid_Ki: 1.142
+pid_Kd: 375.483
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PA0]
+pin:PA0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB2]
+pin:PB2
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB10]
+pin:PB10
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC8]
+pin:PC8
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC9]
+pin:PC9
+pwm: True
+cycle_time: 0.010
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0# //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+g29_down_min_z: 50
+
+correct_tri_hold: 8000
+correct_step_mm:  0.02
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/GS_01_CR4CU220812S12/gcode_macro.cfg
@@ -0,0 +1,713 @@
+# GS-01
+# CreateDate: 2023/11/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 300.0
+variable_max_y_position: 300.0
+variable_max_z_position: 300.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  RESTORE_E_CURRENT
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  SET_E_MIN_CURRENT
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E80 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M141]
+description: Set Chamber temperature with slicers
+gcode:
+  SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    WAIT_TEMP_END
+  {% else %}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  {action_respond_info("wait temp start\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  # M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  {action_respond_info("wait temp end\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  # M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("not prepare.\n")}
+    PRINT_PREPARE_CLEAR
+    CX_ROUGH_G28 EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}
+    CX_NOZZLE_CLEAR
+    ACCURATE_G28
+    CX_PRINT_LEVELING_CALIBRATION
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z2.0 F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  M204 S500
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < 48.0 %}
+    {% set z_safe = 50.0 - act_z %}
+  {% elif act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  {action_respond_info("z_safe = %s"% (z_safe))}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+  M104 S140
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    M400
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE AXIS=y
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+    G90
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/GS_01_CR4CU220812S12/printer.cfg
@@ -0,0 +1,433 @@
+# GS-01
+# Printer_size: 300x300x300
+# Version: v1.0.2
+# CreateDate: 2023/11/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC0, PC5
+
+[temperature_fan chamber_fan]
+pin: PC0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 70
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 30
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 75
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 30
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 75
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 340
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu:PB11
+tx_pin: nozzle_mcu:PB10
+uart_address: 3
+run_current: 0.55
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: 0
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: !PC15
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+
+[filament_switch_sensor filament_sensor_2]
+pause_on_runout: true
+switch_pin: !nozzle_mcu:PA10
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 75
+# min_freq: 30
+# max_freq: 100
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0.05 # //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 6,6
+fade_start: 5.0
+fade_end: 50.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 20000
+max_accel_to_decel: 20000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+square_corner_max_velocity: 200.0
+max_z_accel: 300
+
+[pause_resume]
+# recover_velocity: 500.
+
+[exclude_object]
new file mode 100644
--- /dev/null
+++ b/config/GS_01_CR4CU220812S12/printer_params.cfg
@@ -0,0 +1,34 @@
+# GS-01
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/11/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[fan_feedback]
+fan0_pin: nozzle_mcu:PB4 # throat fan
+# fan0_pin: nozzle_mcu:PB3 # model fan
+fan1_pin: PC6 # backplane fan
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 300
+variable_bed_size_y: 300
+variable_bed_size_z: 300
+# 支持最高温度
+variable_nozzle_temp: 320
+variable_bed_temp: 120
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/GS_01_CR4CU220812S12/sensorless.cfg
@@ -0,0 +1,197 @@
+# Createdate: 2023/11/21
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+    BED_MESH_PROFILE LOAD="default"
+  {% endif %}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/GS_03_CR0CN240319C13/box.cfg
@@ -0,0 +1,96 @@
+[serial_485 serial485]
+serial: /dev/ttyS5
+baud: 230400
+
+[auto_addr]
+
+[filament_rack]
+not_pin: !PA5
+
+[box]
+bus:serial485
+filament_sensor:filament_sensor
+pre_cut_pos_x: 10#223.8  #预撞刀的位置，保证垂直撞刀
+pre_cut_pos_y: 200#200#352
+#cut_pos_x: -6.5    
+cut_pos_y: 200#352#368
+#middle_cut_pos_y:
+Tn_retrude: -10#-60       #切料后，使耗材退出挤出齿轮的长度
+Tn_retrude_velocity: 600#360  #回抽速度
+Tn_extrude_temp: 220  #挤出温度
+Tn_extrude: 140    #如果当前温度设置温度，预加热刀120
+Tn_extrude_velocity: 360  #挤出速度
+buffer_empty_len: 30  #缓冲器回抽预留长度，需要挤出缓冲器预留的长度 （切断挤出机内撞刀到挤出齿轮的长度）
+clean_left_pos_x: 135  #料槽吐完料摆动 左边界
+clean_left_pos_y: 378#380# 368
+clean_right_pos_x: 160 #料槽吐完料摆动 右边界
+clean_right_pos_y: 378#380
+clean_velocity: 12000
+box_need_clean_length:70
+cut_velocity: 30000#12000
+extrude_pos_x: 133#135   #切换料吐料的位置
+extrude_pos_y: 378#380
+has_extrude_pos: 1          #有没有吐料需要  区分K1_MAX和f008
+safe_pos_y: 345
+safe_pos_x: 225
+clean_pos_left_x: 160     #擦喷嘴 硅胶的左边界的坐标
+clean_pos_right_x:170     #擦喷嘴 硅胶的右边界的坐标
+clean_pos_middle_y:374    #擦喷嘴 硅胶的Y轴中间坐标
+check_cut_pos_x_max:-5    #切刀校准坐标最大坐标 的边界值
+switch_pin:!nozzle_mcu:PB9
+version: 1
+
+[load_ai]
+
+[gcode_macro BOX_CHECK_MATERIAL]
+gcode:
+
+[gcode_macro BOX_LOAD_MATERIAL_WITH_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_SAVE_FAN
+  BOX_RETRUDE_MATERIAL_WITH_TNN # BOX_RETRUDE_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+  BOX_RESTORE_FAN
+  BOX_MOVE_TO_SAFE_POS
+
+[gcode_macro BOX_LOAD_MATERIAL_WITHOUT_MATERIAL]
+gcode:
+  M104
+  BOX_CHECK_MATERIAL
+  BOX_EXTRUDE_MATERIAL
+  BOX_EXTRUDER_EXTRUDE
+  BOX_MATERIAL_CHANGE_FLUSH # BOX_MATERIAL_FLUSH
+
+[gcode_macro BOX_RETRUDE_MATERIAL_WITH_TNN]
+rename_existing: BOX_RETRUDE_MATERIAL_WITH_TNN1
+gcode:
+  BOX_SET_TEMP
+  BOX_GO_TO_EXTRUDE_POS
+  BOX_RETRUDE_MATERIAL
+
+[gcode_macro BOX_QUIT_MATERIAL]
+gcode:
+  BOX_CHECK_MATERIAL
+  BOX_CUT_MATERIAL
+  BOX_RETRUDE_MATERIAL_WITH_TNN
+  BOX_MOVE_TO_SAFE_POS
+
+# eg:
+# BOX_EXTRUDE_MATERIAL TNN=T1A
+# BOX_EXTRUDER_EXTRUDE TNN=T1A
+# BOX_MATERIAL_FLUSH LEN=100 VELOCITY=360 TEMP=220
+# BOX_RETRUDE_MATERIAL_WITH_TNN TNN=T1A
+
+[gcode_macro BOX_INFO_REFRESH]
+gcode:
+  BOX_SET_PRE_LOADING ADDR={params.ADDR} NUM={params.NUM} ACTION=RUN
+  M400
+  BOX_GET_RFID ADDR={params.ADDR} NUM={params.NUM}
+  M400
+  BOX_GET_REMAIN_LEN ADDR={params.ADDR} NUM={params.NUM}
+  M400
+
new file mode 100644
--- /dev/null
+++ b/config/GS_03_CR0CN240319C13/factory_printer.cfg
@@ -0,0 +1,427 @@
+# F008
+# Printer_size: 350*350*350
+# Version: v1.0.28
+# CreateDate: 2024/03/09
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 356 ;360
+position_min: -12
+position_max: 356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -10#345
+position_min: -10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp = 14.296
+pid_ki = 1.271
+pid_kd = 40.206
+# pid_Kp:19.219  # 重新调整 填入 20240326
+# pid_Ki:2.136
+# pid_Kd:43.243
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]  #-跟玉山核对 20240326
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_x_stall: PB11
+motor_y_stall: PB12
+motor_z_stall: PB13
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10 #20240326  结构和谢工给出最后坐标
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100 # 谢工确认具体值 
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.23.211.214
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+prth_tmp_comp: 26,300,0,0.135  #26,300,0,0.11 E方案削薄
+pres_cfg_regs:60 #60（1280/128）56（1280/64）44（640/128）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 20 # mm/s  探测速度
+rising_dist: 20 # mm  首次探测到光电后的上升距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15  # 光电触发
+endstop_pin_z1: PA8  # 光电触发
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.05   #皮带检测误差值±0.05
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
new file mode 100644
--- /dev/null
+++ b/config/GS_03_CR0CN240319C13/gcode_macro.cfg
@@ -0,0 +1,1425 @@
+# GS-03
+# CreateDate: 2025/03/25
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 350.0
+variable_max_y_position: 352.0
+variable_max_z_position: 350.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 100
+variable_fan2_speed: 0
+variable_fan0_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+variable_bed_steady_temp: 60,80
+variable_bed_steady_time: 60,120
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM_PARAM]
+variable_cut_calibration: 10000    # 次数
+variable_shaper_calibrate: 1800000  # 秒 500小时
+variable_belt_tensioning: 3600000  # 秒 1000小时
+variable_motion_mechanism_lubrication: 1800000  # 秒
+variable_camera_maintenance: 1800000  # 秒
+variable_fan_inspection: 1800000  # 秒
+variable_nozzle: 20000  # 克
+variable_cut: 100000  # 次
+variable_machine_teflon_tube: 3600000  # 秒
+variable_wipe_mouth_strip: 1800000  # 秒
+variable_air_filter: 1800000  # 秒
+variable_cfs_teflon_tube: 3600000  # 秒
+variable_cfs_desiccant: 1800000  # 秒
+gcode:
+
+[gcode_macro MAINTENANCE_ITEM]
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'zv','mzv','ei'
+gcode:
+
+[gcode_macro IF_NEED_HOME]
+gcode:
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    G28
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  # SET_E_MIN_CURRENT
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  # {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  # {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  # M400
+  # SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  # G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode: 
+  # LOAD_MATERIAL_CLOSE_FAN2
+  # IF_NEED_HOME
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # M104 S220
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 X0.5 F600
+  # G92 E0 ; Reset Extruder
+  # G1 E100 F600
+  # G1 E-0.5 F600
+  # G90
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P3000
+  # SET_PIN PIN=fan0 VALUE=0
+  # BOX_NOZZLE_CLEAN#M1501
+  # M104 S140
+  # # BOX_GO_TO_EXTRUDE_POS#M1500
+  # # BOX_NOZZLE_CLEAN
+  # # G1 Y200 F6000
+  # G92 E0 ; Reset Extruder
+  # G90 
+  # LOAD_MATERIAL_RESTORE_FAN2
+  SAVE_GCODE_STATE NAME=myMoveState
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SAVE_FAN
+  FILAMENT_RACK_PRE_FLUSH
+  FILAMENT_RACK_SET_TEMP
+  FILAMENT_RACK_FLUSH
+  FILAMENT_RACK_RESTORE_FAN
+  SET_COOL_TEMP
+  BOX_MOVE_TO_SAFE_POS
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  # IF_NEED_HOME
+  # BOX_CUT_MATERIAL#M1502
+  # M109 S{printer.custom_macro.default_extruder_temp}
+  # G91
+  # G1 E-60 F2000
+  # G90
+  # G1 Y200 F6000
+  BOX_GO_TO_EXTRUDE_POS
+  FILAMENT_RACK_SET_TEMP
+  BOX_MOVE_TO_CUT
+  M400
+  G91
+  G0 E-10 F360
+  G90
+  M400
+  BOX_MOVE_TO_SAFE_POS
+  SET_COOL_TEMP
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      # G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      # {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      # {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      # SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      # SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      # G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+# [gcode_macro M141 S0] #为了相应屏幕的关闭腔体加热模块   && 开始打印时候需要，腔体默认 35° 控温 M141 S35  && 结束打印 关闭腔体加热 M141 S0 
+# gcode:
+   #关闭腔体加热
+   #关闭腔体加热风扇
+   
+[gcode_macro M141] #需要增加 M191 逻辑，现在要映射到M141 的逻辑
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S}
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M191]
+gcode:
+  {% if 'S' in params|upper %}
+    SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+    {% if printer["temperature_fan chamber_fan"].speed > 0.0 %}
+      SET_PIN PIN=fan1 VALUE=255
+    {% else %}
+      SET_PIN PIN=fan1 VALUE=0
+    {% endif %}
+    {% if params.S|int > 40 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=0
+      SET_PIN PIN=fan1 VALUE=0
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET={params.S} WAIT=1
+    {% elif params.S|int > 0 %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0  WAIT=1
+    {% else %}
+      SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET=35
+      SET_HEATER_TEMPERATURE HEATER=chamber_heater TARGET=0
+      {% if params.S|int == 0 %}
+        SET_PIN PIN=fan1 VALUE=0
+        SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro CLEAR_NOZZLE_STEP1]
+gcode:
+    G90
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X152.8 Y371.5 F4800
+    G1 X173.7 Y371.5 F4800
+    G1 X173.7 Y350 F4800
+
+[gcode_macro NEW_CLEAR_NOZZLE]
+gcode:
+    {% set bed_temp = printer.custom_macro.default_bed_temp %}
+    {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+    {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+    BOX_GO_TO_EXTRUDE_POS#M1500
+    SET_HEATER_TEMPERATURE HEATER=heater_bed TARGET={bed_temp}
+    # M109 S{nozzle_clear_temp}
+    M104 S220
+    M109 S220
+    G91
+    G1 E60 F300
+    G1 E-8 F180
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P3000
+    # M109 S{nozzle_clear_temp-20}
+    # CLEAR_NOZZLE_STEP1
+    BOX_NOZZLE_CLEAN#M1501
+    G90
+    G1 Z0 F300
+    # G1 X222   Y350 F600
+    # G1 X170.7 Y350 F600
+    M109 S{extruder_temp}
+    SET_PIN PIN=fan0 VALUE=0
+    G1 Z10 F300
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+ 
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 
+# PRINT_TEMP_SET EXTRUDER_TEMP=130 BED_TEMP=40 WAIT_TEMP=1
+[gcode_macro PRINT_TEMP_SET] 
+gcode:
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  {% set WAIT_TEMP = params.WAIT_TEMP|default(0)|int %}
+  M106 S0  #需要关闭模型风扇
+  M140 S{BED_TEMP}
+  M104 S{EXTRUDER_WAITTEMP}
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  {% if WAIT_TEMP|int == 1 %}
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+  {% endif %}
+
+[gcode_macro BOX_EXTRUDE_POS_SET] 
+gcode:
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M190 S{params.BED_TEMP}
+  BOX_NOZZLE_CLEAN#M1501
+
+[gcode_macro ZDOWN_SWITCH_SET] 
+gcode:
+  ZDOWN_SWITCH ENABLE={params.VALUE} 
+
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  BOX_START_PRINT
+  G90
+  SET_GCODE_OFFSET Z=0
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+  {% set BED_TEMP = params.BED_TEMP|default(60)|float %}
+  {% set EXTRUDER_TEMP = params.EXTRUDER_TEMP|default(220)|float %}
+  # {% set EXTRUDER_WAITTEMP = (EXTRUDER_TEMP/1.5|float)|int %}
+  {% set EXTRUDER_WAITTEMP = (140.0|float)|int %}
+  # {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("print prepared 111")}
+    M106 S0  #需要关闭模型风扇
+    M140 S{params.BED_TEMP}
+    M104 S{EXTRUDER_WAITTEMP}
+    # M204 S2000
+    # SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2000 #500 20240326
+    SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+    G28
+    # 精擦嘴
+    NOZZLE_CLEAR
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    M104 S{EXTRUDER_WAITTEMP}
+    M190 S{params.BED_TEMP}
+    M109 S{EXTRUDER_WAITTEMP}
+    BOX_NOZZLE_CLEAN#M1501
+    # Z_TILT_ADJUST
+    # BOX_GO_TO_EXTRUDE_POS#M1500
+    #M190 S{params.BED_TEMP}
+    # BOX_NOZZLE_CLEAN#M1501
+    # 精归零
+    NEXT_HOMEZ_NACCU
+    G28 Z
+    # BED_MESH_CALIBRATE
+    # CXSAVE_CONFIG
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+  M104 S{params.EXTRUDER_TEMP}
+  # G1 Z5 F600
+  BOX_GO_TO_EXTRUDE_POS#M1500
+  M109 S{params.EXTRUDER_TEMP} ;wait nozzle heating
+  M140 S{params.BED_TEMP}
+  M220 S100 ;Reset Feedrate
+  # M221 S100 ;Reset Flowrate
+  G21
+  SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=10
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  # M83
+  # G1 E120 F600
+  # M106 S255
+  # G4 P2000
+  # M107
+  BOX_NOZZLE_CLEAN#M1501
+  # G1 X350 Y150 F12000
+  # G1 Z0.2 F600
+  # G1 X350 Y0 E15 F6000
+  # G1 X200 Y0 E15 F6000
+  # G1 Z5 F600
+  G92 E0 ; Reset Extruder
+  SET_PIN PIN=extruder_fan VALUE=1
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=1
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {action_respond_info("END_PRINT_POINT act_z:%s, max_z:%s \n" % (act_z, max_z))}
+    {% if act_z < (max_z - 5) %}
+        {action_respond_info("END_PRINT_POINT G1 Z2.0 F600 \n")}
+        G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    # G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  RESTORE_LIMITS
+  M400
+  G92 E0
+  BOX_END 
+  BOX_END_PRINT
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M106 P0 S127
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  SET_TEMPERATURE_FAN_SWITCH TEMPERATURE_FAN=chamber_fan VALUE=0
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F300
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  M106 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  {% if printer.pause_resume.is_paused|lower == 'false' %}
+    PAUSE_BASE
+    PAUSE_EXTERNAL
+  {% endif %}
+
+[gcode_macro PAUSE_EXTERNAL]
+gcode:
+    ##### read E from pause macro #####
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    ##### set park positon for x and y #####
+    # default is your max posion from your printer.cfg
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    ##### calculate save lift position #####
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < 48.0 %}
+      {% set z_safe = 50.0 - act_z %}
+    {% elif act_z < (max_z - 2.0) %}
+      {% set z_safe = 2.0 %}
+    {% elif act_z < max_z %}
+      {% set z_safe = max_z - act_z %}
+    {% endif %}
+    {action_respond_info("z_safe = %s"% (z_safe))}
+    ##### end of definitions #####
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+    M400
+    G91
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+    M104 S140
+    {% if "xyz" in printer.toolhead.homed_axes %}
+      {% if printer.extruder.can_extrude|lower == 'true' %}
+        G1 E-1.0 F180
+        G1 E-{E} F360
+      {% else %}
+        {action_respond_info("Extruder not hot enough")}
+      {% endif %}
+      G1 Z{z_safe} F600
+      M400
+      G90
+      #G1 X{x_park} Y{y_park} F30000
+      BOX_GO_TO_EXTRUDE_POS  #暂停去料盒 rock_2023.03.26
+      BOX_NOZZLE_CLEAN#M1501
+      BOX_MOVE_TO_SAFE_POS
+    {% else %}
+      {action_respond_info("Printer not homed")}
+    {% endif %}
+    # save fan2 value and turn off fan2
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+    {% set fspeed = printer['output_pin fan2'].value %}
+    {action_respond_info("fan2_value = %s \n" % (fspeed))}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan0_speed VALUE={printer['output_pin fan0'].value}
+    {% set fspeed = printer['output_pin fan0'].value %}
+    {action_respond_info("fan0_value = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE=0
+    # SET_PIN PIN=fan0 VALUE=0
+    M106 P2 S0
+    M106 P0 S0
+    SET_E_MIN_CURRENT
+    SET_PIN PIN=extruder_fan VALUE=0
+
+[gcode_macro CALIBRATE_CUT_POS]
+gcode:
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  SET_LIMITS
+  MOTOR_CHECK_CUT_POS
+  M400
+  RESTORE_LIMITS
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  G90
+  {% if "xyz" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  M400
+  
+[gcode_macro BELT_TENSION]
+gcode:
+  G90
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  BED_MESH_CLEAR
+  BOX_MOVE_TO_SAFE_POS
+  M400
+  M84
+  {% if 'X' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+  {% elif 'Y' in params.AXES|upper %}
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% else %}
+    BELT_MDL_INFO MDL_NAME=mdlx
+    BELT_MDL_SET MDL_NAME=mdlx MDL_N=140
+    BELT_MDL_INFO MDL_NAME=mdly
+    BELT_MDL_SET MDL_NAME=mdly MDL_N=140
+  {% endif %}
+  SET_MAINTENANCE_ITEM_VARIABLE NAME=calibrate VARIABLE=belt_tensioning VALUE=0
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro NOZZLE_PID]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=230
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro NOZZLE_PID_HIGH]
+gcode:
+  SET_PIN PIN=fan0 VALUE=255
+  PID_CALIBRATE HEATER=extruder TARGET=320
+  SAVE_CONFIG
+  SET_PIN PIN=fan0 VALUE=0
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESUME_EXTERNAL_PROCESS
+  RESUME_BASE {get_params}
+
+[gcode_macro RESUME_EXTERNAL_PROCESS]
+gcode:
+  BOX_ERROR_RESUME_PROCESS
+  RESUME_EXTERNAL
+
+[gcode_macro RESUME_EXTERNAL]
+gcode:
+  {% if printer.pause_resume.resume_err is none or printer.pause_resume.resume_err|lower == 'false' %}
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan0_speed > 0 %}
+    SET_PIN PIN=fan0 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 + 0.5)|int}
+    {% set s_value_0 = (printer['gcode_macro PRINTER_PARAM'].fan0_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min)|float %}
+    # M106 P2 S{s_value}    
+  {% endif %}
+  BOX_GO_TO_EXTRUDE_POS #暂停恢复前擦嘴 Rock_2024.03.26
+  #BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    #G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 80.0 %}
+  {% set E_VELOCITY = printer['filament_rack'].remain_material_velocity * 0.8 %}
+  {action_respond_info("velocity: %s" % (E_VELOCITY))}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'false' %}
+    {action_respond_info("Extruder not hot enough, SET M109 S%s" % 
+      printer['gcode_macro PRINTER_PARAM'].hotend_temp|int)}
+    M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% else %}
+    M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+  {% endif %}
+  G91
+  M106 S0
+  G1 E{E} F{E_VELOCITY}
+  G90
+  M106 S127
+  G4 P3000
+  BOX_NOZZLE_CLEAN  #暂停恢复前擦嘴 Rock_2024.03.26
+  M106 P2 S{s_value}
+  M106 P0 S{s_value_0}
+  SET_LIMITS
+  M400
+  SET_PIN PIN=extruder_fan VALUE=1
+  {% endif %}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  {action_respond_info("start END_PRINT")}
+  END_PRINT
+  {action_respond_info("end END_PRINT success")}
+  CANCEL_PRINT_BASE
+  {action_respond_info("CANCEL_PRINT success")}
+  CLEAR_EEPROM_INFO
+
+[gcode_macro MOTOR_CANCEL_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=5000
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  M141 S0
+  SET_PIN PIN=extruder_fan VALUE=0
+  BOX_SET_CURRENT_BOX_IDLE_MODE
+  CANCEL_PRINT_BASE
+  WAIT_TEMP_START
+
+[gcode_macro G29] ;调平2024/03/24  在屏幕设置了温度后不生效，还是默认值 玉山确认
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+  M104 S{extruder_temp} #140  #需要跟源码结合
+  M140 S{bed_temp}  #50
+  {% if "xy" not in printer.toolhead.homed_axes %}
+    G28 X Y
+  {% endif %}
+  # 此处Z归位一定要下降,此次光电找平后,不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  # 每次调平在上面的重新做Z_TILT_ADJUST,才能得到新的adjustments调整值
+  # 设置标志位 ZDOWN的时候 不恢复上次做Z_TILT_ADJUST记录的adjustments值
+  SET_G29_FLAG VALUE=1
+  G28 Z
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+  # 精擦嘴后做一次光电找平获取最大Z轴高度值
+  ZDOWN_SWITCH ENABLE=1
+  G28 Z
+  BED_MESH_CLEAR
+  Z_TILT_ADJUST
+  NEXT_HOMEZ_NACCU
+  G28 Z
+  SET_G29_FLAG VALUE=0
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  G1 Z175 F1200
+  BOX_MOVE_TO_SAFE_POS#M1499
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+
+[gcode_macro BED_MESH_CALIBRATE_START_PRINT] # 用于打印前的归位调平
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% if 'GCODE_FILE' in params|upper %}
+    {% set get_gcode_file = ("GCODE_FILE='"+ params.GCODE_FILE + "'") %}
+  {%else %}
+    {% set get_gcode_file = "" %}
+  {% endif %}
+  {action_respond_info("get_gcode_file = %s" % (get_gcode_file))}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and params.BED_TEMP|default(0)|int >= printer.custom_macro.default_bed_temp %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  {% set enabled = printer["filament_switch_sensor filament_sensor"].enabled %}
+
+  M106 S0  #需要关闭模型风扇
+  M104 S{extruder_temp} # 140
+  M140 S{bed_temp}  # 50
+
+  {% if "z" not in printer.toolhead.homed_axes %}
+    G28
+  {% endif %}
+
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  {% endif %}
+
+  M104 S{extruder_temp}
+  M190 S{bed_temp}
+  M109 S{extruder_temp}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    PRINT_PREPARED
+    BED_MESH_CLEAR
+    NOZZLE_CLEAR
+    NEXT_HOMEZ_NACCU
+    G28 Z
+  {% endif %}
+
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count} {get_gcode_file}
+  G0 Z10 F600
+  CXSAVE_CONFIG
+  {% if enabled %}
+    SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  {% endif %}
+  
+[gcode_macro cut_material]
+gcode:
+    G28
+    G1 X223.8 Y353 F2400
+    G1 X223.8 Y370.5 F6000
+    NEW_CLEAR
+   
+
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
+[gcode_macro M1499] ;去到安全位置
+gcode:
+  G90
+  M204 S5000
+  G1 Y350 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 X170 F12000 ;打印尺寸内X预冲刷等候位置
+  G90
+[gcode_macro M1500] ;去到冲刷等待位置
+gcode:
+  G90
+  M204 S3000
+  G1 Y200 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 X178 F3600 ;打印尺寸内X预冲刷等候位置
+  G1 Y350 F3600 ;打印尺寸内Y预冲刷等候位置
+  G1 Y380 F3600#Y385 F3600
+  G1 X132 F3600 ;冲刷等待位置
+  G90
+  
+[gcode_macro M1501] ;喷嘴擦嘴
+gcode:
+  G90
+  M204 S6000
+  G1 X178 F12000 ;打印尺寸内x冲刷等候位置 
+  G1 Y380 F12000 ;打印尺寸内Y预冲刷等候位置  
+ 
+  G1 X135 F12000
+  G1 X170 Y380 F12000
+  {% for _ in range(5) %}
+    G1 X132 Y380 F12000
+    G1 X170 Y380 F12000
+  {% endfor %}  
+  G1 X178 Y380 F6000;打印尺寸内x冲刷等候位置  
+  G1 X178 Y300 F6000;打印尺寸内x冲刷等候位置   
+  G90
+[gcode_macro M1502] ;单独切料动作
+gcode:
+  G90
+  M204 S3000
+  # G1 X200 F12000 ;打印尺寸内Y预冲刷等候位置
+  G1 Y200 F12000 ;打印尺寸内Y预冲刷等候位置
+  {% for _ in range(3) %}
+    G1 X0   F12000 ;打印尺寸内Y预冲刷等候位置
+    G1 X-7  F12000
+  {% endfor %}
+  G1 E-2 F180
+  G92 E0
+  G1 X10    F10000 ;打印尺寸内Y预冲刷等候位置
+  G90
+  # M204 S3000
+  # G1 Y300 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 Y350 F10000 ;打印尺寸内Y预冲刷等候位置
+  # G1 X222 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G1 X222 Y382 F10000
+  # G1 X222 Y350 F10000
+  # G90
+[gcode_macro M1800] 
+gcode:
+  M104 S220
+  M109 S220
+  G90
+  G1 E100 F300  
+  M1502
+  G91
+  G1 E-2 F180
+  G92 E0
+  G90
+  # BOX_GO_TO_EXTRUDE_POS#M1500
+  # #
+  # M104 S220
+  # M109 S220
+
+  # G91
+  # G1 E50 F300
+  # G1 E-1 F180
+  # SET_PIN PIN=fan0 VALUE=255
+  # G4 P2000  
+  # BOX_NOZZLE_CLEAN#M1501
+  # SET_PIN PIN=fan0 VALUE=0 
+  # BOX_CUT_MATERIAL#M1502
+  # G90 
+  # G1 Y300 F3600
+
+[gcode_macro TEST_1800] ;盒子主从机重连
+gcode:
+  G28
+  G1 Z50
+  {% for _ in range(100) %}
+    M1800
+  {% endfor %}
+  
+[gcode_macro TEST_HOME]
+gcode:
+  {% for _ in range(100) %}
+    G28
+  {% endfor %} 
+    
+[gcode_macro A_TriPress_STEP1]
+gcode:
+  G28
+  G1 Z25 F600
+
+[gcode_macro A_TriPress_STEP2]
+gcode:
+  PROBE_ACCURACY PROBE_SPEED=5
+
+[gcode_macro EXTRUDE_TEST]
+gcode:
+  M104 S220
+  {% set times = params.TIMES|default(1)|int %}
+  {% for _ in range(times) %}
+    BOX_MOVE_TO_CUT
+    BOX_GO_TO_EXTRUDE_POS
+    G91
+    G0 E100 F360
+    G90
+    M400
+    # BOX_BLOW
+    SET_PIN PIN=fan0 VALUE=255
+    G4 P4000
+    SET_PIN PIN=fan0 VALUE=0
+    M400
+    BOX_NOZZLE_CLEAN
+    # BOX_GO_TO_EXTRUDE_POS
+  {% endfor %}
+
+[gcode_macro A_G28_test] ;归零与重复探测精度测试
+gcode:
+  {% set Count = params.G28_COUNT|default(3000)|int %}
+  {% set RECount = params.COUNT|default(1000)|int %}
+
+  M109 S140
+
+  {% for _ in range(Count) %}
+      G28
+  {% endfor %}
+
+  TEST_REPROBE C={RECount}
+
+  M104 S0  
+
+
+# [gcode_macro T0]
+# rename_existing: T0.1
+# gcode:
+#   T0.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T1]
+# rename_existing: T1.1
+# gcode:
+#   T1.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T2]
+# rename_existing: T2.1
+# gcode:
+#   T2.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+
+# [gcode_macro T3]
+# rename_existing: T3.1
+# gcode:
+#   T3.1
+#   {% set ai_switch = printer.load_ai.ai_switch %}
+#   {% set ai_waste_switch = printer.load_ai.ai_waste_switch %}
+#   {action_respond_info("ai_switch = %d, ai_waste_switch = %d \n" % (ai_switch, ai_waste_switch))}
+#   {% if ai_waste_switch|int == 1 %} #AI检测开    
+#     LOAD_AI_NOZZLE_CAM_POWER_ON  #进料前给喷头上电
+#     BOX_GO_TO_EXTRUDE_POS 
+#     M400
+#     G91
+#     G1 X-2 F12000
+#     M400
+#     G1 X9 F12000
+#     M400
+#     {action_respond_info("WILL LOAD_AI_DEAL")}
+#     # LOAD_AI_DEAL
+#     LOAD_AI_DETECT_WASTE #废料槽检测
+#     LOAD_AI_NOZZLE_CAM_POWER_OFF #关灯
+#     G1 X-7
+#     M400
+#     G90
+#     BOX_NOZZLE_CLEAN # 擦嘴
+#     BOX_MOVE_TO_SAFE_POS #去安全位置
+#   {% endif %}
+  
new file mode 100644
--- /dev/null
+++ b/config/GS_03_CR0CN240319C13/printer.cfg
@@ -0,0 +1,438 @@
+# GS-03
+# Printer_size: 350*350*350
+# Version: v1.0.0
+# CreateDate: 2025/03/25
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR1FN200338C15
+# mcu: chip: GD32F303RET6
+#      version: CR4FN200338C15
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+[include box.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+# [mcu leveling_mcu]
+# serial: /dev/ttyS4
+# baud: 230400
+# restart_method: command
+
+[verify_heater extruder]
+check_gain_time: 60
+heating_gain: 1.0
+hysteresis: 20
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+forced_leveling: true
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: -30  #-100
+max_temp: 100
+
+
+[stepper_x]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB11
+
+position_endstop: 352.5#356 ;360
+position_min: -10 #-12
+position_max: 352.5#356
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_y]
+step_pin: PB10
+dir_pin: PB9
+enable_pin: !PA9
+microsteps: 16
+rotation_distance: 40
+# endstop_pin: !PC7
+endstop_pin: PB12
+# endstop_pin: !nozzle_mcu:PA8
+position_endstop: -6.2#-10#345
+position_min: -6.2#-8.5#-10
+position_max: 400
+homing_speed: 100
+homing_retract_dist: 10#10.0
+# second_homing_speed: 5.0
+
+[stepper_z]
+step_pin: PB6
+dir_pin: PB5
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop
+# position_endstop: 0
+position_min: -10
+position_max: 360
+homing_speed: 5
+second_homing_speed: 5
+homing_retract_dist: 5
+
+[stepper_z1]
+step_pin: PB15
+dir_pin: PA1
+enable_pin: !PA9
+microsteps: 16
+rotation_distance:8
+endstop_pin: probe:z_virtual_endstop 
+
+[z_tilt]
+z_positions:
+    -15,175
+    375,175
+points:
+    5,175
+    345,175
+  
+speed: 300
+horizontal_move_z: 5
+retries: 10
+retry_tolerance: 0.1
+
+[thermistor my_thermistor]
+temperature1:25
+resistance1:260000
+temperature2:220
+resistance2:738
+temperature3:350
+resistance3:98
+
+[extruder]
+max_extrude_cross_section: 100#80  20240326
+max_extrude_only_distance:1000.0
+step_pin:nozzle_mcu:PB5
+dir_pin: !nozzle_mcu:PB4
+enable_pin:!nozzle_mcu:PB2
+microsteps:16
+rotation_distance:6.9
+nozzle_diameter:0.400
+filament_diameter:1.750
+heater_pin:nozzle_mcu:PB8
+sensor_type: my_thermistor
+sensor_pin:nozzle_mcu:PA0
+pressure_advance: 0.038
+pressure_advance_smooth_time: 0.038
+control:pid
+pid_kp: 14.296
+pid_ki: 1.271
+pid_kd: 40.206
+high_temp_value: 280
+pid_kp_high_temp: 16.443
+pid_ki_high_temp:  1.370
+pid_kd_high_temp: 49.329
+min_temp:-30# 0  20240326
+max_temp:390
+
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid 
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: -30 # -100   20240326 
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!nozzle_mcu:PA11
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+  BOX_CHECK_MATERIAL_REFILL
+
+
+[multi_pin heater_fans]
+  pins:nozzle_mcu:PB7,PB1
+ 
+[heater_fan hotend_fan]
+pin:multi_pin:heater_fans
+heater:extruder
+heater_temp:50.0
+
+[static_digital_output fan0_en]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB15
+pwm: True
+cycle_time: 0.01
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[multi_pin heater_fan2]
+pins:PB4,PB3
+
+[output_pin fan2]
+pin: multi_pin:heater_fan2
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PA0 
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[heater_fan chamber_fan]
+pin: !PB14   
+enable_pin: PB2   
+heater:chamber_heater
+is_ptc_fan: 1
+heater_temp: 100 # set an unattainable temperature, ensure that the fan does not work in lower temperature 
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: -30 #-100  20240326
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC5,PA0,PC7,PB7,PB8,PB9,PB10,PB5,PB6,PA1,PB15,PB11,PB12,PB13,PA10,PA9,PB2,PB14,PB1
+
+[heater_generic chamber_heater]
+heater_pin:PC12  
+max_power:1.0
+sensor_type:NTC 100K MGB18-104F39050L32 
+sensor_pin:PC5 
+control: watermark
+# control: pid
+# pid_Kp: 37
+# pid_Ki: 0.18
+# pid_Kd: 280
+min_temp:-30 #-100 20240326
+max_temp:80
+
+[verify_heater chamber_heater] 
+max_error: 80 #120  20240326
+check_gain_time:345600
+hysteresis: 15
+heating_gain: 1
+
+[temperature_fan chamber_fan]
+pin: PA0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+# sensor_pin: nozzle_mcu:PA0
+min_temp: -30 #-100 20240326
+max_temp: 80
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+
+[multi_pin LED_pin]
+pins:PB0,PA12
+
+[output_pin LED]
+pin:multi_pin:LED_pin
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin extruder_fan]
+pin: nozzle_mcu: PB1   #高电平触发，默认低电平
+
+[output_pin power]
+pin: PC9   #高电平触发，默认低电平
+
+[output_pin ptc_power]
+pin: PB2
+value: 1
+
+[motor_control]
+switch: 1
+retries: 4
+cut_pos_offset: 0.4  # 切刀位置补偿系数 mm
+motor_closed_loop: x,y,z,z1,e
+motor_x_dir: PB9,0
+motor_x_step: PB10,0
+motor_x_stall: PB11
+motor_y_dir: !PB7,0
+motor_y_step: PB8,0
+motor_y_stall: PB12
+motor_z_dir: PB5,0
+motor_z_step: PB6,1
+motor_z_stall: PB13
+motor_z1_dir: PA1,1
+motor_z1_step: PB15,1
+motor_z1_stall: PA10
+motor_e_stall: nozzle_mcu:PB12
+
+[lis2dw]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: lis2dw
+probe_points:
+   175,175,175 #175,175,10
+min_freq: 20  #新增 20240326
+max_freq: 120 
+accel_per_hz: 100
+
+[prtouch_v3]
+z_offset: 0
+speed: 5
+samples: 1
+samples_result: average
+samples_tolerance_retries: 5
+samples_tolerance: 0.5
+prth_clr_probe_pos:150,355
+step_swap_pin: !PC7
+pres_swap_pin: nozzle_mcu:PA15
+
+prth_msg_show: True
+#prth_dbg_ippt: 172.21.20.205
+
+pres_cs0_pin: nozzle_mcu:PB13, nozzle_mcu:PB14
+pres_tri_hold:4000, 10000, 500
+# prth_tmp_comp: 26,300,0,0.135 #默认使用非线性温度补偿功能，26,300,0,0.11 使用2.5mm不削薄应变片+提高应变片激励电压方案 #26,300,0,0.135削薄应变片 
+enable_not_linear_comp:True #是否使能温度非线性补偿功能，True使能 False不使能(使用线性补偿)
+pres_cfg_regs:60 #60（1280/128）44（640/128）56（1280/64）
+# prth_min_fans:0.8 # 0.1~ 1.0由于调平时保证精度，要关闭或减小风扇转速
+# prth_gas_calr:0.001 # 高斯滤波标准差的开方，0.001 ~ 10，值越小，网床平滑滤波程序越弱,注释为关闭
+prth_max_chps:8
+prth_tri_zacc:1000
+prth_min_fans:0.6
+
+[bed_mesh]
+speed: 100
+mesh_min: 5,5
+mesh_max: 345,345
+probe_count:9,9
+mesh_pps: 2, 2
+fade_start: 5.0 
+fade_end: 50.0
+bicubic_tension: 0.2
+algorithm: bicubic
+horizontal_move_z:5
+split_delta_z: 0.01
+move_check_distance: 1
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 30000
+max_accel_to_decel: 30000
+max_z_velocity: 30
+square_corner_velocity: 10
+max_z_accel: 1000#100 20240326
+
+[pause_resume]
+
+[exclude_object]
+
+[z_align]
+distance_ratio: 0.85  # 向上快速运动距离的比例系数
+quick_speed: 30 # mm/s  下降速度
+slow_speed: 10 # mm/s  探测速度
+rising_dist: 10 # mm  首次探测到光电后的上升距离
+safe_dist: 40 # mm  热床倾斜偏差安全值 一侧光电触发后，另一侧允许下降的距离
+filter_cnt: 10 # 连续触发限位的次数，用作滤波
+timeout: 30 # s 单次探测超时时间
+retries: 5 # 重试次数
+retry_tolerance: 10  # 两个光电的调整允许的最大偏差 10步 步距是0.0025mm
+endstop_pin_z: PA15, PA8  # 光电触发,多个光电配置方式：endstop_pin_z: PA15, PA8... 最多支持4个
+zd_up: 0  # 步进电机远离限位开关的电平
+zes_untrig: 1  # 限位开关未触发时的电平
+zmax_safe_pox_diff: 10 # zmax_safe_pox = stepper_z中的position_max-zmax_safe_pox_diff
+
+# [io_remap]
+# src_x_pin: PA1    # 输入pin脚索引号(被映射)
+# src_y_pin: PA8    # 输入pin脚索引号(被映射)
+# remap_pin: PA15   # 输出pin脚索引号(映射)
+# src_x_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# src_y_pullup: 1   # 输入pin脚的上下拉配置,1表示上拉(意味着读取到0表示触发),0表示下拉(意味着读取到1表示触发)
+# remap_def: 1      # 输出pin脚的默认输出电平
+# filterNum: 1      # 当读取输入pin脚有效电平持续时间大于等于filterNum * periodTicks, 置输出pin脚为有效电平状态。如果输入的参数为0, 将采用默认值5
+# periodTicks: 0    # 轮询输入pin脚周期, 单位ticks。如果输入的参数为0, 采用50uS对应的tick默认值
+
+[belt_mdl mdlx]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[belt_mdl mdly]
+ch_max_dis: 5 # 模块最大行程，单位 mm
+ch_best_n:  140 # 皮带最佳受力，单位 N
+ch_best_error: 0.15   #皮带检测误差值±0.15
+
+[gcode_button z1]
+pin: PA15
+press_gcode:
+  {action_respond_info("z1 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z1 Photoelectric switch triggered")}
+
+[gcode_button z2]
+pin: PA8
+press_gcode:
+  {action_respond_info("z2 Photoelectric switch not triggered")}
+release_gcode:
+  {action_respond_info("z2 Photoelectric switch triggered")}
+
new file mode 100644
--- /dev/null
+++ b/config/GS_03_CR0CN240319C13/printer_params.cfg
@@ -0,0 +1,34 @@
+# GS-03
+# Printer_size: 350x350x350
+# Version: v1.0.0
+# CreateDate: 2025/03/25
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: F008-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[fan_feedback]
+fan0_pin: PC6 # PTC Fan
+fan1_pin: nozzle_mcu:PA12 # 喉管散热风扇
+fan2_pin: nozzle_mcu:PC13 # 模型散热风扇
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 220
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 350
+variable_bed_size_y: 350
+variable_bed_size_z: 350
+# 支持最高温度
+variable_nozzle_temp: 350
+variable_bed_temp: 130
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/GS_03_CR0CN240319C13/sensorless.cfg
@@ -0,0 +1,239 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  M204 S100
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      # G1 z{z_park} F600   #rock_20240120 开始会向下走一段距离
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        # FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      # {% else %}
+      #   FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10   #rock_20240120 强制移动单Z  
+      {% endif %}
+      {% if printer.print_stats.power_loss == 0 %}
+        # STEPPER_Z_SENEORLESS   #rock_20240117
+        # FORCE_MOVE STEPPER=stepper_z stepper_z1 DISTANCE=-320 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  M204 S2000
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    # {action_respond_info("move xy\n")}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 X-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  # SET_KINEMATIC_POSITION
+  # G1 y20    F600
+  # G28 
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F6000
+        G90
+        # G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 Y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  # G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    # FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10/
+  {% endif %}
+
+  # 计算归零中点，根据bed_mesh参数计算，适配多种不同机器
+  {% set X_s = printer.configfile.settings['bed_mesh'].mesh_min[0]|int %}
+  {% set X_e = printer.configfile.settings['bed_mesh'].mesh_max[0]|int %}
+  {% set Y_s = printer.configfile.settings['bed_mesh'].mesh_min[1]|int %}
+  {% set Y_e = printer.configfile.settings['bed_mesh'].mesh_max[1]|int %}
+
+  {% set POSITION_X = (X_e-X_s)/2+X_s|int %}
+  {% set POSITION_Y = (Y_e-Y_s)/2+Y_s|int %}
+
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (POSITION_X))}
+  {action_respond_info("y_park = %s \n" % (POSITION_Y))}
+  M204 S2000
+  G1 x{x_park} y{y_park} F12000
+  G90
+  # G4 P500
+  M204 S500
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  G1 Z5 F600
+  # BED_MESH_SET_ENABLE
+
+[gcode_macro LEAVE_FLUSH_AREA]
+gcode:
+  FORCE_MOVE STEPPER=stepper_y DISTANCE=100 VELOCITY=50
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  MOTOR_STALL_MODE DATA=1
+  M204 S500
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  # {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+  #   {action_respond_info("x_axes: %s \n"% (x_axes))}
+  #   {% set position_y = printer.toolhead.position.y|int %}
+  #   {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+  #   # {% if position_y >= max_y_position %}
+  #   #   G91
+  #   #   G0 Y-10 F3600
+  #   #   G90
+  #   # {% endif %}
+  # {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}  
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+      _HOME_X
+  {% endif %}
+
+  {% if home_all %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and 'Y' in params %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'X' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'y' %}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if 'Y' in params and x_axes is defined and x_axes[0] is defined and x_axes[1] is not defined and x_axes[0] == 'x'%}
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-3 VELOCITY=10
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    {% if x_axes[2] is not defined %}
+      BOX_GO_TO_EXTRUDE_POS
+      PRES_CHECK RUN=1
+      BOX_NOZZLE_CLEAN
+      PRES_CHECK RUN=0
+    {% endif %}
+    SET_PIN PIN=extruder_fan VALUE=0
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  MOTOR_STALL_MODE DATA=2
+  MOTOR_CHECK_PROTECTION_AFTER_HOME DATA=11
+  {% set acc = printer.toolhead.max_accel %}
+  M204 S{acc}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  # G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1C_CR4CU220812S12/factory_printer.cfg
@@ -0,0 +1,421 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.1
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB11
+tx_pin: nozzle_mcu: PB10
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC12
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 54.901
+pid_Ki: 1.142
+pid_Kd: 375.483
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PA0]
+pin:PA0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB2]
+pin:PB2
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB10]
+pin:PB10
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC8]
+pin:PC8
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC9]
+pin:PC9
+pwm: True
+cycle_time: 0.010
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0# //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+g29_down_min_z: 50
+
+correct_tri_hold: 8000
+correct_step_mm:  0.02
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1C_CR4CU220812S12/gcode_macro.cfg
@@ -0,0 +1,717 @@
+# K1C
+# CreateDate: 2023/09/05
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 220.0
+variable_max_y_position: 220.0
+variable_max_z_position: 250.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  RESTORE_E_CURRENT
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  SET_E_MIN_CURRENT
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E80 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer['output_pin fan0'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0 
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0 
+      G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+      
+      {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1 
+      G4 P1000
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M141]
+description: Set Chamber temperature with slicers
+gcode:
+  SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    WAIT_TEMP_END
+  {% else %}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  {action_respond_info("wait temp start\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  # M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  {action_respond_info("wait temp end\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  # M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("not prepare.\n")}
+    PRINT_PREPARE_CLEAR
+    CX_ROUGH_G28 EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}
+    CX_NOZZLE_CLEAR
+    ACCURATE_G28
+    CX_PRINT_LEVELING_CALIBRATION
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z2.0 F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=2500
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < 48.0 %}
+    {% set z_safe = 50.0 - act_z %}
+  {% elif act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  {action_respond_info("z_safe = %s"% (z_safe))}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+  M104 S140
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    M400
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE AXIS=y
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+    G90
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1C_CR4CU220812S12/printer.cfg
@@ -0,0 +1,355 @@
+# K1C
+# Printer_size: 220x220x250
+# Version: v2.0.3
+# CreateDate: 2023/09/05
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR-K1-MAX-NOZZLE-V1.2.0
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: CR-K1-MAX-LEVELING-V1.1.0
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC0, PC5
+
+[temperature_fan chamber_fan]
+pin: PC0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 70
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 229
+position_min: -5
+position_max: 229
+homing_speed: 30
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 75
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -0.5
+position_min: -0.5
+position_max: 227
+homing_speed: 30
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 75
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 255
+position_min: -5
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu:PB11
+tx_pin: nozzle_mcu:PB10
+
+uart_address: 3
+run_current: 0.55
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PB10
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: watermark
+# control: pid
+# pid_kp: 27
+# pid_ki: 0.08
+# pid_kd: 0
+min_temp: 0
+max_temp: 115
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: !PC15
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+
+[filament_switch_sensor filament_sensor_2]
+pause_on_runout: true
+switch_pin: !nozzle_mcu:PA10
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 75
+# min_freq: 30
+# max_freq: 100
+probe_points:
+   110,110,10
+
+[prtouch_v2]  # K1
+pr_version: 1
+step_base: 2
+z_offset: 0 
+noz_ex_com: 0.06
+tilt_corr_dis: 0
+tri_min_hold: 2500
+tri_max_hold: 6000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA5
+pres0_sdo_pins: leveling_mcu:PA1
+pres1_clk_pins: leveling_mcu:PA2
+pres1_sdo_pins: leveling_mcu:PA0
+pres2_clk_pins: leveling_mcu:PA6
+pres2_sdo_pins: leveling_mcu:PA3
+pres3_clk_pins: leveling_mcu:PA7
+pres3_sdo_pins: leveling_mcu:PA4
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 87
+clr_noz_start_y: 225
+clr_noz_len_x: 46
+clr_noz_len_y: 1
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.70,0.30
+tri_try_max_times: 10
+tri_min_hold: 2500,20000
+tri_max_hold: 6000,60000
+
+clr_noz_quick: true
+clr_quick_high:0.7
+clr_xy_quick_spd:100
+clr_quick_times:10
+clr_quick_react_dis:5
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 215,215
+probe_count: 5,5
+fade_start: 5.0
+fade_end: 50.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 600
+max_accel: 20000
+max_accel_to_decel: 20000
+max_z_velocity: 10
+square_corner_velocity: 5.0
+max_z_accel: 300
+square_corner_max_velocity: 200.0
+[pause_resume]
+# recover_velocity: 500.
+
+[exclude_object]
new file mode 100644
--- /dev/null
+++ b/config/K1C_CR4CU220812S12/printer_params.cfg
@@ -0,0 +1,34 @@
+# K1C
+# Printer_size: 220x220x250
+# Version: v1.0.0
+# CreateDate: 2023/09/05
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR-K1-MAX-NOZZLE-V1.2.0
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: CR-K1-MAX-LEVELING-V1.1.0
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[fan_feedback]
+# fan0_pin: nozzle_mcu:PB3 # model fan
+fan0_pin: nozzle_mcu:PB4 # throat fan
+fan1_pin: PC6 # backplane fan
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 220
+variable_bed_size_y: 220
+variable_bed_size_z: 220
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1C_CR4CU220812S12/sensorless.cfg
@@ -0,0 +1,201 @@
+# Createdate: 2023/09/05
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=70
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=70
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 9 %}
+      {% set y_park = 9 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 210.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+  
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S10/gcode_macro.cfg
@@ -0,0 +1,416 @@
+# K1
+# CreateDate: 2023/03/15
+# history: 1. date: 2023.03.17
+#             modify: [gcode_macro END_PRINT]
+#          2. date: 2023.03.20
+#             delete: [gcode_macro Qmode].printer_state
+#          3. date: 2023.03.23
+#             modify: [gcode_macro LOAD_MATERIAL]
+#                     [gcode_macro QUIT_MATERIAL]
+
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 220.0
+variable_max_y_position: 220.0
+variable_max_z_position: 250.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 50
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E150 F180
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer['output_pin fan0'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=5000
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=200
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+      M106 P0 S80
+      M106 P1 S0
+      M106 P2 S0
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+      M106 P0 S{(printer['gcode_macro Qmode'].fan0_value * 255 + 0.5)|int}
+      M106 P1 S{(printer['gcode_macro Qmode'].fan1_value * 255 + 0.5)|int}
+      M106 P2 S{(printer['gcode_macro Qmode'].fan2_value * 255 + 0.5)|int}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% if 'S' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+    {% endif %}
+    M204.1 {get_params}
+  {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 255 %}
+  {% if params.P is defined %}
+    {% if fan < fans %}
+      {% set fan = params.P|int %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set value = params.S|int %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+  {% if value == 0 %}
+    SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan{fan}_flag VALUE=0
+  {% endif %}
+
+[gcode_macro M107]
+gcode:
+  {% if params.P is defined %}
+    SET_PIN PIN=fan{params.P|int} VALUE=0
+    SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan{params.P|int}_flag VALUE=0
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan0_flag VALUE=0
+    SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan2_flag VALUE=0
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    # SET_PIN PIN=fan2 VALUE=0
+    {% if printer["gcode_macro WAIT_TEMP_START"].fan0_flag == 1 %}
+      M106 P0 S0
+    {% endif %}
+    {% if printer["gcode_macro WAIT_TEMP_START"].fan2_flag == 1 %}
+      M106 P2 S0
+    {% endif %}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    # SET_PIN PIN=fan2 VALUE=255
+    {% if printer["gcode_macro WAIT_TEMP_START"].fan0_flag == 1 %}
+      M106 P0 S255
+    {% endif %}
+    {% if printer["gcode_macro WAIT_TEMP_START"].fan2_flag == 1 %}
+      M106 P2 S255
+    {% endif %}
+    {% if (printer["gcode_macro WAIT_TEMP_START"].fan0_flag|int == 0) and (printer["gcode_macro WAIT_TEMP_START"].fan2_flag|int == 0) %}
+      WAIT_TEMP_END
+    {% else %}
+      UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+    {% endif %}
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+variable_fan0_flag: 0
+variable_fan1_flag: 0 # unused, to resolve error
+variable_fan2_flag: 0
+gcode:
+  SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan0_flag VALUE=1
+  SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan2_flag VALUE=1
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan0_flag VALUE=0
+  SET_GCODE_VARIABLE MACRO=WAIT_TEMP_START VARIABLE=fan2_flag VALUE=0
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro START_PRINT]
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  {% set leveling_calibration = printer.custom_macro.leveling_calibration|int %}
+  {% if leveling_calibration == 0 %}
+    CX_PRINT_LEVELING_CALIBRATION EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp} LEVELING_CALIBRATION={leveling_calibration}
+    # {% set leveling_calibration = 1 %}
+  {% else %}
+    CX_CLEAN_CALIBRATION_FLAGS
+  {% endif %}
+  CX_PRINT_DRAW_ONE_LINE
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  M220 S100
+  M204 S500
+  TURN_OFF_HEATERS
+  M107
+  M107 P1
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    G1 Z{z_safe} F1200
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F6000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 1.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  # {action_respond_info("fan2_value1 = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G1 E-{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F6000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} Z5 F6000
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    M106 P2 S{(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S10/printer.cfg
@@ -0,0 +1,309 @@
+# K1
+# Printer_size: 220x220x250
+# Version: v1.0.9
+# CreateDate: 2023/03/15
+# Nozzle_mcu: chip: STM32G071CBU6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: AT32F421F6P7
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: STM32F401RCT6
+#      version: CR4CU220812S10
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 225
+position_min: -5
+position_max: 225
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin: PA10
+tx_pin: PA9
+interpolate: True
+run_current: 1.5
+hold_current: 1.0
+uart_address: 0
+sense_resistor: 0.15
+stealthchop_threshold: 0
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 220
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin: PA10
+tx_pin: PA9
+interpolate: True
+run_current: 1.5
+hold_current: 1.0
+uart_address: 2
+sense_resistor: 0.15
+stealthchop_threshold: 0
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 60:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15 #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 255
+position_min: -5
+
+[tmc2209 stepper_z]
+uart_pin: PA10
+tx_pin: PA9
+run_current: 0.8
+diag_pin: ^PB14
+uart_address: 1
+sense_resistor: 0.15
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 80
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB14
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB10
+tx_pin: nozzle_mcu: PB11
+run_current: 0.5
+uart_address: 3
+sense_resistor: 0.15
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PB10
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control = pid
+pid_kp = 27
+pid_ki = 0.08
+pid_kd = 0
+min_temp: 0
+max_temp: 125
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PA8,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[output_pin fan0]
+pin: nozzle_mcu:PB15
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   110,110,10
+
+[hx711s]
+count: 4
+use_mcu: leveling_mcu
+sensor0_clk_pin: leveling_mcu:PA5
+sensor1_clk_pin: leveling_mcu:PA2
+sensor2_clk_pin: leveling_mcu:PA6
+sensor3_clk_pin: leveling_mcu:PA7
+sensor0_sdo_pin: leveling_mcu:PA1
+sensor1_sdo_pin: leveling_mcu:PA0
+sensor2_sdo_pin: leveling_mcu:PA3
+sensor3_sdo_pin: leveling_mcu:PA4
+
+[prtouch]
+z_offset: 0
+base_count: 40
+pi_count: 32
+min_hold: 2000
+max_hold: 6000
+s_hot_min_temp: 140
+s_hot_max_temp: 200
+s_bed_max_temp: 60
+pa_fil_len_mm: 5
+pa_fil_dis_mm: 30
+pa_clr_dis_mm: 30
+bed_max_err: 4
+max_dis_bef_g28: 0
+dead_zone_bef_g28: 2
+g28_sta0_speed: 1.8
+g28_sta1_speed: 1.8
+g29_rdy_speed: 3
+g29_speed: 1.8
+show_msg: false
+g28_wait_cool_down: true
+need_measure_gap: true
+fix_z_offset:0
+
+[filter]
+hft_hz: 1
+lft_k1: 0.95
+lft_k1_oft: 0.95
+lft_k1_cal: 0.95
+
+[dirzctl]
+use_mcu: mcu
+step_base: 2
+
+[bed_mesh]
+speed: 300
+mesh_min: 5,5
+mesh_max: 215,215
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S10/printer_params.cfg
@@ -0,0 +1,33 @@
+# K1
+# Printer_size: 220x220x250
+# Version: v1.0.9
+# CreateDate: 2023/03/15
+# Nozzle_mcu: chip: STM32G071CBU6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: AT32F421F6P7
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: STM32F401RCT6
+#      version: CR4CU220812S10
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PC6 # model fan
+# # fan1_pin: nozzle_mcu:PA9 # throat fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 220
+variable_bed_size_y: 220
+variable_bed_size_z: 220
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S10/sensorless.cfg
@@ -0,0 +1,196 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      # BED_MESH_SET_DISABLE
+      {% if printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        STEPPER_Z_SENEORLESS MOVE_DIST=15
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=70
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=70
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  BED_MESH_SAVE
+  BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+  {% endif %}
+  BED_MESH_RESTORE
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S11/gcode_macro.cfg
@@ -0,0 +1,437 @@
+# K1
+# CreateDate: 2023/03/15
+# history: 1. date: 2023.03.17
+#             modify: [gcode_macro END_PRINT]
+#          2. date: 2023.03.20
+#             delete: [gcode_macro Qmode].printer_state
+#          3. date: 2023.03.23
+#             modify: [gcode_macro LOAD_MATERIAL]
+#                     [gcode_macro QUIT_MATERIAL]
+
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 220.0
+variable_max_y_position: 220.0
+variable_max_z_position: 250.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 50
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E150 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer['output_pin fan0'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=5000
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=200
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+      M106 P0 S80
+      M106 P1 S0
+      M106 P2 S0
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+      M106 P0 S{(printer['gcode_macro Qmode'].fan0_value * 255 + 0.5)|int}
+      M106 P1 S{(printer['gcode_macro Qmode'].fan1_value * 255 + 0.5)|int}
+      M106 P2 S{(printer['gcode_macro Qmode'].fan2_value * 255 + 0.5)|int}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% if 'S' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+    {% endif %}
+    M204.1 {get_params}
+  {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% if params.P is defined %}
+    SET_PIN PIN=fan{params.P|int} VALUE=0
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 X{x_park} Y{y_park} Z2.0 F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  G28 Z
+
+[gcode_macro START_PRINT]
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    G1 Z{z_safe} F1200
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F6000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  M220 S100
+  M204 S500
+  TURN_OFF_HEATERS
+  M107 P1
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 1.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  # {action_respond_info("fan2_value1 = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G1 E-{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F6000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} Z5 F6000
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S11/printer.cfg
@@ -0,0 +1,303 @@
+# K1
+# Printer_size: 220x220x250
+# Version: v1.0.6
+# CreateDate: 2023/03/15
+# Nozzle_mcu: chip: STM32G071CBU6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: AT32F421F6P7
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: STM32F401RCT6
+#      version: CR4CU220812S11
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+# [temperature_sensor chamber_temp]
+# sensor_type: EPCOS 100K B57560G104F
+# sensor_pin: PC5
+# min_temp: 0
+# max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 229
+position_min: -5
+position_max: 229
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 226
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 255
+position_min: -5
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB14
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB10
+tx_pin: nozzle_mcu: PB11
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PB10
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control = pid
+pid_kp = 27
+pid_ki = 0.08
+pid_kd = 0
+min_temp: 0
+max_temp: 120
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PA8,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[output_pin fan0]
+pin: nozzle_mcu:PB15
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   110,110,10
+
+[prtouch_v2]  # K1
+step_base: 2
+z_offset: 0
+noz_ex_com: 0.06
+tilt_corr_dis: 0.03
+tri_min_hold: 2000
+tri_max_hold: 6000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA5
+pres0_sdo_pins: leveling_mcu:PA1
+pres1_clk_pins: leveling_mcu:PA2
+pres1_sdo_pins: leveling_mcu:PA0
+pres2_clk_pins: leveling_mcu:PA6
+pres2_sdo_pins: leveling_mcu:PA3
+pres3_clk_pins: leveling_mcu:PA7
+pres3_sdo_pins: leveling_mcu:PA4
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 95
+clr_noz_start_y: 221
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 215,215
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S11/printer_params.cfg
@@ -0,0 +1,33 @@
+# K1
+# Printer_size: 220x220x250
+# Version: v1.0.4
+# CreateDate: 2023/03/15
+# Nozzle_mcu: chip: STM32G071CBU6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: AT32F421F6P7
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: STM32F401RCT6
+#      version: CR4CU220812S11
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PC6 # model fan
+# # fan1_pin: nozzle_mcu:PA9 # throat fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 220
+variable_bed_size_y: 220
+variable_bed_size_z: 220
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S11/sensorless.cfg
@@ -0,0 +1,194 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=70
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=70
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+    BED_MESH_PROFILE LOAD="default"
+  {% endif %}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S12/factory_printer.cfg
@@ -0,0 +1,421 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.1
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB11
+tx_pin: nozzle_mcu: PB10
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC12
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 54.901
+pid_Ki: 1.142
+pid_Kd: 375.483
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PA0]
+pin:PA0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB2]
+pin:PB2
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB10]
+pin:PB10
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC8]
+pin:PC8
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC9]
+pin:PC9
+pwm: True
+cycle_time: 0.010
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0# //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+g29_down_min_z: 50
+
+correct_tri_hold: 8000
+correct_step_mm:  0.02
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S12/gcode_macro.cfg
@@ -0,0 +1,714 @@
+# K1
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 220.0
+variable_max_y_position: 220.0
+variable_max_z_position: 250.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  RESTORE_E_CURRENT
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  SET_E_MIN_CURRENT
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E80 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M141]
+description: Set Chamber temperature with slicers
+gcode:
+  SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    WAIT_TEMP_END
+  {% else %}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  {action_respond_info("wait temp start\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  # M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  {action_respond_info("wait temp end\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  # M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("not prepare.\n")}
+    PRINT_PREPARE_CLEAR
+    CX_ROUGH_G28 EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}
+    CX_NOZZLE_CLEAR
+    ACCURATE_G28
+    CX_PRINT_LEVELING_CALIBRATION
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z2.0 F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=2500
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < 48.0 %}
+    {% set z_safe = 50.0 - act_z %}
+  {% elif act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  {action_respond_info("z_safe = %s"% (z_safe))}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+  M104 S140
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    M400
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE AXIS=y
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+    G90
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S12/printer.cfg
@@ -0,0 +1,349 @@
+# K1
+# Printer_size: 220x220x250
+# Version: v1.0.25
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC0, PC5
+
+[temperature_fan chamber_fan]
+pin: PC0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 70
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 229
+position_min: -5
+position_max: 229
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -0.5
+position_min: -0.5
+position_max: 226
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 255
+position_min: -5
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu:PB11
+tx_pin: nozzle_mcu:PB10
+uart_address: 3
+run_current: 0.55
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PB10
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: watermark
+# control: pid
+# pid_kp: 27
+# pid_ki: 0.08
+# pid_kd: 0
+min_temp: 0
+max_temp: 115
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: !PC15
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+
+[filament_switch_sensor filament_sensor_2]
+pause_on_runout: true
+switch_pin: !nozzle_mcu:PA10
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 75
+# min_freq: 30
+# max_freq: 100
+probe_points:
+   110,110,10
+
+[prtouch_v2]  # K1
+pr_version: 1
+step_base: 2
+z_offset: 0 
+noz_ex_com: 0.05
+tilt_corr_dis: 0.03
+tri_min_hold: 2000
+tri_max_hold: 6000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA5
+pres0_sdo_pins: leveling_mcu:PA1
+pres1_clk_pins: leveling_mcu:PA2
+pres1_sdo_pins: leveling_mcu:PA0
+pres2_clk_pins: leveling_mcu:PA6
+pres2_sdo_pins: leveling_mcu:PA3
+pres3_clk_pins: leveling_mcu:PA7
+pres3_sdo_pins: leveling_mcu:PA4
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 95
+clr_noz_start_y: 221
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.70,0.30
+tri_try_max_times: 10
+tri_min_hold: 2000,20000
+tri_max_hold: 6000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 215,215
+probe_count: 5,5
+fade_start: 5.0
+fade_end: 50.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 20000
+max_accel_to_decel: 20000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+square_corner_max_velocity: 200.0
+max_z_accel: 300
+
+[pause_resume]
+# recover_velocity: 500.
+
+[exclude_object]
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S12/printer_params.cfg
@@ -0,0 +1,34 @@
+# K1
+# Printer_size: 220x220x250
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[fan_feedback]
+# fan0_pin: nozzle_mcu:PB3 # model fan
+fan0_pin: nozzle_mcu:PB4 # throat fan
+fan1_pin: PC6 # backplane fan
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 220
+variable_bed_size_y: 220
+variable_bed_size_z: 220
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1_CR4CU220812S12/sensorless.cfg
@@ -0,0 +1,201 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=70
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=70
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 9 %}
+      {% set y_park = 9 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 210.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR0CN240110C10/factory_printer.cfg
@@ -0,0 +1,421 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2024/02/22
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR0FN200338C11
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS4
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB11
+tx_pin: nozzle_mcu: PB10
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC12
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 54.901
+pid_Ki: 1.142
+pid_Kd: 375.483
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PA0]
+pin:PA0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB2]
+pin:PB2
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB10]
+pin:PB10
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC8]
+pin:PC8
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC9]
+pin:PC9
+pwm: True
+cycle_time: 0.010
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0# //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+g29_down_min_z: 50
+
+correct_tri_hold: 8000
+correct_step_mm:  0.02
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR0CN240110C10/gcode_macro.cfg
@@ -0,0 +1,714 @@
+# K1-MAX
+# CreateDate: 2024/02/22
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 300.0
+variable_max_y_position: 300.0
+variable_max_z_position: 300.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  RESTORE_E_CURRENT
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  SET_E_MIN_CURRENT
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E80 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M141]
+description: Set Chamber temperature with slicers
+gcode:
+  SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    WAIT_TEMP_END
+  {% else %}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  {action_respond_info("wait temp start\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  # M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  {action_respond_info("wait temp end\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  # M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("not prepare.\n")}
+    PRINT_PREPARE_CLEAR
+    CX_ROUGH_G28 EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}
+    CX_NOZZLE_CLEAR
+    ACCURATE_G28
+    CX_PRINT_LEVELING_CALIBRATION
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z2.0 F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=2500
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < 48.0 %}
+    {% set z_safe = 50.0 - act_z %}
+  {% elif act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  {action_respond_info("z_safe = %s"% (z_safe))}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+  M104 S140
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    M400
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE AXIS=y
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+    G90
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR0CN240110C10/printer.cfg
@@ -0,0 +1,433 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2024/02/22
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR0FN200338C11
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS2
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS3
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS4
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.1
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /mnt/UDISK/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC0, PC5
+
+[temperature_fan chamber_fan]
+pin: PC0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 70
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu:PB11
+tx_pin: nozzle_mcu:PB10
+uart_address: 3
+run_current: 0.55
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: 0
+max_temp: 125
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: !PC15
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+
+[filament_switch_sensor filament_sensor_2]
+pause_on_runout: true
+switch_pin: !nozzle_mcu:PA10
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 75
+# min_freq: 30
+# max_freq: 100
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0.05 # //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 6,6
+fade_start: 5.0
+fade_end: 50.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 20000
+max_accel_to_decel: 20000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+square_corner_max_velocity: 200.0
+max_z_accel: 300
+
+[pause_resume]
+# recover_velocity: 500.
+
+[exclude_object]
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR0CN240110C10/printer_params.cfg
@@ -0,0 +1,34 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2024/02/22
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR0FN200338C11
+
+[fan_feedback]
+fan0_pin: nozzle_mcu:PB4 # throat fan
+# fan0_pin: nozzle_mcu:PB3 # model fan
+fan1_pin: PC6 # backplane fan
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 300
+variable_bed_size_y: 300
+variable_bed_size_z: 300
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR0CN240110C10/sensorless.cfg
@@ -0,0 +1,201 @@
+# Createdate: 2024/02/22
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S11/gcode_macro.cfg
@@ -0,0 +1,440 @@
+# K1-MAX
+# CreateDate: 2023/03/15
+# history: 1. date: 2023.03.17
+#             modify: [gcode_macro END_PRINT]
+#          2. date: 2023.03.20
+#             delete: [gcode_macro Qmode].printer_state
+#          3. date: 2023.03.23
+#             modify: [gcode_macro LOAD_MATERIAL]
+#                     [gcode_macro QUIT_MATERIAL]
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 300.0
+variable_max_y_position: 300.0
+variable_max_z_position: 300.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 50
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E150 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer['output_pin fan0'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=5000
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=200
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+      M106 P0 S80
+      M106 P1 S0
+      M106 P2 S0
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+      M106 P0 S{(printer['gcode_macro Qmode'].fan0_value * 255 + 0.5)|int}
+      M106 P1 S{(printer['gcode_macro Qmode'].fan1_value * 255 + 0.5)|int}
+      M106 P2 S{(printer['gcode_macro Qmode'].fan2_value * 255 + 0.5)|int}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% if 'S' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+    {% endif %}
+    M204.1 {get_params}
+  {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% if params.P is defined %}
+    SET_PIN PIN=fan{params.P|int} VALUE=0
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    {action_respond_info("end_temp!\n")}
+    WAIT_TEMP_END
+  {% else %}
+    {action_respond_info("cur_temp = %s \n" % (cur_temp))}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+# The macro of LASER_CALIBRATION is for application use and has not been implemented
+# The macro of FLOW_DETECTION is for application use and has not been implemented
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+  LASER_CALIBRATION
+  FLOW_DETECTION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 X{x_park} Y{y_park} Z2.0 F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  G28 Z
+
+[gcode_macro START_PRINT]
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    G1 Z{z_safe} F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F6000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  M220 S100
+  M204 S500
+  TURN_OFF_HEATERS
+  M107 P1
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 1.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  # {action_respond_info("fan2_value1 = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G1 E-{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F6000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} Z5 F6000
+  SHAPER_CALIBRATE
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S11/printer.cfg
@@ -0,0 +1,309 @@
+# K1-MAX-DVT
+# Printer_size: 300x300x300
+# Version: v1.0.5
+# CreateDate: 2023/03/15
+# Nozzle_mcu: chip: STM32G071CBU6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: AT32F421F6P7
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: STM32F401RCT6
+#      version: CR4CU220812S11
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB14
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu:PB10
+tx_pin: nozzle_mcu:PB11
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: !PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 45.211
+pid_Ki: 0.15
+pid_Kd: 1200
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PA8,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[output_pin fan0]
+pin: nozzle_mcu:PB15
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.06
+tilt_corr_dis: 0.05
+tri_min_hold: 3000
+tri_max_hold: 8000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S11/printer_params.cfg
@@ -0,0 +1,33 @@
+# K1-MAX-DVT
+# Printer_size: 300x300x300
+# Version: v1.0.2
+# CreateDate: 2023/03/15
+# Nozzle_mcu: chip: STM32G071CBU6
+#             version: CR-K1-MAX-NOZZLE-V1.0.0
+# Leveling_mcu: chip: AT32F421F6P7
+#             version: CR-K1-MAX-LEVELING-V1.0.0
+# mcu: chip: STM32F401RCT6
+#      version: CR4CU220812S11
+
+# [fan_feedback]
+# fan0_pin: nozzle_mcu:PC6 # model fan
+# # fan1_pin: nozzle_mcu:PA9 # throat fan
+# print_delay_time: 5
+# current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 300
+variable_bed_size_y: 300
+variable_bed_size_z: 300
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S11/sensorless.cfg
@@ -0,0 +1,194 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+    BED_MESH_PROFILE LOAD="default"
+  {% endif %}
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S12/box.cfg
@@ -0,0 +1,14 @@
+[box]
+serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0
+baud: 115200
+pre_cut_pos_x: 1
+pre_cut_pos_y: 200
+cut_pos_x: 1
+cut_pos_y: 298
+Tn_retrude: -60
+Tn_retrude_velocity: 360
+Tn_extrude_temp: 220
+Tn_extrude: 160
+Tn_extrude_velocity: 360
+buffer_empty_len: 30
+communication_timeout: 1800 # unit:s
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S12/factory_printer.cfg
@@ -0,0 +1,421 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.1
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB11
+tx_pin: nozzle_mcu: PB10
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC12
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 54.901
+pid_Ki: 1.142
+pid_Kd: 375.483
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PA0]
+pin:PA0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB2]
+pin:PB2
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB10]
+pin:PB10
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC8]
+pin:PC8
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC9]
+pin:PC9
+pwm: True
+cycle_time: 0.010
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0# //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+g29_down_min_z: 50
+
+correct_tri_hold: 8000
+correct_step_mm:  0.02
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S12/gcode_macro.cfg
@@ -0,0 +1,717 @@
+# K1-MAX
+# CreateDate: 2023/03/21
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 300.0
+variable_max_y_position: 300.0
+variable_max_z_position: 300.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  RESTORE_E_CURRENT
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  SET_E_MIN_CURRENT
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E80 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M141]
+description: Set Chamber temperature with slicers
+gcode:
+  SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    WAIT_TEMP_END
+  {% else %}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  {action_respond_info("wait temp start\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  # M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  {action_respond_info("wait temp end\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  # M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("not prepare.\n")}
+    PRINT_PREPARE_CLEAR
+    CX_ROUGH_G28 EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}
+    CX_NOZZLE_CLEAR
+    ACCURATE_G28
+    CX_PRINT_LEVELING_CALIBRATION
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z2.0 F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  G92 E0
+  E1
+  G92 E0
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=2500
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < 48.0 %}
+    {% set z_safe = 50.0 - act_z %}
+  {% elif act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  {action_respond_info("z_safe = %s"% (z_safe))}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+  M104 S140
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    M400
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE AXIS=y
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+    G90
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S12/printer.cfg
@@ -0,0 +1,433 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.29
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC0, PC5
+
+[temperature_fan chamber_fan]
+pin: PC0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 70
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu:PB11
+tx_pin: nozzle_mcu:PB10
+uart_address: 3
+run_current: 0.55
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: 0
+max_temp: 125
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: !PC15
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+
+[filament_switch_sensor filament_sensor_2]
+pause_on_runout: true
+switch_pin: !nozzle_mcu:PA10
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 75
+# min_freq: 30
+# max_freq: 100
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0.05 # //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 6,6
+fade_start: 5.0
+fade_end: 50.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 20000
+max_accel_to_decel: 20000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+square_corner_max_velocity: 200.0
+max_z_accel: 300
+
+[pause_resume]
+# recover_velocity: 500.
+
+[exclude_object]
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S12/printer_params.cfg
@@ -0,0 +1,34 @@
+# K1-MAX
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/03/21
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[fan_feedback]
+fan0_pin: nozzle_mcu:PB4 # throat fan
+# fan0_pin: nozzle_mcu:PB3 # model fan
+fan1_pin: PC6 # backplane fan
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 300
+variable_bed_size_y: 300
+variable_bed_size_z: 300
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_CR4CU220812S12/sensorless.cfg
@@ -0,0 +1,201 @@
+# Createdate: 2023/03/08
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_SE_CR4CU220812S12/factory_printer.cfg
@@ -0,0 +1,421 @@
+# K1 MAX SE
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/09/20
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 72
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 36
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 65
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu: PB11
+tx_pin: nozzle_mcu: PB10
+uart_address: 3
+run_current: 0.5
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC12
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 54.901
+pid_Ki: 1.142
+pid_Kd: 375.483
+min_temp: 0
+max_temp: 140
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: ^!PC15
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PA0]
+pin:PA0
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB2]
+pin:PB2
+pwm: True
+cycle_time: 0.010
+
+[output_pin PB10]
+pin:PB10
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC8]
+pin:PC8
+pwm: True
+cycle_time: 0.010
+
+[output_pin PC9]
+pin:PC9
+pwm: True
+cycle_time: 0.010
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 50
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0# //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+g29_down_min_z: 50
+
+correct_tri_hold: 8000
+correct_step_mm:  0.02
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 5,5
+fade_start: 3.0
+fade_end: 10.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 1000
+max_accel: 20000
+max_accel_to_decel: 10000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+max_z_accel: 300
+
+
+
+[pause_resume]
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_SE_CR4CU220812S12/gcode_macro.cfg
@@ -0,0 +1,714 @@
+# K1 MAX SE
+# CreateDate: 2023/09/20
+
+[gcode_macro PRINTER_PARAM]
+variable_z_safe_pause: 0.0
+variable_z_safe_g28: 3.0
+variable_max_x_position: 300.0
+variable_max_y_position: 300.0
+variable_max_z_position: 300.0
+variable_fans: 3
+variable_auto_g29: 0
+variable_fan0_min: 25
+variable_fan1_min: 50
+variable_fan2_min: 180
+variable_fan2_speed: 0
+variable_hotend_temp: 0
+variable_e_min_current: 0.27
+gcode:
+
+[gcode_macro AUTOTUNE_SHAPERS]
+variable_autotune_shapers: 'ei'
+gcode:
+
+[gcode_macro LOAD_MATERIAL_CLOSE_FAN2]
+variable_fan2_value: 0
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  {% if printer['output_pin fan2'].value > 0.0 %}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value}
+    M107 P2
+  {% endif %}
+  RESTORE_E_CURRENT
+
+[gcode_macro LOAD_MATERIAL_RESTORE_FAN2]
+gcode:
+  {% set fan2_value = printer['gcode_macro LOAD_MATERIAL_CLOSE_FAN2'].fan2_value|float %}
+  RESTORE_GCODE_STATE NAME=myMoveState
+  {% if fan2_value > 0.0 %}
+    {% set s_value = (fan2_value * 255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) * 255 / (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) %}
+    M106 P2 S{s_value}
+    SET_GCODE_VARIABLE MACRO=LOAD_MATERIAL_CLOSE_FAN2 VARIABLE=fan2_value VALUE=0
+  {% endif %}
+  SET_E_MIN_CURRENT
+
+[gcode_macro SET_E_MIN_CURRENT]
+gcode:
+  {% set e_current = printer['gcode_macro PRINTER_PARAM'].e_min_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro RESTORE_E_CURRENT]
+gcode:
+  {% set e_current = printer.configfile.settings['tmc2209 extruder'].run_current %}
+  M400
+  SET_TMC_CURRENT STEPPER=extruder CURRENT={e_current} HOLDCURRENT={e_current}
+  G4 P2000
+
+[gcode_macro LOAD_MATERIAL]
+gcode:
+  LOAD_MATERIAL_CLOSE_FAN2
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E80 F180
+  LOAD_MATERIAL_RESTORE_FAN2
+
+[gcode_macro QUIT_MATERIAL]
+gcode:
+  SAVE_GCODE_STATE NAME=myMoveState
+  M109 S{printer.custom_macro.default_extruder_temp}
+  G91
+  G1 E20 F180
+  G1 E-30 F180
+  G1 E-50 F2000
+  RESTORE_GCODE_STATE NAME=myMoveState
+
+[gcode_macro Qmode]
+variable_flag: 0
+variable_accel: 0
+variable_accel_to_decel: 0
+variable_velocity: 0
+variable_square_corner_velocity: 0
+variable_pressure_advance:0.0
+variable_fan0_value: 0.00
+variable_fan1_value: 0.00
+variable_fan2_value: 0.00
+variable_speed_factor: 0
+variable_max_accel: 2500
+variable_max_accel_to_decel: 2500
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel VALUE={printer.toolhead.max_accel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=accel_to_decel VALUE={printer.toolhead.max_accel_to_decel}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=velocity VALUE={printer.toolhead.max_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=square_corner_velocity VALUE={printer.toolhead.square_corner_velocity}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=pressure_advance VALUE={printer.extruder.pressure_advance}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=speed_factor VALUE={printer.gcode_move.speed_factor}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT=1.0
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT=1.0
+      G4 P1000
+
+      # Set Motion Parameters
+      SET_VELOCITY_LIMIT ACCEL=2500
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL=2500
+      SET_VELOCITY_LIMIT VELOCITY=150
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY=5
+      SET_PRESSURE_ADVANCE ADVANCE=0.05
+      M220 S50
+
+      {% set tmp = printer['output_pin fan0'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={tmp}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan0_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        SET_PIN PIN=fan0 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan1'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer['output_pin fan1'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan1_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        SET_PIN PIN=fan1 VALUE={tmp}
+      {% endif %}
+
+      {% set tmp = printer['output_pin fan2'].value * 255 %}
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer['output_pin fan2'].value * 255}
+      {% if tmp - printer['gcode_macro PRINTER_PARAM'].fan2_min > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% set tmp = printer['gcode_macro PRINTER_PARAM'].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        SET_PIN PIN=fan2 VALUE={tmp}
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=1
+      SET_QMODE_FLAG FLAG=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro Qmode_exit]
+gcode:
+  {% set printer_state = printer.print_stats.state %}
+  {% if printer['gcode_macro Qmode'].flag|int == 1 %}
+    {% if printer_state == "printing" or printer_state == "paused" %}
+      SET_VELOCITY_LIMIT ACCEL={printer['gcode_macro Qmode'].accel}
+      SET_VELOCITY_LIMIT ACCEL_TO_DECEL={printer['gcode_macro Qmode'].accel_to_decel}
+      SET_VELOCITY_LIMIT VELOCITY={printer['gcode_macro Qmode'].velocity}
+      SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={printer['gcode_macro Qmode'].square_corner_velocity}
+      SET_PRESSURE_ADVANCE ADVANCE={printer['gcode_macro Qmode'].pressure_advance}
+      M220 S{printer['gcode_macro Qmode'].speed_factor * 100}
+
+      {% set X_RUN_CUR = printer.configfile.settings['tmc2209 stepper_x'].run_current %}
+      {% set Y_RUN_CUR = printer.configfile.settings['tmc2209 stepper_y'].run_current %}
+      SET_TMC_CURRENT STEPPER=stepper_x CURRENT={X_RUN_CUR}
+      SET_TMC_CURRENT STEPPER=stepper_y CURRENT={Y_RUN_CUR}
+      SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+      SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+      G4 P1000
+
+      {% if printer['output_pin fan0'].value != 0 %}
+        {action_respond_info("fan0_value = %s" % printer['gcode_macro Qmode'].fan0_value)}
+        SET_PIN PIN=fan0 VALUE={printer['gcode_macro Qmode'].fan0_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan1'].value != 0 %}
+        {action_respond_info("fan1_value = %s" % printer['gcode_macro Qmode'].fan1_value)}
+        SET_PIN PIN=fan1 VALUE={printer['gcode_macro Qmode'].fan1_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE=0
+      {% endif %}
+      {% if printer['output_pin fan2'].value != 0 %}
+        {action_respond_info("fan2_value = %s" % printer['gcode_macro Qmode'].fan2_value)}
+        SET_PIN PIN=fan2 VALUE={printer['gcode_macro Qmode'].fan2_value}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE=0
+      {% endif %}
+
+      SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=flag VALUE=0
+      SET_QMODE_FLAG FLAG=0
+    {% endif %}
+  {% endif %}
+
+[gcode_macro M204]
+rename_existing: M204.1
+gcode:
+  # {% if printer['gcode_macro Qmode'].flag|int == 0 %}
+    {% set get_params = "" %}
+    {% set qmode_max_accel = printer['gcode_macro Qmode'].max_accel|string %}
+    {% if 'S' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.S|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'S' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'S' + params.S) %}
+      {% endif %}
+    {% endif %}
+    {% if 'P' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.P|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'P' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'P' + params.P) %}
+      {% endif %}
+    {% endif %}
+    {% if 'T' in params|upper %}
+      {% if printer['gcode_macro Qmode'].flag|int == 1 and params.T|float > qmode_max_accel|float %}
+        {% set get_params = (get_params + ' ' + 'T' + qmode_max_accel) %}
+      {% else %}
+        {% set get_params = (get_params + ' ' + 'T' + params.T) %}
+      {% endif %}
+    {% endif %}
+    M204.1 {get_params}
+  # {% endif %}
+
+[gcode_macro M205]
+gcode:
+  {% if 'X' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.X}
+  {% elif 'Y' in params %}
+    SET_VELOCITY_LIMIT SQUARE_CORNER_VELOCITY={params.Y}
+  {% endif %}
+
+[gcode_macro M106]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% set fan = 0 %}
+  {% set value = 0 %}
+  {% if params.P is defined %}
+    {% set tmp = params.P|int %}
+    {% if tmp < fans %}
+      {% set fan = tmp %}
+    {% endif %}
+  {% endif %}
+  {% if params.S is defined %}
+    {% set tmp = params.S|float %}
+  {% else %}
+    {% set tmp = 255 %}
+  {% endif %}
+  {% if tmp > 0 %}
+    {% if fan == 0 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan0_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan0_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan0_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan0_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan0_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 1 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan1_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan1_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan1_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan1_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan1_min + value %}
+      {% endif %}
+    {% endif %}
+    {% if fan == 2 %}
+      {% set value = (255 - printer["gcode_macro PRINTER_PARAM"].fan2_min) / 255 * tmp %}
+      {% if printer['gcode_macro Qmode'].flag | int == 1 %}
+        SET_GCODE_VARIABLE MACRO=Qmode VARIABLE=fan2_value VALUE={printer["gcode_macro PRINTER_PARAM"].fan2_min + value}
+        {% if value > (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2  %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) / 2 %}
+        {% else %}
+          {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+        {% endif %}
+      {% else %}
+        {% set value = printer["gcode_macro PRINTER_PARAM"].fan2_min + value %}
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  {% if value >= 255 %}
+    {% set value = 255 %}
+  {% endif %}
+  SET_PIN PIN=fan{fan} VALUE={value}
+
+[gcode_macro M107]
+gcode:
+  {% set fans = printer["gcode_macro PRINTER_PARAM"].fans|int %}
+  {% if params.P is defined %}
+    {% if params.P|int < fans %}
+      SET_PIN PIN=fan{params.P|int} VALUE=0
+    {% else %}
+      SET_PIN PIN=fan0 VALUE=0
+    {% endif %}
+  {% else %}
+    SET_PIN PIN=fan0 VALUE=0
+    SET_PIN PIN=fan2 VALUE=0
+  {% endif %}
+
+[gcode_macro M141]
+description: Set Chamber temperature with slicers
+gcode:
+  SET_TEMPERATURE_FAN_TARGET TEMPERATURE_FAN=chamber_fan TARGET={params.S|default(35)}
+
+[gcode_macro M900]
+gcode:
+  {% if 'K' in params %}
+    {% if 'E' in params %}
+      SET_PRESSURE_ADVANCE EXTRUDER={params.E} ADVANCE={params.K}
+    {% else %}
+      SET_PRESSURE_ADVANCE ADVANCE={params.K}
+    {% endif %}
+  {% endif %}
+
+[delayed_gcode wait_temp]
+# initial_duration: 2.
+gcode:
+  {% set cur_temp = printer.extruder.temperature %}
+  {% if cur_temp|int < 40 %}
+    WAIT_TEMP_END
+  {% else %}
+    UPDATE_DELAYED_GCODE ID=wait_temp DURATION=5
+  {% endif %}
+
+[gcode_macro WAIT_TEMP_START]
+gcode:
+  {action_respond_info("wait temp start\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=1
+  M106 P0 S255
+  # M106 P2 S255
+
+[gcode_macro WAIT_TEMP_END]
+gcode:
+  {action_respond_info("wait temp end\n")}
+  UPDATE_DELAYED_GCODE ID=wait_temp DURATION=0
+  M106 P0 S0
+  # M106 P2 S0
+
+[gcode_macro PRINT_CALIBRATION]
+# This part of the command is replaced by the application side without passing parameters
+gcode:
+  CX_PRINT_LEVELING_CALIBRATION
+
+[gcode_macro FIRST_FLOOR_PAUSE_POSITION]
+gcode:
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  M104 S{extruder_temp}
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer['gcode_macro PRINTER_PARAM'].max_x_position|float + 1 %}
+  G90
+  G1 Z2 F600
+  G1 X{x_park} Y{y_park} F6000
+  G1 Z0.2 F600
+
+[gcode_macro ACCURATE_G28]
+gcode:
+  ACCURATE_HOME_Z
+
+[gcode_macro START_PRINT]
+variable_prepare: 0
+gcode:
+  WAIT_TEMP_END
+  CLEAR_PAUSE
+  {% set g28_extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper and (params.BED_TEMP|float) %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper and (params.EXTRUDER_TEMP|float) %}
+    {% set extruder_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+
+  {% if printer['gcode_macro START_PRINT'].prepare|int == 0 %}
+    {action_respond_info("not prepare.\n")}
+    PRINT_PREPARE_CLEAR
+    CX_ROUGH_G28 EXTRUDER_TEMP={extruder_temp} BED_TEMP={bed_temp}
+    CX_NOZZLE_CLEAR
+    ACCURATE_G28
+    CX_PRINT_LEVELING_CALIBRATION
+  {% else %}
+    PRINT_PREPARE_CLEAR
+  {% endif %}
+
+  CX_PRINT_DRAW_ONE_LINE
+
+
+[gcode_macro PRINT_PREPARED]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=1
+  {action_respond_info("print prepared")}
+
+[gcode_macro PRINT_PREPARE_CLEAR]
+gcode:
+  SET_GCODE_VARIABLE MACRO=START_PRINT VARIABLE=prepare VALUE=0
+
+[gcode_macro END_PRINT_POINT_WITHOUT_LIFTING]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    {% if act_z < (max_z - 5) %}
+      G1 Z2.0 F600
+    {% endif %}
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT_POINT]
+gcode:
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+    {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+    {% set act_z = printer.toolhead.position.z|float %}
+    {% set z_safe = 0.0 %}
+    {% if act_z < (max_z / 2) %}
+      {% set z_safe = (max_z / 2) - act_z %}
+    {% elif act_z < max_z %}
+      {% set z_safe = 2.0 %}
+    {% endif %}
+    G91
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z2.0 F600
+    G90
+    {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+    {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+    G1 X{x_park} Y{y_park} F30000
+    {% if z_safe > 2.0 %}
+      G91
+      {% set z_safe = z_safe - 2.0 %}
+      G1 Z{z_safe} F600
+      G90
+    {% endif %}
+  {% else %}
+    {action_respond_info("end print xyz_axes is NULL\n")}
+  {% endif %}
+
+[gcode_macro END_PRINT]
+gcode:
+  Qmode_exit
+  EXCLUDE_OBJECT_RESET
+  PRINT_PREPARE_CLEAR
+  M220 S100
+  SET_VELOCITY_LIMIT ACCEL=5000 ACCEL_TO_DECEL=2500
+  TURN_OFF_HEATERS
+  M107 P1
+  M107 P2
+  END_PRINT_POINT
+  WAIT_TEMP_START
+  M84
+
+[gcode_macro FIRST_FLOOR_PAUSE]
+description: Pause the first floor print
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro FIRST_FLOOR_RESUME]
+description: Resume the first floor print
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro FIRST_FLOOR_PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro PAUSE]
+description: Pause the actual running print
+rename_existing: PAUSE_BASE
+# change this if you need more or less extrusion
+variable_extrude: 2.0
+gcode:
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float %}
+  ##### set park positon for x and y #####
+  # default is your max posion from your printer.cfg
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  ##### calculate save lift position #####
+  {% set max_z = printer["gcode_macro PRINTER_PARAM"].max_z_position|float %}
+  {% set act_z = printer.toolhead.position.z|float %}
+  {% set z_safe = 0.0 %}
+  {% if act_z < 48.0 %}
+    {% set z_safe = 50.0 - act_z %}
+  {% elif act_z < (max_z - 2.0) %}
+    {% set z_safe = 2.0 %}
+  {% elif act_z < max_z %}
+    {% set z_safe = max_z - act_z %}
+  {% endif %}
+  {action_respond_info("z_safe = %s"% (z_safe))}
+  ##### end of definitions #####
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=z_safe_pause VALUE={z_safe|float}
+  PAUSE_BASE
+  G91
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE={printer.extruder.target}
+  M104 S140
+  {% if "xyz" in printer.toolhead.homed_axes %}
+    {% if printer.extruder.can_extrude|lower == 'true' %}
+      G1 E-1.0 F180
+      G1 E-{E} F4000
+    {% else %}
+      {action_respond_info("Extruder not hot enough")}
+    {% endif %}
+    G1 Z{z_safe} F600
+    M400
+    G90
+    G1 X{x_park} Y{y_park} F30000
+  {% else %}
+    {action_respond_info("Printer not homed")}
+  {% endif %}
+  # save fan2 value and turn off fan2
+  SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=fan2_speed VALUE={printer['output_pin fan2'].value}
+  {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+  {action_respond_info("fan2_value = %s \n" % (fspeed))}
+  # SET_PIN PIN=fan2 VALUE=0
+  M106 P2 S0
+  SET_E_MIN_CURRENT
+
+[gcode_macro INPUTSHAPER]
+gcode:
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+  G90
+  G28
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  G1 X{POSITION_X} Y{POSITION_Y} F6000
+  G1 Z10 F600
+  SHAPER_CALIBRATE AXIS=y
+  CXSAVE_CONFIG
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+[gcode_macro BEDPID]
+gcode:
+  PID_CALIBRATE HEATER=heater_bed TARGET=100
+  SAVE_CONFIG
+
+[gcode_macro TUNOFFINPUTSHAPER]
+gcode:
+  SET_INPUT_SHAPER SHAPER_FREQ_X=0 SHAPER_FREQ_Y=0
+
+[gcode_macro RESUME]
+description: Resume the actual running print
+rename_existing: RESUME_BASE
+gcode:
+  RESTORE_E_CURRENT
+  {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int != 0 %}
+    {% if printer['gcode_macro PRINTER_PARAM'].hotend_temp|int > printer.extruder.temperature %}
+      M109 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% else %}
+      M104 S{printer['gcode_macro PRINTER_PARAM'].hotend_temp|int}
+    {% endif %}
+    SET_GCODE_VARIABLE MACRO=PRINTER_PARAM VARIABLE=hotend_temp VALUE=0
+  {% endif %}
+  {% if printer['gcode_macro PRINTER_PARAM'].fan2_speed > 0 %}
+    # {% set fspeed = printer['gcode_macro PRINTER_PARAM'].fan2_speed %}
+    # {action_respond_info("fan2_value2 = %s \n" % (fspeed))}
+    # SET_PIN PIN=fan2 VALUE={(printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 + 0.5)|int}
+    {% set s_value = (printer['gcode_macro PRINTER_PARAM'].fan2_speed * 255 - printer['gcode_macro PRINTER_PARAM'].fan2_min) * 255 / (255 - printer['gcode_macro PRINTER_PARAM'].fan2_min)|float %}
+    M106 P2 S{s_value}
+  {% endif %}
+  {% set z_resume_move = printer['gcode_macro PRINTER_PARAM'].z_safe_pause|int %}
+  {% if z_resume_move > 2 %}
+    {% set z_resume_move = z_resume_move - 2 %}
+    G91
+    G1 Z-{z_resume_move} F600
+    M400
+  {% endif %}
+  {action_respond_info("z_resume_move = %s"% (z_resume_move))}
+  ##### read E from pause macro #####
+  {% set E = printer["gcode_macro PAUSE"].extrude|float + 1.0 %}
+  #### get VELOCITY parameter if specified ####
+  {% if 'VELOCITY' in params|upper %}
+    {% set get_params = ('VELOCITY=' + params.VELOCITY) %}
+  {%else %}
+    {% set get_params = "" %}
+  {% endif %}
+  ##### end of definitions #####
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G1 E{E} F2100
+    G90
+  {% else %}
+    {action_respond_info("Extruder not hot enough")}
+  {% endif %}
+  M400
+  RESUME_BASE {get_params}
+
+[gcode_macro CANCEL_PRINT]
+description: Cancel the actual running print
+rename_existing: CANCEL_PRINT_BASE
+gcode:
+  END_PRINT
+  CANCEL_PRINT_BASE
+
+[gcode_macro G29]
+gcode:
+  {% if 'PROBE_COUNT' in params|upper %}
+    {% set get_count = ('PROBE_COUNT' + params.PROBE_COUNT) %}
+  {%else %}
+    {% set get_count = "" %}
+  {% endif %}
+
+  {% set bed_temp = printer.custom_macro.default_bed_temp %}
+  {% set extruder_temp = printer.custom_macro.g28_ext_temp %}
+  {% set nozzle_clear_temp = printer.custom_macro.default_extruder_temp %}
+
+  {% if 'BED_TEMP' in params|upper %}
+    {% set bed_temp = params.BED_TEMP %}
+  {% endif %}
+
+  {% if 'EXTRUDER_TEMP' in params|upper %}
+    {% set nozzle_clear_temp = params.EXTRUDER_TEMP %}
+  {% endif %}
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=0
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=0
+
+  G28
+  BED_MESH_CLEAR
+  NOZZLE_CLEAR HOT_MIN_TEMP={extruder_temp} HOT_MAX_TEMP={nozzle_clear_temp} BED_MAX_TEMP={bed_temp}
+  ACCURATE_G28
+  M204 S5000
+  SET_VELOCITY_LIMIT ACCEL_TO_DECEL=5000
+  BED_MESH_CALIBRATE {get_count}
+  BED_MESH_OUTPUT
+  {% set y_park = printer.toolhead.axis_maximum.y/2 %}
+  {% set x_park = printer.toolhead.axis_maximum.x|float - 10.0 %}
+  G1 X{x_park} Y{y_park} F2000
+  CXSAVE_CONFIG
+  TURN_OFF_HEATERS
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor ENABLE=1
+  SET_FILAMENT_SENSOR SENSOR=filament_sensor_2 ENABLE=1
+
+# [gcode_macro G299]
+# gcode:
+#     BED_MESH_CLEAR
+#     G28
+#     PRTOUCH_READY
+#     BED_MESH_CALIBRATE
+#     BED_MESH_OUTPUT
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_SE_CR4CU220812S12/printer.cfg
@@ -0,0 +1,433 @@
+# K1 MAX SE
+# Printer_size: 300x300x300
+# Version: v1.0.5
+# CreateDate: 2023/09/20
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[include sensorless.cfg]
+[include gcode_macro.cfg]
+[include printer_params.cfg]
+
+[mcu]
+serial: /dev/ttyS7
+baud: 230400
+restart_method: command
+
+[mcu nozzle_mcu]
+serial: /dev/ttyS1
+baud: 230400
+restart_method: command
+
+[mcu leveling_mcu]
+serial: /dev/ttyS9
+baud: 230400
+restart_method: command
+
+[verify_heater extruder]
+[verify_heater heater_bed]
+check_gain_time: 120
+heating_gain: 1.0
+hysteresis: 10
+
+[mcu rpi]
+serial: /tmp/klipper_host_mcu
+
+[bl24c16f]
+i2c_mcu: rpi
+i2c_bus: i2c.2
+i2c_speed: 400000
+
+[idle_timeout]
+timeout: 99999999
+
+[virtual_sdcard]
+path: /usr/data/printer_data/gcodes
+
+[gcode_arcs]
+resolution: 1.0
+
+[temperature_sensor mcu_temp]
+sensor_type: temperature_mcu
+min_temp: 0
+max_temp: 100
+
+[temperature_sensor chamber_temp]
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 125
+
+[duplicate_pin_override]
+pins: PC0, PC5
+
+[temperature_fan chamber_fan]
+pin: PC0
+cycle_time: 0.0100
+hardware_pwm: false
+max_power: 1
+shutdown_speed: 0
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC5
+min_temp: 0
+max_temp: 70
+control: watermark
+max_delta: 2
+target_temp: 35.0
+max_speed: 1.0
+min_speed: 0.0
+
+[stepper_x]
+step_pin: PC2
+dir_pin: !PB9
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_x:virtual_endstop
+position_endstop: 306.5
+position_min: -2
+position_max: 306.5
+homing_speed: 30
+homing_retract_dist:0
+
+[tmc2209 stepper_x]
+uart_pin:PA9
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB12
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 75
+
+[stepper_y]
+step_pin: PB8
+dir_pin: !PB7
+enable_pin: !PC3
+microsteps: 32
+rotation_distance: 40
+endstop_pin: tmc2209_stepper_y:virtual_endstop
+position_endstop: -2
+position_min: -2
+position_max: 306
+homing_speed: 30
+homing_retract_dist:0
+
+[tmc2209 stepper_y]
+uart_pin:PA10
+interpolate: True
+run_current:1.5
+hold_current:1.0
+sense_resistor: 0.100
+stealthchop_threshold: 0
+uart_address:3
+diag_pin: ^PB13
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 0
+# driver_HSTRT: 7
+driver_SGTHRS: 75
+
+[stepper_z]
+step_pin: PB6
+dir_pin: !PB5
+enable_pin: !PC3
+microsteps: 16
+rotation_distance:8
+gear_ratio: 64:20
+endstop_pin: tmc2209_stepper_z:virtual_endstop# PA15   #probe:z_virtual_endstop
+position_endstop: 0
+position_max: 305
+position_min: -10
+homing_speed: 10
+second_homing_speed: 1
+homing_retract_dist: 2.0
+
+[tmc2209 stepper_z]
+uart_pin: PA11
+uart_address: 3
+run_current: 0.8
+diag_pin: ^PB14
+stealthchop_threshold: 0
+sense_resistor: 0.100
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 1
+# driver_TOFF: 1
+# driver_HEND: 2
+# driver_HSTRT: 2
+driver_SGTHRS: 0
+
+[extruder]
+max_extrude_only_distance: 1000.0
+max_extrude_cross_section: 80
+step_pin: nozzle_mcu:PB1
+dir_pin: nozzle_mcu:PB0
+enable_pin: !nozzle_mcu:PB2
+microsteps: 16
+rotation_distance: 6.9
+nozzle_diameter: 0.400
+filament_diameter: 1.750
+heater_pin: nozzle_mcu:PB7
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: nozzle_mcu:PA0
+pressure_advance: 0.04
+pressure_advance_smooth_time: 0.040
+control: pid
+pid_Kp: 25.013
+pid_Ki: 2.566
+pid_Kd: 60.966
+min_temp: 0
+max_temp: 320
+
+[tmc2209 extruder]
+uart_pin: nozzle_mcu:PB11
+tx_pin: nozzle_mcu:PB10
+uart_address: 3
+run_current: 0.55
+sense_resistor: 0.150
+stealthchop_threshold: 0
+# driver_IHOLDDELAY: 8
+# driver_TPOWERDOWN: 20
+# driver_TBL: 2
+# driver_TOFF: 3
+# driver_HEND: 0
+# driver_HSTRT: 5
+
+[heater_bed]
+heater_pin: PC8
+sensor_type: EPCOS 100K B57560G104F
+sensor_pin: PC4
+control: pid
+pid_Kp: 37
+pid_Ki: 0.18
+pid_Kd: 280
+min_temp: 0
+max_temp: 135
+
+[filament_switch_sensor filament_sensor]
+pause_on_runout: true
+switch_pin: !PC15
+runout_gcode:
+  {% if printer.extruder.can_extrude|lower == 'true' %}
+    G91
+    G0 E30 F600
+    G90
+  {% endif %}
+
+[filament_switch_sensor filament_sensor_2]
+pause_on_runout: true
+switch_pin: nozzle_mcu:PA10
+
+[multi_pin heater_fans]
+pins:nozzle_mcu:PB5,PB2
+
+[heater_fan hotend_fan]
+pin: multi_pin:heater_fans
+heater: extruder
+heater_temp: 40
+
+[static_digital_output my_fan_output_pins]
+pins: nozzle_mcu: PB6
+
+[output_pin fan0]
+pin: !nozzle_mcu: PB8
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan1]
+pin: PC0
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin fan2]
+pin: PB1
+pwm: True
+cycle_time: 0.0100
+hardware_pwm: false
+value: 0.00
+scale: 255
+shutdown_value: 0.0
+
+[output_pin LED]
+pin:PB0
+pwm: True
+cycle_time: 0.010
+value: 1
+
+[output_pin power]
+pin: PC9
+
+[adxl345]
+cs_pin: nozzle_mcu:PA4
+spi_speed: 5000000
+axes_map: x,-z,y
+spi_software_sclk_pin: nozzle_mcu:PA5
+spi_software_mosi_pin: nozzle_mcu:PA7
+spi_software_miso_pin: nozzle_mcu:PA6
+
+[resonance_tester]
+accel_chip: adxl345
+accel_per_hz: 75
+# min_freq: 30
+# max_freq: 100
+probe_points:
+   150,150,10
+
+[prtouch_v2]
+pr_version: 2
+step_base: 2
+z_offset: 0       
+noz_ex_com: 0.09 #0.09   喷头加热补偿值
+tilt_corr_dis:0.05 # //0.05      #热床差补偿值 
+tri_min_hold: 6000,10000 #2000,10000
+tri_max_hold: 13000,60000
+pres_cnt: 4
+pres0_clk_pins: leveling_mcu:PA7
+pres0_sdo_pins: leveling_mcu:PA4
+pres1_clk_pins: leveling_mcu:PA6
+pres1_sdo_pins: leveling_mcu:PA3
+pres2_clk_pins: leveling_mcu:PA2
+pres2_sdo_pins: leveling_mcu:PA0
+pres3_clk_pins: leveling_mcu:PA5
+pres3_sdo_pins: leveling_mcu:PA1
+show_msg: False
+step_swap_pin: PC10
+pres_swap_pin: leveling_mcu:PB1
+g28_wait_cool_down: true
+pa_clr_down_mm: -0.15
+clr_noz_start_x: 130
+clr_noz_start_y: 303
+clr_noz_len_x: 40
+clr_noz_len_y: 2
+speeds: 2.5,1.0
+tri_hftr_cut: 2,1
+tri_lftr_k1: 0.50,0.15
+
+#tri_wave_ip:172.22.40.244
+
+#进入调平状态用到的参数
+tri_min_hold_1:6000,10000
+tri_min_hold_2:6000,10000
+tri_min_hold_3:6000,10000
+tri_min_hold_4:6000,10000
+tri_min_hold_5:6000,10000
+tri_min_hold_6:6000,10000
+
+tri_min_hold_7:6000,10000
+tri_min_hold_8:6000,10000
+tri_min_hold_9:6000,10000
+tri_min_hold_10:6000,10000
+tri_min_hold_11:6000,10000
+tri_min_hold_12:6000,10000
+
+tri_min_hold_13:6000,10000
+tri_min_hold_14:6000,10000
+tri_min_hold_15:6000,10000
+tri_min_hold_16:6000,10000
+tri_min_hold_17:6000,10000
+tri_min_hold_18:6000,10000
+
+tri_min_hold_19:6000,10000
+tri_min_hold_20:6000,10000
+tri_min_hold_21:6000,10000
+tri_min_hold_22:6000,10000
+tri_min_hold_23:6000,10000
+tri_min_hold_24:6000,10000
+
+tri_min_hold_25:6000,10000
+tri_min_hold_26:6000,10000
+tri_min_hold_27:6000,10000
+tri_min_hold_28:6000,10000
+tri_min_hold_29:6000,10000
+tri_min_hold_30:6000,10000
+
+tri_min_hold_31:6000,10000
+tri_min_hold_32:6000,10000
+tri_min_hold_33:6000,10000
+tri_min_hold_34:6000,10000
+tri_min_hold_35:6000,10000
+tri_min_hold_36:6000,10000
+
+tri_max_hold_1:13000,60000
+tri_max_hold_2:13000,60000
+tri_max_hold_3:13000,60000
+tri_max_hold_4:13000,60000
+tri_max_hold_5:13000,60000
+tri_max_hold_6:13000,60000
+tri_max_hold_7:13000,60000
+tri_max_hold_8:13000,60000
+tri_max_hold_9:13000,60000
+tri_max_hold_10:13000,60000
+tri_max_hold_11:13000,60000
+tri_max_hold_12:13000,60000
+tri_max_hold_13:13000,60000
+tri_max_hold_14:13000,60000
+tri_max_hold_15:13000,60000
+tri_max_hold_16:13000,60000
+tri_max_hold_17:13000,60000
+tri_max_hold_18:13000,60000
+tri_max_hold_19:13000,60000
+tri_max_hold_20:13000,60000
+tri_max_hold_21:13000,60000
+tri_max_hold_22:13000,60000
+tri_max_hold_23:13000,60000
+tri_max_hold_24:13000,60000
+tri_max_hold_25:13000,60000
+tri_max_hold_26:13000,60000
+tri_max_hold_27:13000,60000
+tri_max_hold_28:13000,60000
+tri_max_hold_29:13000,60000
+tri_max_hold_30:13000,60000
+tri_max_hold_31:13000,60000
+tri_max_hold_32:13000,60000
+tri_max_hold_33:13000,60000
+tri_max_hold_34:13000,60000
+tri_max_hold_35:13000,60000
+tri_max_hold_36:13000,60000
+
+[bed_mesh]
+speed: 150
+mesh_min: 5,5
+mesh_max: 295,295
+probe_count: 6,6
+fade_start: 5.0
+fade_end: 50.0
+
+[display_status]
+
+[printer]
+kinematics: corexy
+max_velocity: 800
+max_accel: 20000
+max_accel_to_decel: 20000
+max_z_velocity: 20
+square_corner_velocity: 5.0
+square_corner_max_velocity: 200.0
+max_z_accel: 300
+
+[pause_resume]
+# recover_velocity: 500.
+
+[exclude_object]
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_SE_CR4CU220812S12/printer_params.cfg
@@ -0,0 +1,34 @@
+# K1 MAX SE
+# Printer_size: 300x300x300
+# Version: v1.0.0
+# CreateDate: 2023/09/20
+# Nozzle_mcu: chip: GD32F303CBT6
+#             version: K1-NOZZLE-M_V12
+# Leveling_mcu: chip: GD32E230F8P6
+#             version: K1-MAX-L-V11
+# mcu: chip: GD32F303RET6
+#      version: CR4CU220812S12
+
+[fan_feedback]
+fan0_pin: nozzle_mcu:PB4 # throat fan
+# fan0_pin: nozzle_mcu:PB3 # model fan
+fan1_pin: PC6 # backplane fan
+print_delay_time: 5
+current_delay_time: 2
+
+[custom_macro]
+default_bed_temp: 50
+default_extruder_temp: 240
+g28_ext_temp: 140
+
+# 产品定义参数
+[gcode_macro product_param]
+# 模型成型尺寸
+variable_bed_size_x: 300
+variable_bed_size_y: 300
+variable_bed_size_z: 300
+# 支持最高温度
+variable_nozzle_temp: 300
+variable_bed_temp: 100
+variable_chamber_temp: 60
+gcode:
new file mode 100644
--- /dev/null
+++ b/config/K1_MAX_SE_CR4CU220812S12/sensorless.cfg
@@ -0,0 +1,201 @@
+# Createdate: 2023/09/20
+
+[force_move]
+    enable_force_move: true
+
+[gcode_macro xyz_ready]
+variable_x_ready: 0
+variable_y_ready: 0
+variable_z_ready: 0
+variable_xy_moved: 0
+variable_z_moved: 0
+variable_safe_z: 3
+gcode:
+
+[gcode_macro _IF_HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].z_ready|int == 1 %}
+    {% if printer.toolhead.position.z|int < 5 %}
+      {% set z_park = 5.0 - printer.toolhead.position.z|int %}
+      G91
+      G1 z{z_park} F600
+      G90
+    {% endif %}
+  {% else %}
+    {% if printer['gcode_macro xyz_ready'].z_moved|int == 0 %}
+      {% if printer.print_stats.z_pos|float <= 20.0 or printer.print_stats.power_loss == 1 %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE={printer["gcode_macro PRINTER_PARAM"].z_safe_g28} VELOCITY=10
+      {% else %}
+        FORCE_MOVE STEPPER=stepper_z DISTANCE=0.1 VELOCITY=10
+      {% endif %}
+      SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=1
+    {% endif %}
+  {% endif %}
+
+[gcode_macro _IF_MOVE_XY]
+gcode:
+  _IF_HOME_Z
+  {% if printer['gcode_macro xyz_ready'].xy_moved|int == 0 %}
+    {action_respond_info("move xy\n")}
+    # FORCE_MOVE STEPPER=stepper_x DISTANCE=14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=-14 VELOCITY=50
+    FORCE_MOVE STEPPER=stepper_y DISTANCE=7 VELOCITY=50
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=1
+    G4 P1000
+  {% endif %}
+
+[gcode_macro _HOME_X]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+    {% if (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x)|round < 10 %}
+      {% set x_park = (10 - (printer.configfile.settings['stepper_x'].position_max - printer.toolhead.position.x))|round %}
+      {% if x_park > 0 %}
+        G91
+        G1 x-{x_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+  
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 X
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=1
+  # Move away
+  G91
+  G1 x-10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Y]
+gcode:
+  _IF_MOVE_XY
+
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer.toolhead.position.y|round < 8 %}
+      {% set y_park = 8 - printer.toolhead.position.y|round %}
+      {% if y_park > 0 %}
+        G91
+        G1 y{y_park} F3600
+        G90
+        G4 P1000
+      {% endif %}
+    {% endif %}
+  {% endif %}
+
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=60
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=60
+  # Home
+  G28 Y
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=1
+  # Move away
+  G91
+  G1 y10 F3600
+  G90
+  # Wait just a second (give StallGuard registers time to clear)
+  G4 P2000
+
+[gcode_macro _HOME_Z]
+gcode:
+  {% if printer['gcode_macro xyz_ready'].y_ready|int == 1 %}
+    {% if printer['gcode_macro xyz_ready'].x_ready|int == 1 %}
+      _IF_HOME_Z
+    {% endif %}
+  {% endif %}
+  {% if printer.print_stats.z_pos|float >= 260.0 %}
+    FORCE_MOVE STEPPER=stepper_z DISTANCE=-8 VELOCITY=10
+  {% endif %}
+
+  {% set POSITION_X = printer.configfile.settings['stepper_x'].position_max/2 %}
+  {% set POSITION_Y = printer.configfile.settings['stepper_y'].position_max/2 %}
+  # BED_MESH_SET_DISABLE
+  G91
+  {% set x_park = POSITION_X - printer.toolhead.position.x|int %}
+  {% set y_park = POSITION_Y - printer.toolhead.position.y|int %}
+  {action_respond_info("x_park = %s \n" % (x_park))}
+  {action_respond_info("y_park = %s \n" % (y_park))}
+  G1 x{x_park} y{y_park} F3600
+  G90
+  # G4 P500
+
+  G28 Z
+  SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=1
+  # BED_MESH_SET_ENABLE
+
+[homing_override]
+axes: xyz
+# set_position_x: 0
+# set_position_y: 0
+# set_position_z:0
+gcode:
+  M220 S100
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=0
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=0
+  # BED_MESH_CLEAR
+  {% set x_axes = printer.toolhead.homed_axes %}
+  {% if x_axes is defined and x_axes[0] is defined %}
+    {action_respond_info(
+        "x_axes: %s \n"
+        % (x_axes))}
+  {% else %}
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=x_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=y_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_ready VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=xy_moved VALUE=0
+    SET_GCODE_VARIABLE MACRO=xyz_ready VARIABLE=z_moved VALUE=0
+    {action_respond_info(
+        "x_axes is NULL\n")}
+  {% endif %}
+
+  {% if x_axes is not defined or x_axes[2] is not defined %}
+    BED_MESH_CLEAR
+  {% endif %}
+
+  {% if x_axes is defined and x_axes[0] is defined and x_axes[1] is defined %}
+    {action_respond_info("x_axes: %s \n"% (x_axes))}
+    {% set position_y = printer.toolhead.position.y|int %}
+    {% set max_y_position = printer["gcode_macro PRINTER_PARAM"].max_y_position|int %}
+    {% if position_y >= max_y_position %}
+      G91
+      G0 Y-10 F3600
+      G90
+    {% endif %}
+  {% endif %}
+
+  {% set home_all = 'X' not in params and 'Y' not in params %}
+  {% if 'Z' in params and 'X' not in params and 'Y' not in params %}
+    {% if x_axes[0] is defined and x_axes[1] is defined %}
+      {% set home_all = 0 %}
+    {% endif %}
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'X' in params %}
+    _HOME_X
+  {% endif %}
+
+  {% if home_all or 'Y' in params %}
+    _HOME_Y
+  {% endif %}
+
+  {% if home_all or 'Z' in params %}
+    _HOME_Z
+  {% endif %}
+  BED_MESH_PROFILE LOAD="default"
+  # SET_TMC_FIELD STEPPER=stepper_x FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD STEPPER=stepper_y FIELD=en_spreadcycle VALUE=1
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_x VALUE=0
+  # SET_TMC_FIELD FIELD=SGTHRS STEPPER=stepper_y VALUE=0
+  G4 P500
